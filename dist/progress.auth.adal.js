!function(e){var t={};function s(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.m=e,s.c=t,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},s.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=6)}([function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),window.progress={},t.default=window.progress},function(e,t){
// @preserve Copyright (c) Microsoft Open Technologies, Inc.
var s=function(){"use strict";return s=function(e){if(this.REQUEST_TYPE={LOGIN:"LOGIN",RENEW_TOKEN:"RENEW_TOKEN",UNKNOWN:"UNKNOWN"},this.RESPONSE_TYPE={ID_TOKEN_TOKEN:"id_token token",TOKEN:"token"},this.CONSTANTS={ACCESS_TOKEN:"access_token",EXPIRES_IN:"expires_in",ID_TOKEN:"id_token",ERROR_DESCRIPTION:"error_description",SESSION_STATE:"session_state",ERROR:"error",STORAGE:{TOKEN_KEYS:"adal.token.keys",ACCESS_TOKEN_KEY:"adal.access.token.key",EXPIRATION_KEY:"adal.expiration.key",STATE_LOGIN:"adal.state.login",STATE_RENEW:"adal.state.renew",NONCE_IDTOKEN:"adal.nonce.idtoken",SESSION_STATE:"adal.session.state",USERNAME:"adal.username",IDTOKEN:"adal.idtoken",ERROR:"adal.error",ERROR_DESCRIPTION:"adal.error.description",LOGIN_REQUEST:"adal.login.request",LOGIN_ERROR:"adal.login.error",RENEW_STATUS:"adal.token.renew.status",ANGULAR_LOGIN_REQUEST:"adal.angular.login.request"},RESOURCE_DELIMETER:"|",CACHE_DELIMETER:"||",LOADFRAME_TIMEOUT:6e3,TOKEN_RENEW_STATUS_CANCELED:"Canceled",TOKEN_RENEW_STATUS_COMPLETED:"Completed",TOKEN_RENEW_STATUS_IN_PROGRESS:"In Progress",LOGGING_LEVEL:{ERROR:0,WARN:1,INFO:2,VERBOSE:3},LEVEL_STRING_MAP:{0:"ERROR:",1:"WARNING:",2:"INFO:",3:"VERBOSE:"},POPUP_WIDTH:483,POPUP_HEIGHT:600},s.prototype._singletonInstance)return s.prototype._singletonInstance;if(s.prototype._singletonInstance=this,this.instance="https://login.microsoftonline.com/",this.config={},this.callback=null,this.popUp=!1,this.isAngular=!1,this._user=null,this._activeRenewals={},this._loginInProgress=!1,this._acquireTokenInProgress=!1,this._renewStates=[],this._callBackMappedToRenewStates={},this._callBacksMappedToRenewStates={},this._openedWindows=[],this._requestType=this.REQUEST_TYPE.LOGIN,window._adalInstance=this,e.displayCall&&"function"!=typeof e.displayCall)throw new Error("displayCall is not a function");if(!e.clientId)throw new Error("clientId is required");this.config=this._cloneConfig(e),void 0===this.config.navigateToLoginRequestUrl&&(this.config.navigateToLoginRequestUrl=!0),this.config.popUp&&(this.popUp=!0),this.config.callback&&"function"==typeof this.config.callback&&(this.callback=this.config.callback),this.config.instance&&(this.instance=this.config.instance),this.config.loginResource||(this.config.loginResource=this.config.clientId),this.config.redirectUri||(this.config.redirectUri=window.location.href.split("?")[0].split("#")[0]),this.config.postLogoutRedirectUri||(this.config.postLogoutRedirectUri=window.location.href.split("?")[0].split("#")[0]),this.config.anonymousEndpoints||(this.config.anonymousEndpoints=[]),this.config.isAngular&&(this.isAngular=this.config.isAngular),this.config.loadFrameTimeout&&(this.CONSTANTS.LOADFRAME_TIMEOUT=this.config.loadFrameTimeout)},"undefined"!=typeof window&&(window.Logging={piiLoggingEnabled:!1,level:0,log:function(e){}}),s.prototype.login=function(){if(this._loginInProgress)this.info("Login in progress");else{this._loginInProgress=!0;var e=this._guid();this.config.state=e,this._idTokenNonce=this._guid();var t=this._getItem(this.CONSTANTS.STORAGE.ANGULAR_LOGIN_REQUEST);t&&""!==t?this._saveItem(this.CONSTANTS.STORAGE.ANGULAR_LOGIN_REQUEST,""):t=window.location.href,this.verbose("Expected state: "+e+" startPage:"+t),this._saveItem(this.CONSTANTS.STORAGE.LOGIN_REQUEST,t),this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR,""),this._saveItem(this.CONSTANTS.STORAGE.STATE_LOGIN,e,!0),this._saveItem(this.CONSTANTS.STORAGE.NONCE_IDTOKEN,this._idTokenNonce,!0),this._saveItem(this.CONSTANTS.STORAGE.ERROR,""),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,"");var s=this._getNavigateUrl("id_token",null)+"&nonce="+encodeURIComponent(this._idTokenNonce);this.config.displayCall?this.config.displayCall(s):this.popUp?(this._saveItem(this.CONSTANTS.STORAGE.STATE_LOGIN,""),this._renewStates.push(e),this.registerCallback(e,this.config.clientId,this.callback),this._loginPopup(s)):this.promptUser(s)}},s.prototype._openPopup=function(e,t,s,r){try{var i=window.screenLeft?window.screenLeft:window.screenX,o=window.screenTop?window.screenTop:window.screenY,a=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,n=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,d=a/2-s/2+i,h=n/2-r/2+o,l=window.open(e,t,"width="+s+", height="+r+", top="+h+", left="+d);return l.focus&&l.focus(),l}catch(e){return this.warn("Error opening popup, "+e.message),this._loginInProgress=!1,this._acquireTokenInProgress=!1,null}},s.prototype._handlePopupError=function(e,t,s,r,i){this.warn(r),this._saveItem(this.CONSTANTS.STORAGE.ERROR,s),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,r),this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR,i),t&&this._activeRenewals[t]&&(this._activeRenewals[t]=null),this._loginInProgress=!1,this._acquireTokenInProgress=!1,e&&e(r,null,s)},s.prototype._loginPopup=function(e,t,s){var r=this._openPopup(e,"login",this.CONSTANTS.POPUP_WIDTH,this.CONSTANTS.POPUP_HEIGHT),i=s||this.callback;if(null!=r){if(this._openedWindows.push(r),-1!=this.config.redirectUri.indexOf("#"))var o=this.config.redirectUri.split("#")[0];else o=this.config.redirectUri;var a=this,n=window.setInterval(function(){if(!r||r.closed||void 0===r.closed){var e="Popup Window closed",s="Popup Window closed by UI action/ Popup Window handle destroyed due to cross zone navigation in IE/Edge";return a.isAngular&&a._broadcast("adal:popUpClosed",s+a.CONSTANTS.RESOURCE_DELIMETER+e),a._handlePopupError(i,t,e,s,s),void window.clearInterval(n)}try{var d=r.location;if(-1!=encodeURI(d.href).indexOf(encodeURI(o)))return a.isAngular?a._broadcast("adal:popUpHashChanged",d.hash):a.handleWindowCallback(d.hash),window.clearInterval(n),a._loginInProgress=!1,a._acquireTokenInProgress=!1,a.info("Closing popup window"),a._openedWindows=[],void r.close()}catch(e){}},1)}else{var d="Popup Window is null. This can happen if you are using IE";this._handlePopupError(i,t,"Error opening popup",d,d)}},s.prototype._broadcast=function(e,t){!function(){if("function"==typeof window.CustomEvent)return!1;function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var s=document.createEvent("CustomEvent");return s.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),s}e.prototype=window.Event.prototype,window.CustomEvent=e}();var s=new CustomEvent(e,{detail:t});window.dispatchEvent(s)},s.prototype.loginInProgress=function(){return this._loginInProgress},s.prototype._hasResource=function(e){var t=this._getItem(this.CONSTANTS.STORAGE.TOKEN_KEYS);return t&&!this._isEmpty(t)&&t.indexOf(e+this.CONSTANTS.RESOURCE_DELIMETER)>-1},s.prototype.getCachedToken=function(e){if(!this._hasResource(e))return null;var t=this._getItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY+e),s=this._getItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY+e),r=this.config.expireOffsetSeconds||300;return s&&s>this._now()+r?t:(this._saveItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY+e,""),this._saveItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY+e,0),null)},s.prototype.getCachedUser=function(){if(this._user)return this._user;var e=this._getItem(this.CONSTANTS.STORAGE.IDTOKEN);return this._user=this._createUser(e),this._user},s.prototype.registerCallback=function(e,t,s){this._activeRenewals[t]=e,this._callBacksMappedToRenewStates[e]||(this._callBacksMappedToRenewStates[e]=[]);var r=this;this._callBacksMappedToRenewStates[e].push(s),this._callBackMappedToRenewStates[e]||(this._callBackMappedToRenewStates[e]=function(s,i,o,a){r._activeRenewals[t]=null;for(var n=0;n<r._callBacksMappedToRenewStates[e].length;++n)try{r._callBacksMappedToRenewStates[e][n](s,i,o,a)}catch(o){r.warn(o)}r._callBacksMappedToRenewStates[e]=null,r._callBackMappedToRenewStates[e]=null})},s.prototype._renewToken=function(e,t,s){this.info("renewToken is called for resource:"+e);var r=this._addAdalFrame("adalRenewFrame"+e),i=this._guid()+"|"+e;this.config.state=i,this._renewStates.push(i),this.verbose("Renew token Expected state: "+i),s=s||"token";var o=this._urlRemoveQueryStringParameter(this._getNavigateUrl(s,e),"prompt");s===this.RESPONSE_TYPE.ID_TOKEN_TOKEN&&(this._idTokenNonce=this._guid(),this._saveItem(this.CONSTANTS.STORAGE.NONCE_IDTOKEN,this._idTokenNonce,!0),o+="&nonce="+encodeURIComponent(this._idTokenNonce)),o+="&prompt=none",o=this._addHintParameters(o),this.registerCallback(i,e,t),this.verbosePii("Navigate to:"+o),r.src="about:blank",this._loadFrameTimeout(o,"adalRenewFrame"+e,e)},s.prototype._renewIdToken=function(e,t){this.info("renewIdToken is called");var s=this._addAdalFrame("adalIdTokenFrame"),r=this._guid()+"|"+this.config.clientId;this._idTokenNonce=this._guid(),this._saveItem(this.CONSTANTS.STORAGE.NONCE_IDTOKEN,this._idTokenNonce,!0),this.config.state=r,this._renewStates.push(r),this.verbose("Renew Idtoken Expected state: "+r);var i=null===t||void 0===t?null:this.config.clientId,o=(t=t||"id_token",this._urlRemoveQueryStringParameter(this._getNavigateUrl(t,i),"prompt"));o+="&prompt=none",o=this._addHintParameters(o),o+="&nonce="+encodeURIComponent(this._idTokenNonce),this.registerCallback(r,this.config.clientId,e),this.verbosePii("Navigate to:"+o),s.src="about:blank",this._loadFrameTimeout(o,"adalIdTokenFrame",this.config.clientId)},s.prototype._urlContainsQueryStringParameter=function(e,t){return new RegExp("[\\?&]"+e+"=").test(t)},s.prototype._urlRemoveQueryStringParameter=function(e,t){var s=new RegExp("(\\&"+t+"=)[^&]+");return e=e.replace(s,""),s=new RegExp("("+t+"=)[^&]+&"),e=e.replace(s,""),s=new RegExp("("+t+"=)[^&]+"),e=e.replace(s,"")},s.prototype._loadFrameTimeout=function(e,t,s){this.verbose("Set loading state to pending for: "+s),this._saveItem(this.CONSTANTS.STORAGE.RENEW_STATUS+s,this.CONSTANTS.TOKEN_RENEW_STATUS_IN_PROGRESS),this._loadFrame(e,t);var r=this;setTimeout(function(){if(r._getItem(r.CONSTANTS.STORAGE.RENEW_STATUS+s)===r.CONSTANTS.TOKEN_RENEW_STATUS_IN_PROGRESS){r.verbose("Loading frame has timed out after: "+r.CONSTANTS.LOADFRAME_TIMEOUT/1e3+" seconds for resource "+s);var e=r._activeRenewals[s];e&&r._callBackMappedToRenewStates[e]&&r._callBackMappedToRenewStates[e]("Token renewal operation failed due to timeout",null,"Token Renewal Failed"),r._saveItem(r.CONSTANTS.STORAGE.RENEW_STATUS+s,r.CONSTANTS.TOKEN_RENEW_STATUS_CANCELED)}},r.CONSTANTS.LOADFRAME_TIMEOUT)},s.prototype._loadFrame=function(e,t){var s=this;s.info("LoadFrame: "+t);var r=t;setTimeout(function(){var t=s._addAdalFrame(r);""!==t.src&&"about:blank"!==t.src||(t.src=e,s._loadFrame(e,r))},500)},s.prototype.acquireToken=function(e,t){if(this._isEmpty(e))return this.warn("resource is required"),void t("resource is required",null,"resource is required");var s=this.getCachedToken(e);return s?(this.info("Token is already in cache for resource:"+e),void t(null,s,null)):this._user||this.config.extraQueryParameter&&-1!==this.config.extraQueryParameter.indexOf("login_hint")?void(this._activeRenewals[e]?this.registerCallback(this._activeRenewals[e],e,t):(this._requestType=this.REQUEST_TYPE.RENEW_TOKEN,e===this.config.clientId?this._user?(this.verbose("renewing idtoken"),this._renewIdToken(t)):(this.verbose("renewing idtoken and access_token"),this._renewIdToken(t,this.RESPONSE_TYPE.ID_TOKEN_TOKEN)):this._user?(this.verbose("renewing access_token"),this._renewToken(e,t)):(this.verbose("renewing idtoken and access_token"),this._renewToken(e,t,this.RESPONSE_TYPE.ID_TOKEN_TOKEN)))):(this.warn("User login is required"),void t("User login is required",null,"login required"))},s.prototype.acquireTokenPopup=function(e,t,s,r){if(this._isEmpty(e))return this.warn("resource is required"),void r("resource is required",null,"resource is required");if(!this._user)return this.warn("User login is required"),void r("User login is required",null,"login required");if(this._acquireTokenInProgress)return this.warn("Acquire token interactive is already in progress"),void r("Acquire token interactive is already in progress",null,"Acquire token interactive is already in progress");var i=this._guid()+"|"+e;this.config.state=i,this._renewStates.push(i),this._requestType=this.REQUEST_TYPE.RENEW_TOKEN,this.verbose("Renew token Expected state: "+i);var o=this._urlRemoveQueryStringParameter(this._getNavigateUrl("token",e),"prompt");if(o+="&prompt=select_account",t&&(o+=t),s&&-1===o.indexOf("&claims"))o+="&claims="+encodeURIComponent(s);else if(s&&-1!==o.indexOf("&claims"))throw new Error("Claims cannot be passed as an extraQueryParameter");o=this._addHintParameters(o),this._acquireTokenInProgress=!0,this.info("acquireToken interactive is called for the resource "+e),this.registerCallback(i,e,r),this._loginPopup(o,e,r)},s.prototype.acquireTokenRedirect=function(e,t,s){if(this._isEmpty(e))return this.warn("resource is required"),void r("resource is required",null,"resource is required");var r=this.callback;if(!this._user)return this.warn("User login is required"),void r("User login is required",null,"login required");if(this._acquireTokenInProgress)return this.warn("Acquire token interactive is already in progress"),void r("Acquire token interactive is already in progress",null,"Acquire token interactive is already in progress");var i=this._guid()+"|"+e;this.config.state=i,this.verbose("Renew token Expected state: "+i);var o=this._urlRemoveQueryStringParameter(this._getNavigateUrl("token",e),"prompt");if(o+="&prompt=select_account",t&&(o+=t),s&&-1===o.indexOf("&claims"))o+="&claims="+encodeURIComponent(s);else if(s&&-1!==o.indexOf("&claims"))throw new Error("Claims cannot be passed as an extraQueryParameter");o=this._addHintParameters(o),this._acquireTokenInProgress=!0,this.info("acquireToken interactive is called for the resource "+e),this._saveItem(this.CONSTANTS.STORAGE.LOGIN_REQUEST,window.location.href),this._saveItem(this.CONSTANTS.STORAGE.STATE_RENEW,i,!0),this.promptUser(o)},s.prototype.promptUser=function(e){e?(this.infoPii("Navigate to:"+e),window.location.replace(e)):this.info("Navigate url is empty")},s.prototype.clearCache=function(){this._saveItem(this.CONSTANTS.STORAGE.LOGIN_REQUEST,""),this._saveItem(this.CONSTANTS.STORAGE.ANGULAR_LOGIN_REQUEST,""),this._saveItem(this.CONSTANTS.STORAGE.SESSION_STATE,""),this._saveItem(this.CONSTANTS.STORAGE.STATE_LOGIN,""),this._saveItem(this.CONSTANTS.STORAGE.STATE_RENEW,""),this._renewStates=[],this._saveItem(this.CONSTANTS.STORAGE.NONCE_IDTOKEN,""),this._saveItem(this.CONSTANTS.STORAGE.IDTOKEN,""),this._saveItem(this.CONSTANTS.STORAGE.ERROR,""),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,""),this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR,""),this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR,"");var e=this._getItem(this.CONSTANTS.STORAGE.TOKEN_KEYS);if(!this._isEmpty(e)){e=e.split(this.CONSTANTS.RESOURCE_DELIMETER);for(var t=0;t<e.length&&""!==e[t];t++)this._saveItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY+e[t],""),this._saveItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY+e[t],0)}this._saveItem(this.CONSTANTS.STORAGE.TOKEN_KEYS,"")},s.prototype.clearCacheForResource=function(e){this._saveItem(this.CONSTANTS.STORAGE.STATE_RENEW,""),this._saveItem(this.CONSTANTS.STORAGE.ERROR,""),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,""),this._hasResource(e)&&(this._saveItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY+e,""),this._saveItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY+e,0))},s.prototype.logOut=function(){var e;if(this.clearCache(),this._user=null,this.config.logOutUri)e=this.config.logOutUri;else{var t="common",s="";this.config.tenant&&(t=this.config.tenant),this.config.postLogoutRedirectUri&&(s="post_logout_redirect_uri="+encodeURIComponent(this.config.postLogoutRedirectUri)),e=this.instance+t+"/oauth2/logout?"+s}this.infoPii("Logout navigate to: "+e),this.promptUser(e)},s.prototype._isEmpty=function(e){return void 0===e||!e||0===e.length},s.prototype.getUser=function(e){if("function"!=typeof e)throw new Error("callback is not a function");if(this._user)e(null,this._user);else{var t=this._getItem(this.CONSTANTS.STORAGE.IDTOKEN);this._isEmpty(t)?(this.warn("User information is not available"),e("User information is not available",null)):(this.info("User exists in cache: "),this._user=this._createUser(t),e(null,this._user))}},s.prototype._addHintParameters=function(e){if(this._user&&this._user.profile)if(this._user.profile.sid&&-1!==e.indexOf("&prompt=none"))this._urlContainsQueryStringParameter("sid",e)||(e+="&sid="+encodeURIComponent(this._user.profile.sid));else if(this._user.profile.upn&&(this._urlContainsQueryStringParameter("login_hint",e)||(e+="&login_hint="+encodeURIComponent(this._user.profile.upn)),!this._urlContainsQueryStringParameter("domain_hint",e)&&this._user.profile.upn.indexOf("@")>-1)){var t=this._user.profile.upn.split("@");e+="&domain_hint="+encodeURIComponent(t[t.length-1])}return e},s.prototype._createUser=function(e){var t=null,s=this._extractIdToken(e);return s&&s.hasOwnProperty("aud")&&(s.aud.toLowerCase()===this.config.clientId.toLowerCase()?(t={userName:"",profile:s},s.hasOwnProperty("upn")?t.userName=s.upn:s.hasOwnProperty("email")&&(t.userName=s.email)):this.warn("IdToken has invalid aud field")),t},s.prototype._getHash=function(e){return e.indexOf("#/")>-1?e=e.substring(e.indexOf("#/")+2):e.indexOf("#")>-1&&(e=e.substring(1)),e},s.prototype.isCallback=function(e){e=this._getHash(e);var t=this._deserialize(e);return t.hasOwnProperty(this.CONSTANTS.ERROR_DESCRIPTION)||t.hasOwnProperty(this.CONSTANTS.ACCESS_TOKEN)||t.hasOwnProperty(this.CONSTANTS.ID_TOKEN)},s.prototype.getLoginError=function(){return this._getItem(this.CONSTANTS.STORAGE.LOGIN_ERROR)},s.prototype.getRequestInfo=function(e){e=this._getHash(e);var t=this._deserialize(e),s={valid:!1,parameters:{},stateMatch:!1,stateResponse:"",requestType:this.REQUEST_TYPE.UNKNOWN};if(t&&(s.parameters=t,t.hasOwnProperty(this.CONSTANTS.ERROR_DESCRIPTION)||t.hasOwnProperty(this.CONSTANTS.ACCESS_TOKEN)||t.hasOwnProperty(this.CONSTANTS.ID_TOKEN))){s.valid=!0;var r="";if(!t.hasOwnProperty("state"))return this.warn("No state returned"),s;if(this.verbose("State: "+t.state),r=t.state,s.stateResponse=r,this._matchState(s))return s;if(!s.stateMatch&&window.parent){s.requestType=this._requestType;for(var i=this._renewStates,o=0;o<i.length;o++)if(i[o]===s.stateResponse){s.stateMatch=!0;break}}}return s},s.prototype._matchNonce=function(e){var t=this._getItem(this.CONSTANTS.STORAGE.NONCE_IDTOKEN);if(t){t=t.split(this.CONSTANTS.CACHE_DELIMETER);for(var s=0;s<t.length;s++)if(t[s]===e.profile.nonce)return!0}return!1},s.prototype._matchState=function(e){var t=this._getItem(this.CONSTANTS.STORAGE.STATE_LOGIN);if(t){t=t.split(this.CONSTANTS.CACHE_DELIMETER);for(var s=0;s<t.length;s++)if(t[s]===e.stateResponse)return e.requestType=this.REQUEST_TYPE.LOGIN,e.stateMatch=!0,!0}var r=this._getItem(this.CONSTANTS.STORAGE.STATE_RENEW);if(r){r=r.split(this.CONSTANTS.CACHE_DELIMETER);for(s=0;s<r.length;s++)if(r[s]===e.stateResponse)return e.requestType=this.REQUEST_TYPE.RENEW_TOKEN,e.stateMatch=!0,!0}return!1},s.prototype._getResourceFromState=function(e){if(e){var t=e.indexOf("|");if(t>-1&&t+1<e.length)return e.substring(t+1)}return""},s.prototype.saveTokenFromHash=function(e){this.info("State status:"+e.stateMatch+"; Request type:"+e.requestType),this._saveItem(this.CONSTANTS.STORAGE.ERROR,""),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,"");var t,s=this._getResourceFromState(e.stateResponse);e.parameters.hasOwnProperty(this.CONSTANTS.ERROR_DESCRIPTION)?(this.infoPii("Error :"+e.parameters.error+"; Error description:"+e.parameters[this.CONSTANTS.ERROR_DESCRIPTION]),this._saveItem(this.CONSTANTS.STORAGE.ERROR,e.parameters.error),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,e.parameters[this.CONSTANTS.ERROR_DESCRIPTION]),e.requestType===this.REQUEST_TYPE.LOGIN&&(this._loginInProgress=!1,this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR,e.parameters.error_description))):e.stateMatch?(this.info("State is right"),e.parameters.hasOwnProperty(this.CONSTANTS.SESSION_STATE)&&this._saveItem(this.CONSTANTS.STORAGE.SESSION_STATE,e.parameters[this.CONSTANTS.SESSION_STATE]),e.parameters.hasOwnProperty(this.CONSTANTS.ACCESS_TOKEN)&&(this.info("Fragment has access token"),this._hasResource(s)||(t=this._getItem(this.CONSTANTS.STORAGE.TOKEN_KEYS)||"",this._saveItem(this.CONSTANTS.STORAGE.TOKEN_KEYS,t+s+this.CONSTANTS.RESOURCE_DELIMETER)),this._saveItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY+s,e.parameters[this.CONSTANTS.ACCESS_TOKEN]),this._saveItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY+s,this._expiresIn(e.parameters[this.CONSTANTS.EXPIRES_IN]))),e.parameters.hasOwnProperty(this.CONSTANTS.ID_TOKEN)&&(this.info("Fragment has id token"),this._loginInProgress=!1,this._user=this._createUser(e.parameters[this.CONSTANTS.ID_TOKEN]),this._user&&this._user.profile?this._matchNonce(this._user)?(this._saveItem(this.CONSTANTS.STORAGE.IDTOKEN,e.parameters[this.CONSTANTS.ID_TOKEN]),s=this.config.loginResource?this.config.loginResource:this.config.clientId,this._hasResource(s)||(t=this._getItem(this.CONSTANTS.STORAGE.TOKEN_KEYS)||"",this._saveItem(this.CONSTANTS.STORAGE.TOKEN_KEYS,t+s+this.CONSTANTS.RESOURCE_DELIMETER)),this._saveItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY+s,e.parameters[this.CONSTANTS.ID_TOKEN]),this._saveItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY+s,this._user.profile.exp)):(this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR,"Nonce received: "+this._user.profile.nonce+" is not same as requested: "+this._getItem(this.CONSTANTS.STORAGE.NONCE_IDTOKEN)),this._user=null):(e.parameters.error="invalid id_token",e.parameters.error_description="Invalid id_token. id_token: "+e.parameters[this.CONSTANTS.ID_TOKEN],this._saveItem(this.CONSTANTS.STORAGE.ERROR,"invalid id_token"),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,"Invalid id_token. id_token: "+e.parameters[this.CONSTANTS.ID_TOKEN])))):(e.parameters.error="Invalid_state",e.parameters.error_description="Invalid_state. state: "+e.stateResponse,this._saveItem(this.CONSTANTS.STORAGE.ERROR,"Invalid_state"),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,"Invalid_state. state: "+e.stateResponse));this._saveItem(this.CONSTANTS.STORAGE.RENEW_STATUS+s,this.CONSTANTS.TOKEN_RENEW_STATUS_COMPLETED)},s.prototype.getResourceForEndpoint=function(e){if(this.config&&this.config.anonymousEndpoints)for(var t=0;t<this.config.anonymousEndpoints.length;t++)if(e.indexOf(this.config.anonymousEndpoints[t])>-1)return null;if(this.config&&this.config.endpoints)for(var s in this.config.endpoints)if(e.indexOf(s)>-1)return this.config.endpoints[s];return e.indexOf("http://")>-1||e.indexOf("https://")>-1?this._getHostFromUri(e)===this._getHostFromUri(this.config.redirectUri)?this.config.loginResource:null:this.config.loginResource},s.prototype._getHostFromUri=function(e){var t=String(e).replace(/^(https?:)\/\//,"");return t=t.split("/")[0]},s.prototype.handleWindowCallback=function(e){if(null==e&&(e=window.location.hash),this.isCallback(e)){var t=null,s=!1;this._openedWindows.length>0&&this._openedWindows[this._openedWindows.length-1].opener&&this._openedWindows[this._openedWindows.length-1].opener._adalInstance?(t=this._openedWindows[this._openedWindows.length-1].opener._adalInstance,s=!0):window.parent&&window.parent._adalInstance&&(t=window.parent._adalInstance);var r,i,o=t.getRequestInfo(e),a=null;i=s||window.parent!==window?t._callBackMappedToRenewStates[o.stateResponse]:t.callback,t.info("Returned from redirect url"),t.saveTokenFromHash(o),o.requestType===this.REQUEST_TYPE.RENEW_TOKEN&&window.parent?(window.parent!==window?t.verbose("Window is in iframe, acquiring token silently"):t.verbose("acquiring token interactive in progress"),r=o.parameters[t.CONSTANTS.ACCESS_TOKEN]||o.parameters[t.CONSTANTS.ID_TOKEN],a=t.CONSTANTS.ACCESS_TOKEN):o.requestType===this.REQUEST_TYPE.LOGIN&&(r=o.parameters[t.CONSTANTS.ID_TOKEN],a=t.CONSTANTS.ID_TOKEN);var n=o.parameters[t.CONSTANTS.ERROR_DESCRIPTION],d=o.parameters[t.CONSTANTS.ERROR];try{i&&i(n,r,d,a)}catch(e){t.error("Error occurred in user defined callback function: "+e)}window.parent!==window||s||(t.config.navigateToLoginRequestUrl?window.location.href=t._getItem(t.CONSTANTS.STORAGE.LOGIN_REQUEST):window.location.hash="")}},s.prototype._getNavigateUrl=function(e,t){var s="common";this.config.tenant&&(s=this.config.tenant);var r=this.instance+s+"/oauth2/authorize"+this._serialize(e,this.config,t)+this._addLibMetadata();return this.info("Navigate url:"+r),r},s.prototype._extractIdToken=function(e){var t=this._decodeJwt(e);if(!t)return null;try{var s=t.JWSPayload,r=this._base64DecodeStringUrlSafe(s);return r?JSON.parse(r):(this.info("The returned id_token could not be base64 url safe decoded."),null)}catch(e){this.error("The returned id_token could not be decoded",e)}return null},s.prototype._base64DecodeStringUrlSafe=function(e){return e=e.replace(/-/g,"+").replace(/_/g,"/"),window.atob?decodeURIComponent(escape(window.atob(e))):decodeURIComponent(escape(this._decode(e)))},s.prototype._decode=function(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",s=(e=String(e).replace(/=+$/,"")).length;if(s%4==1)throw new Error("The token to be decoded is not correctly encoded.");for(var r,i,o,a,n,d,h,l,c="",f=0;f<s;f+=4){if(r=t.indexOf(e.charAt(f)),i=t.indexOf(e.charAt(f+1)),o=t.indexOf(e.charAt(f+2)),a=t.indexOf(e.charAt(f+3)),f+2===s-1){d=(n=r<<18|i<<12|o<<6)>>16&255,h=n>>8&255,c+=String.fromCharCode(d,h);break}if(f+1===s-1){d=(n=r<<18|i<<12)>>16&255,c+=String.fromCharCode(d);break}d=(n=r<<18|i<<12|o<<6|a)>>16&255,h=n>>8&255,l=255&n,c+=String.fromCharCode(d,h,l)}return c},s.prototype._decodeJwt=function(e){if(this._isEmpty(e))return null;var t=/^([^\.\s]*)\.([^\.\s]+)\.([^\.\s]*)$/.exec(e);return!t||t.length<4?(this.warn("The returned id_token is not parseable."),null):{header:t[1],JWSPayload:t[2],JWSSig:t[3]}},s.prototype._convertUrlSafeToRegularBase64EncodedString=function(e){return e.replace("-","+").replace("_","/")},s.prototype._serialize=function(e,t,s){var r=[];if(null!==t){r.push("?response_type="+e),r.push("client_id="+encodeURIComponent(t.clientId)),s&&r.push("resource="+encodeURIComponent(s)),r.push("redirect_uri="+encodeURIComponent(t.redirectUri)),r.push("state="+encodeURIComponent(t.state)),t.hasOwnProperty("slice")&&r.push("slice="+encodeURIComponent(t.slice)),t.hasOwnProperty("extraQueryParameter")&&r.push(t.extraQueryParameter);var i=t.correlationId?t.correlationId:this._guid();r.push("client-request-id="+encodeURIComponent(i))}return r.join("&")},s.prototype._deserialize=function(e){var t,s=/\+/g,r=/([^&=]+)=([^&]*)/g,i=function(e){return decodeURIComponent(e.replace(s," "))},o={};for(t=r.exec(e);t;)o[i(t[1])]=i(t[2]),t=r.exec(e);return o},s.prototype._decimalToHex=function(e){for(var t=e.toString(16);t.length<2;)t="0"+t;return t},s.prototype._guid=function(){var e=window.crypto||window.msCrypto;if(e&&e.getRandomValues){var t=new Uint8Array(16);return e.getRandomValues(t),t[6]|=64,t[6]&=79,t[8]|=128,t[8]&=191,this._decimalToHex(t[0])+this._decimalToHex(t[1])+this._decimalToHex(t[2])+this._decimalToHex(t[3])+"-"+this._decimalToHex(t[4])+this._decimalToHex(t[5])+"-"+this._decimalToHex(t[6])+this._decimalToHex(t[7])+"-"+this._decimalToHex(t[8])+this._decimalToHex(t[9])+"-"+this._decimalToHex(t[10])+this._decimalToHex(t[11])+this._decimalToHex(t[12])+this._decimalToHex(t[13])+this._decimalToHex(t[14])+this._decimalToHex(t[15])}for(var s="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx",r="0123456789abcdef",i=0,o="",a=0;a<36;a++)"-"!==s[a]&&"4"!==s[a]&&(i=16*Math.random()|0),"x"===s[a]?o+=r[i]:"y"===s[a]?(i&=3,o+=r[i|=8]):o+=s[a];return o},s.prototype._expiresIn=function(e){return e||(e=3599),this._now()+parseInt(e,10)},s.prototype._now=function(){return Math.round((new Date).getTime()/1e3)},s.prototype._addAdalFrame=function(e){if(void 0!==e){this.info("Add adal frame to document:"+e);var t=document.getElementById(e);if(!t){if(document.createElement&&document.documentElement&&(window.opera||-1===window.navigator.userAgent.indexOf("MSIE 5.0"))){var s=document.createElement("iframe");s.setAttribute("id",e),s.setAttribute("aria-hidden","true"),s.style.visibility="hidden",s.style.position="absolute",s.style.width=s.style.height=s.borderWidth="0px",t=document.getElementsByTagName("body")[0].appendChild(s)}else document.body&&document.body.insertAdjacentHTML&&document.body.insertAdjacentHTML("beforeEnd",'<iframe name="'+e+'" id="'+e+'" style="display:none"></iframe>');window.frames&&window.frames[e]&&(t=window.frames[e])}return t}},s.prototype._saveItem=function(e,t,s){if(this.config&&this.config.cacheLocation&&"localStorage"===this.config.cacheLocation){if(!this._supportsLocalStorage())return this.info("Local storage is not supported"),!1;if(s){var r=this._getItem(e)||"";localStorage.setItem(e,r+t+this.CONSTANTS.CACHE_DELIMETER)}else localStorage.setItem(e,t);return!0}return this._supportsSessionStorage()?(sessionStorage.setItem(e,t),!0):(this.info("Session storage is not supported"),!1)},s.prototype._getItem=function(e){return this.config&&this.config.cacheLocation&&"localStorage"===this.config.cacheLocation?this._supportsLocalStorage()?localStorage.getItem(e):(this.info("Local storage is not supported"),null):this._supportsSessionStorage()?sessionStorage.getItem(e):(this.info("Session storage is not supported"),null)},s.prototype._supportsLocalStorage=function(){try{return!!window.localStorage&&(window.localStorage.setItem("storageTest","A"),"A"==window.localStorage.getItem("storageTest")&&(window.localStorage.removeItem("storageTest"),!window.localStorage.getItem("storageTest")))}catch(e){return!1}},s.prototype._supportsSessionStorage=function(){try{return!!window.sessionStorage&&(window.sessionStorage.setItem("storageTest","A"),"A"==window.sessionStorage.getItem("storageTest")&&(window.sessionStorage.removeItem("storageTest"),!window.sessionStorage.getItem("storageTest")))}catch(e){return!1}},s.prototype._cloneConfig=function(e){if(null===e||"object"!=typeof e)return e;var t={};for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);return t},s.prototype._addLibMetadata=function(){return"&x-client-SKU=Js&x-client-Ver="+this._libVersion()},s.prototype.log=function(e,t,s,r){if(e<=Logging.level){if(!Logging.piiLoggingEnabled&&r)return;var i=(new Date).toUTCString(),o="";o=this.config.correlationId?i+":"+this.config.correlationId+"-"+this._libVersion()+"-"+this.CONSTANTS.LEVEL_STRING_MAP[e]+" "+t:i+":"+this._libVersion()+"-"+this.CONSTANTS.LEVEL_STRING_MAP[e]+" "+t,s&&(o+="\nstack:\n"+s.stack),Logging.log(o)}},s.prototype.error=function(e,t){this.log(this.CONSTANTS.LOGGING_LEVEL.ERROR,e,t)},s.prototype.warn=function(e){this.log(this.CONSTANTS.LOGGING_LEVEL.WARN,e,null)},s.prototype.info=function(e){this.log(this.CONSTANTS.LOGGING_LEVEL.INFO,e,null)},s.prototype.verbose=function(e){this.log(this.CONSTANTS.LOGGING_LEVEL.VERBOSE,e,null)},s.prototype.errorPii=function(e,t){this.log(this.CONSTANTS.LOGGING_LEVEL.ERROR,e,t,!0)},s.prototype.warnPii=function(e){this.log(this.CONSTANTS.LOGGING_LEVEL.WARN,e,null,!0)},s.prototype.infoPii=function(e){this.log(this.CONSTANTS.LOGGING_LEVEL.INFO,e,null,!0)},s.prototype.verbosePii=function(e){this.log(this.CONSTANTS.LOGGING_LEVEL.VERBOSE,e,null,!0)},s.prototype._libVersion=function(){return"1.0.17"},void 0!==e&&e.exports&&(e.exports=s,e.exports.inject=function(e){return new s(e)}),s}()},function(e,t,s){var{default:r}=s(0),i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){"use strict";void 0===r&&(r={}),void 0===r.data&&(r.data={}),r.data.AuthenticationProvider=function(e){var t;if("object"!==(void 0===e?"undefined":i(e)))throw new Error(r.data._getMsgText("jsdoMSG033","AuthenticationProvider","the constructor","The init-object argument was missing or invalid."));switch(this._checkStringArg("constructor",e.authenticationModel,"initObject.authenticationModel","initObject.authenticationModel"),this._checkStringArg("constructor",e.uri,"init-object.uri","init-object.uri"),e.authenticationModel.toLowerCase()){case r.data.Session.AUTH_TYPE_ANON:this._initialize(e.uri,r.data.Session.AUTH_TYPE_ANON,{_loginURI:r.data.AuthenticationProvider._homeLoginURIBase}),t=this;break;case r.data.Session.AUTH_TYPE_BASIC:t=new r.data.AuthenticationProviderBasic(e.uri);break;case r.data.Session.AUTH_TYPE_FORM:t=new r.data.AuthenticationProviderForm(e.uri);break;case r.data.Session.AUTH_TYPE_FORM_SSO:t=new r.data.AuthenticationProviderSSO(e.uri);break;case r.data.Session.AUTH_TYPE_ADAL:t=new r.data.AuthenticationProviderAdal(e.uri,e.authConfig);break;default:throw new Error(r.data._getMsgText("jsdoMSG502","AuthenticationProvider","init-object","constructor","authenticationModel"))}return t},r.data.AuthenticationProvider.prototype._loginProto=function(e){var t,s,i=$.Deferred(),o=this;if(this._loggedIn)throw new Error(r.data._getMsgText("jsdoMSG051","AuthenticationProvider"));return(t=new XMLHttpRequest).onreadystatechange=function(){4===t.readyState&&o._processLoginResult(t,i)},s=r.data.Session._useTimeStamp?r.data.Session._addTimeStampToURL(this._loginURI):this._loginURI,this._openLoginRequest(t,s),t.setRequestHeader("Accept","application/json"),t.send(e),i.promise()},r.data.AuthenticationProvider.prototype.login=function(){return this._loginProto()},r.data.AuthenticationProvider.prototype._openLoginRequest=function(e,t){e.open("GET",t,!0),r.data.Session._setNoCacheHeaders(e)},r.data.AuthenticationProvider.prototype._processLoginResult=function(e,t){var s;200===e.status?(this._loggedIn=!0,this._storeInfo(),s=r.data.Session.SUCCESS):s=401===e.status?r.data.Session.AUTHENTICATION_FAILURE:r.data.Session.GENERAL_FAILURE,this._settlePromise(t,s,{xhr:e})},r.data.AuthenticationProvider.prototype.logout=function(){var e=$.Deferred();return this._reset(),e.resolve(this,r.data.Session.SUCCESS,{}),e.promise()},r.data.AuthenticationProvider.prototype.hasClientCredentials=function(){return this._loggedIn},r.data.AuthenticationProvider.prototype.hasRefreshToken=function(){return!1},r.data.AuthenticationProvider.prototype._openRequestAndAuthorize=function(e,t,s,i,o){var a;this.hasClientCredentials()?(e.open(t,s,i),e.setRequestHeader("Accept","application/json")):a=new Error(r.data._getMsgText("jsdoMSG125","AuthenticationProvider")),o(a)},r.data.AuthenticationProvider.prototype._initialize=function(e,t,s){var i,o;for(o in Object.defineProperty(this,"uri",{get:function(){return this._uri},enumerable:!0}),Object.defineProperty(this,"authenticationModel",{get:function(){return this._authenticationModel},enumerable:!0}),i="/"===e[e.length-1]?e.substring(0,e.length-1):e,s)s.hasOwnProperty(o)&&(this[o]=i+s[o]);if(this._authenticationModel=t,this._uri=e,this._loggedIn=!1,this._dataKeys={uri:".uri",loggedIn:".loggedIn"},"undefined"==typeof sessionStorage)throw new Error(r.data._getMsgText("jsdoMSG126","AuthenticationProvider","sessionStorage"));this._storage=sessionStorage,this._storageKey=this._uri,this._dataKeys.uri=this._storageKey+this._dataKeys.uri,this._dataKeys.loggedIn=this._storageKey+this._dataKeys.loggedIn,this._retrieveLoggedIn()&&(this._loggedIn=!0)},r.data.AuthenticationProvider.prototype._storeInfo=function(){this._storage.setItem(this._dataKeys.uri,JSON.stringify(this._uri)),this._storage.setItem(this._dataKeys.loggedIn,JSON.stringify(this._loggedIn))},r.data.AuthenticationProvider.prototype._retrieveInfoItem=function(e){var t=this._storage.getItem(e),s=null;if(null!==t)try{s=JSON.parse(t)}catch(e){s=null}return s},r.data.AuthenticationProvider.prototype._retrieveURI=function(){return this._retrieveInfoItem(this._dataKeys.uri)},r.data.AuthenticationProvider.prototype._retrieveLoggedIn=function(){return this._retrieveInfoItem(this._dataKeys.loggedIn)},r.data.AuthenticationProvider.prototype._clearInfo=function(e){this._storage.removeItem(this._dataKeys.uri),this._storage.removeItem(this._dataKeys.loggedIn)},r.data.AuthenticationProvider.prototype._reset=function(){this._clearInfo(),this._loggedIn=!1},r.data.AuthenticationProvider.prototype._settlePromise=function(e,t,s){t===r.data.Session.SUCCESS?e.resolve(this,t,s):e.reject(this,t,s)},r.data.AuthenticationProvider.prototype._checkStringArg=function(e,t,s,i){if("string"!=typeof t)throw new Error(r.data._getMsgText("jsdoMSG121","AuthenticationProvider",s,"string",e));if(0===t.length)throw new Error(r.data._getMsgText("jsdoMSG501","AuthenticationProvider",i,e))},r.data.AuthenticationProvider._getAuthFailureReason=function(e){var t,s=r.data.Session.AUTHENTICATION_FAILURE;return 401===e.status?(t=e.getResponseHeader("Content-Type"))&&t.indexOf("application/json")>-1&&e.responseText&&"sso.token.expired_token"===JSON.parse(e.responseText).error&&(s=r.data.Session.EXPIRED_TOKEN):s=null,s},Object.defineProperty(r.data.AuthenticationProvider,"_homeLoginURIBase",{value:"/static/home.html",enumerable:!0}),Object.defineProperty(r.data.AuthenticationProvider,"_springLoginURIBase",{value:"/static/auth/j_spring_security_check",enumerable:!0}),Object.defineProperty(r.data.AuthenticationProvider,"_springLogoutURIBase",{value:"/static/auth/j_spring_security_logout",enumerable:!0}),Object.defineProperty(r.data.AuthenticationProvider,"_springFormTokenLoginURIBase",{value:r.data.AuthenticationProvider._springLoginURIBase+"?OECP=yes",enumerable:!0}),Object.defineProperty(r.data.AuthenticationProvider,"_springFormTokenRefreshURIBase",{value:"/static/auth/token?op=refresh",enumerable:!0})}()},function(e,t,s){var{default:r}=s(0),i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){var e=["none","create","read","update","delete","submit"],t=["","created","","modified","deleted"];void 0===r&&(r={}),void 0===r.data&&(r.data={}),r.data._nextid=0,r.data._uidprefix=""+(Date.now?Date.now():(new Date).getTime());r.data._getNextId=function(){var e=++r.data._nextid;return e>=999999999999999&&(r.data._nextid=e=1,r.data._uidprefix=""+(Date.now?Date.now():(new Date).getTime())),r.data._uidprefix+"-"+e};var s={msgs:{}};s.msgs.jsdoMSG000="JSDO, Internal Error: {1}",s.msgs.jsdoMSG001="JSDO: JSDO has multiple tables. Please use {1} at the table reference level.",s.msgs.jsdoMSG002="JSDO: Working record for '{1}' is undefined.",s.msgs.jsdoMSG003="JSDO: {1} function requires a function as a parameter.",s.msgs.jsdoMSG004="JSDO: Unable to find resource '{1}' in the catalog.",s.msgs.jsdoMSG005="JSDO: Data for table '{1}' was not specified in addRecords() call.",s.msgs.jsdoMSG006="JSDO: Data for JSDO was not specified in addRecords() call.",s.msgs.jsdoMSG007="JSDO: Test function in {1} must return a boolean.",s.msgs.jsdoMSG008="JSDO: Invalid keyFields parameter in addRecords() call.",s.msgs.jsdoMSG009="JSDO: KeyField '{1}' in addRecords() call was not found in the schema.",s.msgs.jsdoMSG010="JSDO: Field '{1}' in relationship was not found in the schema.",s.msgs.jsdoMSG011="UIHelper: JSDO has multiple tables. Please use {1} at the table reference level.",s.msgs.jsdoMSG012="UIHelper: Invalid {2} parameter in {1} call.",s.msgs.jsdoMSG020="JSDO: tableName parameter must be a string in addRecords() call.",s.msgs.jsdoMSG021="JSDO: addMode parameter must be specified in addRecords() call.",s.msgs.jsdoMSG022="JSDO: Invalid addMode specified in addRecords() call.",s.msgs.jsdoMSG023="JSDO: Duplicate found in addRecords() call using APPEND mode.",s.msgs.jsdoMSG024="{1}: Unexpected signature in call to {2} function.",s.msgs.jsdoMSG025="{1}: Invalid parameters in call to {2} function.",s.msgs.jsdoMSG026="JSDO: saveChanges requires a CREATE, UPDATE, DELETE or SUBMIT operation to be defined.",s.msgs.jsdoMSG030="JSDO: Invalid {1}, expected {2}.",s.msgs.jsdoMSG031="JSDO: Specified sort field name '{1}' was not found in the schema.",s.msgs.jsdoMSG032="JSDO: Before-image data already exists for record in addRecords() call.",s.msgs.jsdoMSG033="{1}: Invalid signature for {2}. {3}",s.msgs.jsdoMSG034="JSDO: In '{1}' function, JSON data is missing _id",s.msgs.jsdoMSG035="JSDO: In '{1}' function, before-image JSON data is missing prods:clientId",s.msgs.jsdoMSG036="JSDO: '{1}' can only be called for a dataset",s.msgs.jsdoMSG037="{1}: Event name must be provided for {2}.",s.msgs.jsdoMSG038="Too few arguments. There must be at least {1}.",s.msgs.jsdoMSG039="The name of the event is not a string.",s.msgs.jsdoMSG040="The event listener is not a function.",s.msgs.jsdoMSG041="The event listener scope is not an object.",s.msgs.jsdoMSG042="'{1}' is not a defined event for this object.",s.msgs.jsdoMSG043="{1}: A session object was requested to check the status of a Mobile Service named '{2}', but it has not loaded the definition of that service.",s.msgs.jsdoMSG044="JSDO: In '{1}' function, {2} is missing {3} property.",s.msgs.jsdoMSG045="JSDO: {1} function: {2} is missing {3} property.",s.msgs.jsdoMSG046="JSDO: {1} operation is not defined.",s.msgs.jsdoMSG047="{1} timeout expired.",s.msgs.jsdoMSG048="{1}: {2} method has argument '{3}' that is missing property '{4}'.",s.msgs.jsdoMSG049="{1}: Unexpected error calling {2}: {3}",s.msgs.jsdoMSG050="No token returned from server",s.msgs.jsdoMSG051="{1} The login method was not executed because the AuthenticationProvider is already logged in.",s.msgs.jsdoMSG052="{1}: The login method was not executed because no credentials were supplied.",s.msgs.jsdoMSG053="{1}: {2} was not executed because the AuthenticationProvider is not logged in.",s.msgs.jsdoMSG054="{1}: Token refresh was not executed because the AuthenticationProvider does not have a refresh token.",s.msgs.jsdoMSG055="{1}: Token refresh was not executed  because the authentication model is not sso.",s.msgs.jsdoMSG056="{1}: Already logged in.",s.msgs.jsdoMSG057="{1}: Cannot call {2} when authenticationModel is SSO. Please use the AuthenticationProvider object instead.",s.msgs.jsdoMSG058="{1}: Cannot pass username and password to addCatalog when authenticationModel is sso. Pass an AuthenticationProvider instead.",s.msgs.jsdoMSG059="{1}: Error in constructor. The authenticationModels of the AuthenticationProvider ({2}) and the JSDOSession ({3}) were not compatible.",s.msgs.jsdoMSG060="AuthenticationProvider: AuthenticationProvider is no longer logged in. Tried to refresh SSO token but failed due to authentication error at token server.",s.msgs.jsdoMSG061="{1}: Attempted to set {2} property to an invalid value.",s.msgs.jsdoMSG100="JSDO: Unexpected HTTP response. Too many records.",s.msgs.jsdoMSG101="Network error while executing HTTP request.",s.msgs.jsdoMSG110="Catalog error: idProperty not specified for resource '{1}'. idProperty is required {2}.",s.msgs.jsdoMSG111="Catalog error: Schema '{1}' was not found in catalog.",s.msgs.jsdoMSG112="Catalog error: Output parameter '{1}' was not found for operation '{2}'.",s.msgs.jsdoMSG113="Catalog error: Found xType '{1}' for output parameter '{2}' for operation '{3}' but xType DATASET, TABLE or ARRAY was expected.",s.msgs.jsdoMSG114="JSDO: idProperty '{1}' is missing from '{2}' record.",s.msgs.jsdoMSG115="JSDO: Invalid option specified in {1}() call.",s.msgs.jsdoMSG116="JSDO: {1} parameter must be a string in {2} call.",s.msgs.jsdoMSG117="JSDO: Schema from storage area '{1}' does not match JSDO schema",s.msgs.jsdoMSG118="JSDO: Plugin '{1}' was not found.",s.msgs.jsdoMSG119="JSDO: A mappingType is expected when 'capabilities' is set. Please specify a plugin (ex: JFP).",s.msgs.jsdoMSG120="JSDO: Parameter '{2}' requires capability '{1}' in the catalog.",s.msgs.jsdoMSG121="{1}: Argument {2} must be of type {3} in {4} call.",s.msgs.jsdoMSG122="{1}: Incorrect number of arguments in {2} call. There should be {3}.",s.msgs.jsdoMSG123="{1}: A server response included an invalid '{2}' header.",s.msgs.jsdoMSG124="JSDO: autoApplyChanges is not supported for saveChanges(true) with a temp-table. Use jsdo.autoApplyChanges = false.",s.msgs.jsdoMSG125="{1}: The AuthenticationProvider is not managing valid credentials.",s.msgs.jsdoMSG126="{1}: No support for {2}.",s.msgs.jsdoMSG127="JSDO: acceptRowChanges() cannot be called for record with _rejected === true.",s.msgs.jsdoMSG500="{1}: '{2}' objects must contain a '{3}' property.",s.msgs.jsdoMSG501="{1}: '{2}' in '{3}' function cannot be an empty string.",s.msgs.jsdoMSG502="{1}: The '{2}' parameter passed to the '{3}' function has an invalid value for its '{4}' property.",s.msgs.jsdoMSG503="{1}: '{2}' must be of type '{3}'.",s.msgs.jsdoMSG504="{1}: {2} has an invalid value for the '{3}' property.",s.msgs.jsdoMSG505="{1}: '{2}' objects must have a '{3}' method.",s.msgs.jsdoMSG506="{1}: Invalid argument for the {2} parameter in {3} call.",s.msgs.jsdoMSG507="{1}: '{2}' is an invalid value for the {3} parameter in {4} call.",s.msgs.jsdoMSG508="JSDOSession: If a JSDOSession object is using the SSO authentication model, the options object passed to its constructor must include an authProvider property.",s.msgs.jsdoMSG509="progress.data.getSession: If the authenticationModel is AUTH_TYPE_SSO, authenticationURI and authProviderAuthenticationModel are required parameters.",s.msgs.jsdoMSG510="{1}: This session has been invalidated and cannot be used.",s.msgs.jsdoMSG511="JSDOSession: addCatalog() can only be called if an AuthenticationProvider was passed as an argument or connect() has been successfully called.",s.msgs.jsdoMSG998="JSDO: JSON object in addRecords() must be DataSet or Temp-Table data.",s.getMsgText=function(e,t){var r,i=s.msgs[e];if(!i)throw new Error("Message text was not found by getMsgText()");for(r=1;r<arguments.length;r+=1)i=i.replace(new RegExp("\\{"+r+"\\}","g"),arguments[r]);return i},r.data._getMsgText=s.getMsgText,r.data.PluginManager={},r.data.PluginManager._plugins={},r.data.PluginManager.addPlugin=function(e,t){if(void 0!==r.data.PluginManager._plugins[e])throw new Error("A plugin named '"+e+"' is already registered.");r.data.PluginManager._plugins[e]=t},r.data.PluginManager.getPlugin=function(e){return r.data.PluginManager._plugins[e]},r.data.JSIndexEntry=function(e){this.index=e},r.data.JSTableRef=function(e,i){this._jsdo=e,this._name=i,this._schema=null,this._primaryKeys=null,this._fields=null,this._processed={},this._visited=!1,this.record=null,this._data=[],this._index={},this._hasEmptyBlocks=!1,this._beforeImage={},this._added=[],this._changed={},this._deleted=[],this._lastErrors=[],this._convertForServer,this._createIndex=function(){var e,t,i;for(this._index={},this._hasEmptyBlocks=!1,e=0;e<this._data.length;e+=1)if(this._data[e]){if(!(t=this._data[e]._id)){if("string"==typeof(i=this._jsdo._resource.idProperty)){if(!(t=this._data[e][i]))throw new Error(s.getMsgText("jsdoMSG114",i,this._name));t+=""}else t=r.data._getNextId();this._data[e]._id=t}this._index[t]=new r.data.JSIndexEntry(e)}else this._hasEmptyBlocks=!0;this._needCompaction=!1},this._compact=function(){var e,t,s=[];for(e=0;e<this._data.length;e+=1)(t=this._data[e])&&s.push(t);this._data=s,this._createIndex()},this._loadBeforeImageData=function(e,t,i){var o,a,n,d,h,l,c,f=e[this._jsdo._dataSetName]["prods:before"],_={};if(f&&f[this._name]){if(0!==Object.keys(this._beforeImage).length&&i&&0!==i.length)for(h in d={},this._beforeImage)(p=this._findById(h,!1))&&(d[n=this._getKey(p.data,i)]=p.data);for(S=0;S<f[this._name].length;S++)if(_[(o=f[this._name][S])["prods:id"]]=o,"deleted"==o["prods:rowState"]){if(n=void 0,i&&0!==i.length&&(n=this._getKey(o,i)),d&&void 0!==d[n])throw new Error(s.getMsgText("jsdoMSG032"));if(void 0===l&&i&&0!==i.length){l={},c={};for(var u=0;u<this._data.length;u++){if(a=this._data[u])l[this._getKey(a,i)]=a}for(u=0;u<this._deleted.length;u++){if(a=this._deleted[u].data)c[this._getKey(a,i)]=a}}if(void 0!==n&&void 0!==(a=c[n]))continue;if(void 0!==n)if(void 0!==(a=l[n]))(p=this._findById(a._id,!1))&&p._remove(!1),o._id=a._id;void 0===o._id&&(o._id=r.data._getNextId());var g={};this._jsdo._copyRecord(this._tableRef,o,g),this._jsdo._deleteProdsProperties(g),this._beforeImage[o._id]=g;var p=new r.data.JSRecord(this,g);this._deleted.push(p)}}if(e[this._jsdo._dataSetName][this._name])for(var S=0;S<e[this._jsdo._dataSetName][this._name].length;S++)switch(o=e[this._jsdo._dataSetName][this._name][S],E=void 0,t&&o["prods:id"]&&(E=t[o["prods:id"]]),o["prods:rowState"]){case"created":void 0===E&&(E=o._id),void 0!==E&&(this._beforeImage[E]=null,this._added.push(E));break;case"modified":var m=_[o["prods:id"]];if(void 0===m&&(m={}),void 0===E&&(E=o._id),void 0!==E){m._id=o._id;g={};this._jsdo._copyRecord(this._tableRef,m,g),this._jsdo._deleteProdsProperties(g),this._beforeImage[E]=g,this._changed[E]=o,this._beforeImage[m._id]=g,this._changed[m._id]=o}break;case void 0:break;default:throw new Error(s.getMsgText("jsdoMSG030","rowState value in before-image data","'created' or 'modified'"))}var v=e[this._jsdo._dataSetName]["prods:errors"];if(v)for(S=0;S<v[this._name].length;S++){var T=v[this._name][S],E=t[T["prods:id"]];(p=this._findById(E,!1))&&(p.data._errorString=T["prods:error"])}_=null},this._clearData=function(){this._setRecord(null),this._data=[],this._index={},this._createIndex(),this._beforeImage={},this._added=[],this._changed={},this._deleted=[]},this.hasData=function(){var e;if(e=this._jsdo._nestChildren?this._getDataWithNestedChildren(this._data):this._getRelatedData(),this._hasEmptyBlocks)for(var t=0;t<e.length;t++){if(!e[t])return!0}return 0!==e.length},this.getData=function(e){var t,s,r,i,o;if(this._needCompaction&&this._compact(),e&&e.filter)throw new Error("Not implemented in current version");if(s=this._jsdo._nestChildren?this._getDataWithNestedChildren(this._data):this._getRelatedData(),this._hasEmptyBlocks){for(r=0,i=[],t=0;t<s.length;t+=1)(o=s[t])?i.push(o):r++;100*r/this._data.length>=20&&(this._needCompaction=!0),s=i}else if(e&&(e.sort||e.top)){for(i=[],t=0;t<s.length;t+=1)i.push(s[t]);s=i}if(e&&(e.sort||e.top)){if(e.sort){for(sortFields=[],t=0;t<e.sort.length;t+=1)field=e.sort[t].field,"desc"==e.sort[t].dir&&(field+=":DESC"),sortFields.push(field);var a=this._processSortFields(sortFields);a.sortFields&&a.sortFields.length>0&&(a.tableRef=this,s.sort(this._getCompareFn(a)))}e.top&&(void 0===e.skip&&(e.skip=0),s=s.splice(e.skip,e.top))}return s},this._recToDataObject=function(e,t){var s=[e],r=s;if(void 0===t&&(t=!1),this._jsdo._dataSetName){if((r={})[this._jsdo._dataSetName]={},r[this._jsdo._dataSetName][this._name]=s,t&&this._children.length>0){var i=this._findById(e._id,!1);if(i)for(var o=0;o<this._children.length;o++){var a=this._children[o];r[this._jsdo._dataSetName][a]=this._jsdo._buffers[a]._getRelatedData(i)}}}else this._jsdo._dataProperty&&((r={})[this._jsdo._dataProperty]=s);return r},this._recFromDataObject=function(e){var t={};return e&&(this._jsdo._dataSetName?e[this._jsdo._dataSetName]&&(t=e[this._jsdo._dataSetName][this._name]):this._jsdo._dataProperty?e[this._jsdo._dataProperty]&&(t=e[this._jsdo._dataProperty]):t=e.data?e.data:e),t instanceof Array?t[0]:t},this.getSchema=function(){return this._schema},this.setSchema=function(e){this._schema=e},this._getABLType=function(e){var t,s;for(s=this.getSchema(),t=0;t<s.length;t++)if(s[t].name==e)return s[t].ablType},this._getFormat=function(e){var t,s;for(s=this.getSchema(),t=0;t<s.length;t++)if(s[t].name==e)return s[t].format},this.add=function(e){return this._add(e,!0,!0)},this.create=this.add,this._add=function(e,t,i){void 0===t&&(t=!0),void 0===i&&(i=!0);var o,a,n,d={};void 0===e&&(e={});var h,l,c=this.getSchema();for(g=0;g<c.length;g++){var f=c[g].name;if("array"==c[g].type){if(d[f]=[],c[g].maxItems)for(var _=0;_<c[g].maxItems;_++)d[f][_]=this._jsdo._getDefaultValue(c[g]);for(void 0!==(o=e[f])&&(d[f]=o,delete e[f]),a=this._jsdo._getArrayField(f),d[f]||(d[f]=[]),_=0;_<c[g].maxItems;_+=1)void 0!==(o=e[n=a.name+(_+1)])&&(this._fields[n.toLowerCase()]||(delete e[a.name+(_+1)],"string"==typeof o&&"string"!=c[g].items.type&&(o=this._jsdo._convertType(o,c[g].items.type,null)),d[f][_]=o))}else d[f]=this._jsdo._getDefaultValue(c[g])}if(this._jsdo.useRelationships&&this._relationship&&this._parent){if(!this._jsdo._buffers[this._parent].record)throw new Error(s.getMsgText("jsdoMSG002",this._parent));for(_=0;_<this._relationship.length;_++)d[this._relationship[_].childFieldName]=this._jsdo._buffers[this._parent].record.data[this._relationship[_].parentFieldName]}for(var u in e)d[u]=e[u];if(void 0!==(l=this._jsdo._resource.idProperty)&&(h=d[l]),h?h+="":h=r.data._getNextId(),d._id=h,this.autoSort&&this._sortRecords&&(void 0!==this._sortFn||void 0!==this._sortObject.sortFields)){if(this._needsAutoSorting)this._data.push(d),this._sort();else{for(var g=0;g<this._data.length;g++){if(null!==this._data[g])if(-1==(this._sortFn?this._sortFn(d,this._data[g]):this._compareFields(d,this._data[g])))break}this._data.splice(g,0,d)}this._createIndex()}else this._data.push(d),this._index[d._id]=new r.data.JSIndexEntry(this._data.length-1);var p=new r.data.JSRecord(this,d);return i&&this._setRecord(p,!0),t&&(this._beforeImage[d._id]=null,this._added.push(d._id)),p},this._getRelatedData=function(e){var t=[];if(0===this._data.length)return t;if(void 0===e&&this._jsdo.useRelationships&&this._relationship&&this._parent&&!(e=this._jsdo._buffers[this._parent].record))throw new Error(s.getMsgText("jsdoMSG002",this._parent));if(e)for(var r=0;r<this._data.length;r++){if(this._data[r]){for(var i=!1,o=0;o<this._relationship.length&&(i=e.data[this._relationship[o].parentFieldName]==this._data[r][this._relationship[o].childFieldName]);o++);i&&t.push(this._data[r])}}else t=this._data;return t},this._getDataWithNestedChildren=function(e){for(var t=0;t<e.length;t++){var s=e[t];if(this._children&&this._children.length>0)for(var r=0;r<this._children.length;r++){var i=this._jsdo._buffers[this._children[r]];if(i._isNested){for(var o=0;o<i._data.length;o++){var a=i._data[o];if(a){for(var n=!1,d=0;d<i._relationship.length&&(n=s[i._relationship[d].parentFieldName]==a[i._relationship[d].childFieldName]);d++);n&&(s[i._name]||(s[i._name]=[]),s[i._name].push(a))}}i._hasNestedChild()&&i._getDataWithNestedChildren(s[i._name])}}}return e},this._findFirst=function(){if(this._jsdo.useRelationships&&this._relationship&&this._parent){if(this._jsdo._buffers[this._parent].record)for(var e=0;e<this._data.length;e++){if(this._data[e]){for(var t,s,i=!1,o=0;o<this._relationship.length&&(t=this._relationship[o].parentFieldName,s=this._relationship[o].childFieldName,i=this._jsdo._buffers[this._parent].record.data[t]==this._data[e][s]);o++);if(i)return new r.data.JSRecord(this,this._data[e])}}}else for(e=0;e<this._data.length;e++){if(this._data[e])return new r.data.JSRecord(this,this._data[e])}},this._setRecord=function(e,t){if(this.record=e||void 0,this._jsdo.useRelationships&&(t="boolean"==typeof t&&t,this._children&&this._children.length>0))for(var s=0;s<this._children.length;s++){var r=this._jsdo._buffers[this._children[s]];!t&&this.record&&r._relationship?r._setRecord(r._findFirst()):r._setRecord(void 0,t)}this._jsdo._defaultTableRef&&(this._jsdo.record=this.record)},this.assign=function(e){if(this.record)return this.record.assign(e);throw new Error(s.getMsgText("jsdoMSG002",this._name))},this.update=this.assign,this.remove=function(){if(this.record)return this.record._remove(!0);throw new Error(s.getMsgText("jsdoMSG002",this._name))},this._remove=function(e){if(this.record)return this.record._remove(e);throw new Error(s.getMsgText("jsdoMSG002",this._name))},this.getId=function(){return this.record?this.record.data._id:0},this.getErrors=function(){return this._lastErrors},this.getErrorString=function(){return this.record?this.record.data._errorString:0},this.findById=function(e){return this._findById(e,!0)},this._findById=function(e,t){if(void 0===t&&(t=!0),e&&this._index[e]){var s=this._data[this._index[e].index];return this.record=s?new r.data.JSRecord(this,s):null,t&&this._setRecord(this.record),this.record}return t&&this._setRecord(null),null},this.find=function(e){if("function"!=typeof e)throw new Error(s.getMsgText("jsdoMSG003","find()"));for(var t=this._getRelatedData(),i=0;i<t.length;i++){if(t[i]){this._setRecord(new r.data.JSRecord(this,t[i]));var o=e(this.record);if("boolean"!=typeof o)throw new Error(s.getMsgText("jsdoMSG007","find()"));if(o)return this.record}}return this._setRecord(null),null},this.foreach=function(e){if("function"!=typeof e)throw new Error(s.getMsgText("jsdoMSG003","foreach()"));var t=0;this._needCompaction&&this._compact();var i=this._getRelatedData();this._inforeach=!0;for(var o=0;o<i.length;o++){if(i[o]){this._setRecord(new r.data.JSRecord(this,i[o]));var a=e(this.record);if(void 0!==a&&!a)break}else t++}this._inforeach=!1,100*t/this._data.length>=20&&(this._needCompaction=!0)},this._equalRecord=function(t,s,r){for(var o,a=0;a<r.length;a++){var n=r[a],d=t[n],h=s[n];if(e[i].caseSensitive||(o=e[i]._fields[n.toLowerCase()])&&"string"==o.type&&(void 0!==d&&null!==d&&(d=d.toUpperCase()),void 0!==h&&null!==h&&(h=h.toUpperCase())),!(d==h))return!1}return!0},this._getKey=function(t,s){for(var r={},o=0;o<s.length;o++){var a=s[o],n=t[a];e[i].caseSensitive||(field=e[i]._fields[a.toLowerCase()],field&&"string"==field.type&&void 0!==n&&null!==n&&(n=n.toUpperCase())),r[a]=n}return JSON.stringify(r)},this._getCompareFn=function(e){return"function"==typeof e?function(t,s){if(null===t)return 1;if(null===s)return-1;var i=new r.data.JSRecord(this,t),o=new r.data.JSRecord(this,s);return e(i,o)}:function(t,s){var r=e.tableRef,i=e.sortFields;if(!(i instanceof Array))return 0;var o,a=e.sortAscending;if(null===t)return 1;if(null===s)return-1;for(var n=0;n<i.length;n++){var d=i[n],h=t[d],l=s[d];if(r.caseSensitive||(o=r._fields[d.toLowerCase()])&&"string"==o.type&&(void 0!==h&&null!==h&&(h=h.toUpperCase()),void 0!==l&&null!==l&&(l=l.toUpperCase())),h>l||void 0===h||null===h)return a[n]?1:-1;if(h<l||void 0===l&&null===l)return a[n]?-1:1}return 0}},this._sortObject={},this._sortObject.tableRef=this,this._sortObject.sortFields=void 0,this._sortObject.sortAscending=void 0,this._compareFields=this._getCompareFn(this._sortObject),this._sortRecords=!0,this._needsAutoSorting=!1,this._sortFn=void 0,"function"==typeof Object.defineProperty?(this._autoSort=!0,Object.defineProperty(this,"autoSort",{get:function(){return this._autoSort},set:function(e){e?(this._autoSort=!0,(this._sortFn||this._sortObject.sortFields)&&(this._sort(),this._createIndex())):this._autoSort=!1},enumerable:!0,writeable:!0}),this._caseSensitive=!1,Object.defineProperty(this,"caseSensitive",{get:function(){return this._caseSensitive},set:function(e){this._caseSensitive=!!e,this.autoSort&&this._sortObject.sortFields&&!this._sortFn&&(this._sort(),this._createIndex())},enumerable:!0,writeable:!0})):(this.autoSort=!0,this.caseSensitive=!1),this._processSortFields=function(e){var t={};if(e instanceof Array){t.sortFields=e,t.sortAscending=[],t.fields={};for(var r=0;r<t.sortFields.length;r++){var i,o,a;if("string"!=typeof t.sortFields[r])throw new Error(s.getMsgText("jsdoMSG030","sort field name","string element"));if(-1!=(i=t.sortFields[r].indexOf(":")))switch(o=t.sortFields[r].substring(0,i),t.sortFields[r].substring(i+1).toUpperCase()){case"ASCENDING":case"ASC":t.sortAscending[r]=!0;break;case"DESCENDING":case"DESC":t.sortAscending[r]=!1;break;default:throw new Error(s.getMsgText("jsdoMSG030","sort order '"+t.sortFields[r].substring(i+1)+"'","ASCENDING or DESCENDING"))}else o=t.sortFields[r],t.sortAscending[r]=!0;if("_id"!=o&&this._fields){if(!(a=this._fields[o.toLowerCase()]))throw new Error(s.getMsgText("jsdoMSG031",o));if("array"==a.type)throw new Error(s.getMsgText("jsdoMSG030","data type found in sort","scalar field"));o=a.name}t.sortFields[r]=o,t.fields[o]=o}}else t.sortFields=void 0,t.sortAscending=void 0,t.fields=void 0;return t},this.setSortFields=function(e){if(void 0===e||null===e)this._sortObject.sortFields=void 0,this._sortObject.sortAscending=void 0;else{if(!(e instanceof Array))throw new Error(s.getMsgText("jsdoMSG024","JSDO","setSortFields()"));var t=this._processSortFields(e);this._sortObject.sortFields=t.sortFields,this._sortObject.sortAscending=t.sortAscending,this._sortObject.fields=t.fields,this.autoSort&&(this._sort(),this._createIndex())}},this.setSortFn=function(e){if(e&&"function"!=typeof e)throw new Error(s.getMsgText("jsdoMSG030","parameter in setSortFn()","function parameter"));this._sortFn=e?this._getCompareFn(e):void 0,this.autoSort&&(this._sort(),this._createIndex())},this.sort=function(e){if(void 0===e||null===e)throw new Error(s.getMsgText("jsdoMSG025","JSDO","sort()"));if(1!==arguments.length||!(e instanceof Array)&&"function"!=typeof e)throw new Error(s.getMsgText("jsdoMSG024","JSDO","sort()"));if(e instanceof Array){var t=this._processSortFields(e);t.sortFields&&t.sortFields.length>0&&this._sort(t)}else this._sort(e);this._createIndex()},this._sort=function(e){(0!==arguments.length||this.autoSort&&(void 0!==this._sortFn||void 0!==this._sortObject.sortFields))&&(0===arguments.length?(this._sortFn?this._data.sort(this._sortFn):this._data.sort(this._compareFields),this._needsAutoSorting=!1):("function"==typeof e?this._data.sort(this._getCompareFn(e)):(e.tableRef=this,this._data.sort(this._getCompareFn(e))),this.autoSort&&(this._needsAutoSorting=!0)))},this.addRecords=function(e,t,s,r,i){this._jsdo._addRecords(this._name,e,t,s,r,i)},this.acceptChanges=function(){for(var e in this._beforeImage){if(null===this._beforeImage[e])null!==(t=this._findById(e,!1))&&this._jsdo._deleteProdsProperties(t.data,!0);else if(void 0!==this._changed[e]){var t;null!==(t=this._findById(e,!1))&&this._jsdo._deleteProdsProperties(t.data,!0)}}this._processed={},this._added=[],this._changed={},this._deleted=[],this._beforeImage={}},this.rejectChanges=function(){for(var e in this._beforeImage)null===this._beforeImage[e]?this._jsdo._undoCreate(this,e):void 0!==this._changed[e]?this._jsdo._undoUpdate(this,e,!0):this._jsdo._undoDelete(this,e,!0);this._processed={},this._added=[],this._changed={},this._deleted=[]},this.hasChanges=function(){return 0!==Object.keys(this._beforeImage).length},this.getChanges=function(){var e=[];for(var s in this._beforeImage){var i={rowState:"",record:null};null===this._beforeImage[s]?(i.rowState=t[r.data.JSDO._OP_CREATE],i.record=this._findById(s,!1)):void 0!==this._changed[s]?(i.rowState=t[r.data.JSDO._OP_UPDATE],i.record=this._findById(s,!1)):(i.rowState=t[r.data.JSDO._OP_DELETE],i.record=new r.data.JSRecord(this,this._beforeImage[s])),e.push(i)}return e},this._applyChanges=function(){for(var e in this._beforeImage){if(null===this._beforeImage[e])if(null!==(i=this._findById(e,!1)))i.data._rejected||void 0!==i.data._errorString?this._jsdo._undoCreate(this,e):i.acceptRowChanges();else{for(var t=!1,r=0;r<this._deleted.length&&!(t=this._deleted[r].data._id==e);r++);if(!t)throw new Error(s.getMsgText("jsdoMSG000","Created record appears to be deleted without a delete operation."))}else if(void 0!==this._changed[e]){var i;if(null!==(i=this._findById(e,!1)))i.data._rejected||void 0!==i.data._errorString?this._jsdo._undoUpdate(this,e):i.acceptRowChanges();else if(this._beforeImage[e]._rejected||void 0!==this._beforeImage[e]._errorString)this._jsdo._undoDelete(this,e);else{for(t=!1,r=0;r<this._deleted.length&&!(t=this._deleted[r].data._id==e);r++);if(!t)throw new Error(s.getMsgText("jsdoMSG000","Updated record appears to be deleted without a delete operation."))}}else(this._beforeImage[e]._rejected||void 0!==this._beforeImage[e]._errorString)&&this._jsdo._undoDelete(this,e)}this._processed={},this._added=[],this._changed={},this._deleted=[],this._beforeImage={}},this.acceptRowChanges=function(){if(this.record)return this.record.acceptRowChanges();throw new Error(s.getMsgText("jsdoMSG002",this._name))},this.rejectRowChanges=function(){if(this.record)return this.record.rejectRowChanges();throw new Error(s.getMsgText("jsdoMSG002",this._name))},this._hasNestedChild=function(){var e=!1;if(this._children.length>0)for(var t=0;t<this._children.length;t++)if(this._jsdo._buffers[this._children[t]]._isNested){e=!0;break}return e}},r.data.JSRecord=function(e,t){this._tableRef=e,this.data=t,this.getId=function(){return this.data._id?this.data._id:null},this.getErrorString=function(){return this.data._errorString},this._saveBeforeImageUpdate=function(){if(void 0===this._tableRef._beforeImage[this.data._id]){var e={};this._tableRef._jsdo._copyRecord(this._tableRef,this.data,e),this._tableRef._beforeImage[this.data._id]=e}void 0===this._tableRef._changed[this.data._id]&&(this._tableRef._changed[this.data._id]=this.data)},this._sortRecord=function(e){var t=this._tableRef._index[this.data._id].index,s=this._tableRef._data[t];if(this._tableRef.autoSort&&this._tableRef._sortRecords&&(void 0!==this._tableRef._sortFn||void 0!==this._tableRef._sortObject.sortFields)){if(this._tableRef._sortObject.fields)if("string"==typeof e){if(void 0===this._tableRef._sortObject.fields[e])return}else if(e instanceof Array){for(var r=!1,i=0;i<e.length;i++)if(void 0!==this._tableRef._sortObject.fields[e[i]]){r=!0;break}if(!r)return}if(this._tableRef._needsAutoSorting)this._tableRef._sort(),this._tableRef._createIndex();else{for(i=0;i<this._tableRef._data.length;i++){if(null!==this._tableRef._data[i])if(i!=t)if(-1==(this._tableRef._sortFn?this._tableRef._sortFn(s,this._tableRef._data[i]):this._tableRef._compareFields(s,this._tableRef._data[i])))break}i>t&&i--,i!=t&&(this._tableRef._data.splice(t,1),this._tableRef._data.splice(i,0,s),this._tableRef._createIndex())}}},this.assign=function(e){if(void 0===e)throw new Error(s.getMsgText("jsdoMSG024","JSDO","assign() or update()"));this._saveBeforeImageUpdate();var t,r,i,o,a,n,d=this._tableRef.getSchema();if(e){for(r=0;r<d.length;r+=1)if(void 0!==(o=e[t=d[r].name])&&("string"==typeof o&&"string"!=d[r].type&&(o=this._tableRef._jsdo._convertType(o,d[r].type,d[r].items?d[r].items.type:null)),this.data[t]=o),"array"===d[r].type)for(a=this._tableRef._jsdo._getArrayField(t),this.data[t]||(this.data[t]=[]),i=0;i<d[r].maxItems;i+=1)void 0!==(o=e[n=a.name+(i+1)])&&(this._tableRef._fields[n.toLowerCase()]||("string"==typeof o&&"string"!=d[r].items.type&&(o=this._tableRef._jsdo._convertType(o,d[r].items.type,null)),this.data[t][i]=o));this._sortRecord()}return!0},this.update=this.assign,this.remove=function(){return this._remove(!0)},this._remove=function(e){void 0===e&&(e=!0);var t=this._tableRef._index[this.data._id].index,s=this._tableRef._findById(this.data._id,!1);if(e){var r=this._tableRef._beforeImage[this.data._id];void 0===r?(this.data._index=t,this._tableRef._beforeImage[this.data._id]=this.data):r&&(r._index=t),this._tableRef._deleted.push(s)}return this._tableRef._data[t]=null,this._tableRef._hasEmptyBlocks=!0,delete this._tableRef._index[this.data._id],this._tableRef._setRecord(null),!0},this.acceptRowChanges=function(){var t=this.data._id;if(void 0!==this._tableRef._beforeImage[t]){if(this.data._rejected)throw new Error(s.getMsgText("jsdoMSG127"));if(null===this._tableRef._beforeImage[t]){for(var r=0;r<this._tableRef._added.length;r++)if(this._tableRef._added[r]==t){this._tableRef._added.splice(r,1);break}this._tableRef._jsdo._deleteProdsProperties(this.data,!0)}else if(void 0!==this._tableRef._changed[t])delete this._tableRef._changed[t],this._tableRef._jsdo._deleteProdsProperties(this.data,!0);else for(r=0;r<this._tableRef._deleted.length;r++)if(this._tableRef._deleted[r].data._id==t){this._tableRef._deleted.splice(r,1);break}delete e._beforeImage[t]}},this.rejectRowChanges=function(){var t=this.data._id;if(void 0!==this._tableRef._beforeImage[t]){if(null===this._tableRef._beforeImage[t]){this._tableRef._jsdo._undoCreate(this._tableRef,t);for(var s=0;s<this._tableRef._added.length;s++)if(this._tableRef._added[s]==t){this._tableRef._added.splice(s,1);break}}else if(void 0!==this._tableRef._changed[t])this._tableRef._jsdo._undoUpdate(this._tableRef,t,!0),delete this._tableRef._changed[t];else{this._tableRef._jsdo._undoDelete(this._tableRef,t,!0);for(s=0;s<this._tableRef._deleted.length;s++)if(this._tableRef._deleted[s].data._id==t){this._tableRef._deleted.splice(s,1);break}}delete e._beforeImage[t]}}},r.data.JSDO=function(t,o){var a={};if(void 0===r.data.Session)throw new Error("ERROR: You must include progress.session.js");a.subscribe=this.subscribe,this.subscribe=function(e){var t=Array.prototype.slice.call(arguments);if("string"==typeof e)switch(e.toLowerCase()){case"beforeread":t[0]="beforefill";break;case"afterread":t[0]="afterfill"}a.subscribe.apply(this,t)},this._defineProperty=function(e,t){Object.defineProperty(this._buffers[e],t,{get:function(){var e,s,i,o;return this.record?(s=t.indexOf(r.data.JSDO.ARRAY_INDEX_SEPARATOR))>0&&!this._fields[t.toLowerCase()]&&(e=t.substring(0,s),i=t.substring(s+r.data.JSDO.ARRAY_INDEX_SEPARATOR.length),o=this._fields[e.toLowerCase()],!isNaN(i)&&o&&"array"===o.type)?this.record.data[e][i-1]:this.record.data[t]:null},set:function(e){var s,i,o,a=t;if(this.record){this.record._saveBeforeImageUpdate();try{if((s=t.indexOf(r.data.JSDO.ARRAY_INDEX_SEPARATOR))>0&&!this._fields[t.toLowerCase()]&&(a=t.substring(0,s),i=t.substring(s+r.data.JSDO.ARRAY_INDEX_SEPARATOR.length),o=this._fields[a.toLowerCase()],!isNaN(i)&&o&&"array"===o.type))return void(this.record.data[a][i-1]=e);this.record.data[t]=e}finally{this.record._sortRecord(a)}}},enumerable:!0,writeable:!0})},this._buffers={},this._numBuffers=0,this._defaultTableRef=null,this._async=!0,this._dataProperty=null,this._dataSetName=null,this.operations=[],this.useRelationships=!0,this._session=null,this._needCompaction=!1,this._hasCUDOperations=!1,this._hasSubmitOperation=!1,this._useSubmit=!1,this.autoApplyChanges=!0,this._lastErrors=[],this._localStorage=null,this._convertForServer;var n=!1;if(!arguments[0])throw new Error("JSDO: Parameters are required in constructor.");if("string"==typeof arguments[0])this.name=arguments[0];else if("object"==i(arguments[0])){var d=arguments[0];for(var h in d)switch(h){case"autoFill":n=d[h];break;case"events":for(var l in this._events={},d[h])this._events[l.toLowerCase()]=d[h][l];break;case"dataProperty":this._dataProperty=d[h];break;default:this[h]=d[h]}}if(!this.name)throw new Error("JSDO: JSDO constructor is missing the value for 'name'");if(this._events){if("object"!==i(this._events))throw new Error("JSDO: JSDO constructor event object is not defined as an object");for(var c in this._events){var f=this._events[c];if(!(f instanceof Array))throw new Error("JSDO: JSDO constructor event object for "+c+" must be an array");f.forEach(function(e){if("object"!==(void 0===e?"undefined":i(e)))throw new Error("JSDO: JSDO constuctor event object for "+c+" is not defined as an object");if("function"!=typeof e.fn)throw new Error("JSDO: JSDO event listener for "+c+" is not a function.");if(e.scope&&"object"!==i(e.scope))throw new Error("JSDO: JSDO event listener scope for "+c+" is not an object.")})}}if(this.name){if(this._resource=r.data.ServicesManager.getResource(this.name),!this._resource)throw new Error(s.getMsgText("jsdoMSG004",this.name));if(this.url||(this.url=this._resource.url),!this._dataSetName&&this._resource._dataSetName)if(this._dataSetName=this._resource._dataSetName,this._resource.dataProperty){var _=this[this._resource.dataProperty]=new r.data.JSTableRef(this,this._resource.dataProperty);this._buffers[this._resource.dataProperty]=_}else for(var u in this._resource.fields){_=this[u]=new r.data.JSTableRef(this,u);this._buffers[u]=_}if(!this._dataProperty&&this._resource.dataProperty&&(this._dataProperty=this._resource.dataProperty),!this._dataSetName){u=this._dataProperty?this._dataProperty:"";this._buffers[u]=new r.data.JSTableRef(this,u),u&&(this[u]=this._buffers[u])}for(var g in this._resource.fn)this[g]=this._resource.fn[g].function;if(this._hasCUDOperations=void 0!==this._resource.generic.create||void 0!==this._resource.generic.update||void 0!==this._resource.generic.delete,this._hasSubmitOperation=void 0!==this._resource.generic.submit,!this._session){var p=r.data.ServicesManager.getService(this._resource.service.name);this._session=p._session,this._session._pushJSDOs(this)}}else this._buffers[""]=new r.data.JSTableRef(this,"");if(!this._session)throw new Error("JSDO: Unable to get user session for resource '"+this.name+"'");for(var S in this._buffers)this._buffers[S]._parent=null,this._buffers[S]._children=[],this._buffers[S]._relationship=null,this._buffers[S]._isNested=!1,this._defaultTableRef||(this._defaultTableRef=this._buffers[S]),this._numBuffers++;if(1!=this._numBuffers?this._defaultTableRef=null:this.record=null,"function"==typeof Object.defineProperty&&(this._caseSensitive=!1,Object.defineProperty(this,"caseSensitive",{get:function(){return this._caseSensitive},set:function(e){for(var t in this._caseSensitive=!!e,this._buffers)this._buffers[t].caseSensitive=this._caseSensitive},enumerable:!0,writeable:!0}),this._autoSort=!0,Object.defineProperty(this,"autoSort",{get:function(){return this._autoSort},set:function(e){for(var t in this._autoSort=!!e,this._buffers)this._buffers[t].autoSort=this._autoSort},enumerable:!0,writeable:!0})),this._properties={},"function"==typeof Object.defineProperty&&Object.defineProperty(this,"this._properties",{get:function(){return this._properties},enumerable:!1}),this._resource&&this._resource.fields){for(var S in this._buffers){this._buffers[S]._schema=this._resource.fields[S],this._buffers[S]._primaryKeys=this._resource.primaryKeys[S],this._buffers[S]._fields={};for(var m=this._buffers[S]._schema,v=0;v<m.length;v++)if(this._buffers[S]._fields[m[v].name.toLowerCase()]=m[v],void 0!==m[v].origName&&("string"!=typeof m[v].origName||""===m[v].origName.trim()))throw new Error(s.getMsgText("jsdoMSG504","JSDO","Field '"+m[v].name+"' in resource '"+this._resource.name+"'","origName"));if(this._buffers[S]._schema&&"function"==typeof Object.defineProperty)for(v=0;v<this._buffers[S]._schema.length;v++){var T=this._buffers[S]._schema[v].name,E=this._buffers[S]._schema[v];if(void 0===this._buffers[S][T]&&this._defineProperty(S,T),"array"===E.type)for(var R=0;R<E.maxItems;R+=1){var b=T+r.data.JSDO.ARRAY_INDEX_SEPARATOR+(R+1);this._buffers[S]._fields[b.toLowerCase()]||this._defineProperty(S,b)}}}this._defaultTableRef&&!this._defaultTableRef._schema&&this._resource.fields[""]&&(this._defaultTableRef._schema=this._resource.fields[""])}else this._defaultTableRef&&(this._defaultTableRef._schema=[]);if(this._numBuffers>1)for(var S in this._buffers){m=[];var O=!1;for(v=0;v<this._buffers[S]._schema.length;v++){(w=this._buffers[S]._schema[v]).items&&"array"==w.type&&w.items.$ref?this._buffers[w.name]&&(O=!0,this._buffers[w.name]._isNested=!0):m.push(w)}O&&(this._buffers[S]._schema=m)}if(this._resource&&this._resource.relations)for(v=0;v<this._resource.relations.length;v++){var y=this._resource.relations[v];if(y.childName&&y.parentName&&y.childName!==y.parentName){if(y.relationFields instanceof Array)for(R=0;R<y.relationFields.length;R++){var w;if(this._buffers[y.parentName]._fields){if(T=y.relationFields[R].parentFieldName,!(w=this._buffers[y.parentName]._fields[T.toLowerCase()]))throw new Error(s.getMsgText("jsdoMSG010",T));y.relationFields[R].parentFieldName=w.name}if(this._buffers[y.childName]._fields){if(T=y.relationFields[R].childFieldName,!(w=this._buffers[y.childName]._fields[T.toLowerCase()]))throw new Error(s.getMsgText("jsdoMSG010",T));y.relationFields[R].childFieldName=w.name}}this._buffers[y.childName]._parent=y.parentName,this._buffers[y.childName]._relationship=y.relationFields,this._buffers[y.parentName]._children.push(y.childName)}}this._getDefaultValue=function(e){var t,s,r,i,o=!1;if("string"===e.type&&e.format&&-1!==e.format.indexOf("date")&&e.default?o=!0:"array"===e.type&&e.ablType&&-1!=e.ablType.indexOf("DATE")&&e.default?o=!0:t=e.default,o)switch(e.default.toUpperCase()){case"NOW":t=(new Date).toISOString();break;case"TODAY":s=new Date,1===(r=String(s.getMonth()+1)).length&&(r="0"+r),1===(i=String(s.getDate())).length&&(i="0"+i),t=s.getFullYear()+"-"+r+"-"+i;break;default:t=e.default}return t},this._getArrayField=function(e,t,s){var i={};return i.name=e+r.data.JSDO.ARRAY_INDEX_SEPARATOR+(t>=0?t+1:""),i.value=s?s[t]:void 0,i},this.isDataSet=function(){return!!this._dataSetName},this._invokeComplete=function(e,t,s){s.async&&s.fnName&&e.trigger("afterInvoke",s.fnName,e,t,s),s.deferred&&(t?s.deferred.resolve(e,t,s):s.deferred.reject(e,t,s))},this._invokeSuccess=function(){},this._invokeError=function(){},this._httpRequest=function(e,t,s,r,i){if(!e&&((e=new XMLHttpRequest).onCompleteFn=this._invokeComplete,e.onSuccessFn=this._invokeSuccess,e.onErrorFn=this._invokeError,e.onreadystatechange=this.onReadyStateChangeGeneric,i.async&&i.fnName&&this.trigger("beforeInvoke",i.fnName,this,i),r&&this._resource&&this._resource.service)){var o=this._resource.service.useRequest;this._resource.service.settings&&void 0!==this._resource.service.settings.useRequest&&(o=this._resource.service.settings.useRequest),o&&(r={request:r})}return e.request=i,e.jsdo=this,i.jsdo=this,i.xhr=e,this._session._openRequest(e,t,s,i.async,function(){var t=null;r&&(e.setRequestHeader("Content-Type","application/json; charset=utf-8"),t=JSON.stringify(r));try{e.send(t)}catch(t){i.success=!1,i.exception=t,e.jsdo._session._checkServiceResponse(e,i.success,i)}}),i},this._getDataObject=function(){var e={};if(this._dataSetName){e[this._dataSetName]={};var t=this.useRelationships;try{for(var s in this.useRelationships=!1,this._buffers)e[this._dataSetName][s]=this._buffers[s].getData()}finally{this.useRelationships=t}}else{if(!this._dataProperty)return this.getData();e[this._dataProperty]=this.getData()}return e},this._getDataObjectAsNested=function(){var e={};if(this._dataSetName){e[this._dataSetName]={};try{for(var t in this._buffers){var r=this._buffers[t];if(!r._isNested){if(this._nestChildren=!1,r._children.length>0)for(var i=0;i<r._children.length;i++){if(this._buffers[r._children[i]]._isNested){this._nestChildren=!0;break}}e[this._dataSetName][t]=this._buffers[t].getData()}}}catch(e){throw new Error(s.getMsgText("jsdoMSG000",e.message))}finally{this._nestChildren=!1}}else{if(!this._dataProperty)return this.getData();e[this._dataProperty]=this.getData()}return e},this._unnestData=function(){var e,t,s;if(this._dataSetName)for(var r in this._buffers)if((t=this._buffers[r])._hasNestedChild())for(var i=0;i<t._data.length;i++){e=t._data[i];for(var o=0;o<t._children.length;o++)e[(s=this._buffers[t._children[o]])._name]&&delete e[s._name]}},this._recToDataObject=function(e,t){if(this._defaultTableRef)return this._defaultTableRef._recToDataObject(e,t);throw new Error(s.getMsgText("jsdoMSG001","_recToDataObject()"))},this._recFromDataObject=function(e){if(this._defaultTableRef)return this._defaultTableRef._recFromDataObject(e);throw new Error(s.getMsgText("jsdoMSG001","_recFromDataObject()"))},this.add=function(e){if(this._defaultTableRef)return this._defaultTableRef.add(e);throw new Error(s.getMsgText("jsdoMSG001","add() or create()"))},this.create=this.add,this.hasData=function(){for(var e in this._buffers)if(this._buffers[this._buffers[e]._name].hasData())return!0;return!1},this.getData=function(e){if(this._defaultTableRef)return this._defaultTableRef.getData(e);throw new Error(s.getMsgText("jsdoMSG001","getData()"))},this.getSchema=function(){if(this._defaultTableRef)return this._defaultTableRef.getSchema();throw new Error(s.getMsgText("jsdoMSG001","getSchema()"))},this.findById=function(e){if(this._defaultTableRef)return this._defaultTableRef.findById(e);throw new Error(s.getMsgText("jsdoMSG001","findById()"))},this._convertType=function(e,t,r){if("string"!=typeof e||null===t)return e;var i=e;try{if("array"==t){i=[];for(var o=(e=e.slice(1,e.length-1)).split(","),a=r&&"string"!=r,n=0;n<o.length;n++)i[n]=a?this._convertType(o[n],r,null):o[n]}else i="integer"==t?parseInt(e):"number"==t?parseFloat(e):e}catch(e){throw new Error(s.getMsgText("jsdoMSG000","Error converting string to native type: "+e.message))}return i},this.assign=function(e){if(this._defaultTableRef)return this._defaultTableRef.assign(e);throw new Error(s.getMsgText("jsdoMSG001","assign() or update()"))},this.update=this.assign,this.remove=function(){if(this._defaultTableRef)return this._defaultTableRef.remove();throw new Error(s.getMsgText("jsdoMSG001","remove()"))},this.getId=function(){if(this._defaultTableRef)return this._defaultTableRef.getId();throw new Error(s.getMsgText("jsdoMSG001","getId()"))},this.getErrors=function(){if(this._defaultTableRef)return this._defaultTableRef.getErrors();throw new Error(s.getMsgText("jsdoMSG001","getErrors()"))},this.getErrorString=function(){if(this._defaultTableRef)return this._defaultTableRef.getErrorString();throw new Error(s.getMsgText("jsdoMSG001","getErrorString()"))},this.find=function(e){if(this._defaultTableRef)return this._defaultTableRef.find(e);throw new Error(s.getMsgText("jsdoMSG001","find()"))},this.foreach=function(e){if(this._defaultTableRef)return this._defaultTableRef.foreach(e);throw new Error(s.getMsgText("jsdoMSG001","foreach()"))},this.setSortFields=function(e){if(this._defaultTableRef)return this._defaultTableRef.setSortFields(e);throw new Error(s.getMsgText("jsdoMSG001","setSortFields()"))},this.setSortFn=function(e){if(this._defaultTableRef)return this._defaultTableRef.setSortFn(e);throw new Error(s.getMsgText("jsdoMSG001","setSortFn()"))},this.sort=function(e){if(this._defaultTableRef)return this._defaultTableRef.sort(e);throw new Error(s.getMsgText("jsdoMSG001","sort()"))},this._clearErrors=function(){for(var e in this._lastErrors=[],this._buffers)this._buffers[e]._lastErrors=[]},this._setAllRecordsRejected=function(e){var t,s,r,i;if(e instanceof Object){if(e instanceof Array){for(var o in t=e,s=!1,this._allRecordsRejected=!1,this._someRecordsRejected=!1,this._buffers)this._buffers[o]._lastErrors.length>0&&(s=!0);if(s){for(this._allRecordsRejected=!0,this._someRecordsRejected=!0,i=0;i<t.length;i+=1)if(t[i].record&&!t[i].record.data._rejected)return void(this._allRecordsRejected=!1)}else if(t.length>0){for(this._allRecordsRejected=!0,this._someRecordsRejected=!1,r=!1,i=0;i<t.length;i+=1)t[i].record&&(t[i].record.data._rejected?this._someRecordsRejected=!0:r=!0);r&&!this._someRecordsRejected&&(this._allRecordsRejected=!1)}}else if(e.operations instanceof Array)if(e.operations.length>0&&!e.operations[0].success){for(this._allRecordsRejected=!0,this._someRecordsRejected=!0,i=0;i<e.operations.length;i+=1)if(e.operations[i].success)return void(this._allRecordsRejected=!1)}else for(this._allRecordsRejected=!1,this._someRecordsRejected=!1,i=0;i<e.operations.length;i+=1)if(!e.operations[i].success)return void(this._someRecordsRejected=!0)}else this._allRecordsRejected=e,this._someRecordsRejected=e},this.fill=function(){var e,t,o,a;if(this._clearErrors(),this._setAllRecordsRejected(void 0),0!==arguments.length){if("function"==typeof arguments[0])throw new Error(s.getMsgText("jsdoMSG024","JSDO","fill() or read()"));if((o=this.getMethodProperties("read"))&&o.mappingType&&!(a=r.data.PluginManager.getPlugin(o.mappingType)))throw new Error(s.getMsgText("jsdoMSG118",o.mappingType));if(null===arguments[0]||void 0===arguments[0])"";else if("string"==typeof arguments[0])e={filter:arguments[0]};else{if("object"!=i(arguments[0]))throw new Error(s.getMsgText("jsdoMSG025","JSDO","fill() or read()"));if(a)e="function"==typeof a.requestMapping?a.requestMapping(this,arguments[0],{operation:"read"}):arguments[0];else{if(o.capabilities)throw new Error(s.getMsgText("jsdoMSG119"));e=arguments[0]}}}else e=null;var n=new XMLHttpRequest,d={xhr:n,jsdo:this,objParam:e};if(n.request=d,n.jsdo=this,n.onSuccessFn=this._fillSuccess,n.onErrorFn=this._fillError,n.onCompleteFn=this._fillComplete,n.onreadystatechange=this.onReadyStateChangeGeneric,this.trigger("beforeFill",this,d),this._resource){if("function"!=typeof this._resource.generic.read)throw new Error("JSDO: READ operation is not defined.");n.objParam=e,this._resource.generic.read.call(this,n,this._async),n.request.deferred&&(t=n.request.deferred.promise())}else{this._session._openRequest(n,"GET",this.url,this._async);try{n.send(null)}catch(e){d.exception=e,n.jsdo._session._checkServiceResponse(n,d.success,d)}}return 0==d.success&&d.exception&&("function"==typeof n.onErrorFn&&n.onErrorFn(n.jsdo,d.success,d),n.jsdo._session._checkServiceResponse(n,d.success,d),"function"==typeof n.onCompleteFn&&n.onCompleteFn(n.jsdo,d.success,d)),t},this.read=this.fill,this._clearData=function(){for(var e in this._buffers)this._buffers[e]._clearData()},this._execGenericOperation=function(t,i,o,a,n,d){var h,l=new XMLHttpRequest;switch(o.xhr=l,o.jsdo=this,o.objParam=i,o.operation=t,l.jsdo=this,l.onCompleteFn=a,l.onSuccessFn=n,l.onErrorFn=d,l.onreadystatechange=this.onReadyStateChangeGeneric,l.request=o,this._convertRequestData(i),t){case r.data.JSDO._OP_READ:case r.data.JSDO._OP_CREATE:case r.data.JSDO._OP_UPDATE:case r.data.JSDO._OP_DELETE:case r.data.JSDO._OP_SUBMIT:h=e[t];break;default:throw new Error("JSDO: Unexpected operation "+t+" in HTTP request.")}if(this._resource){if("function"!=typeof this._resource.generic[h])throw new Error(s.getMsgText("jsdoMSG046",h.toUpperCase()));l.objParam=i,this._resource.generic[h](l,this._async)}},this._initConvertForServer=function(){var e,t,s;if(void 0===this._convertForServer)for(t in this._convertForServer=!1,this._buffers){for(s=this._buffers[t].getSchema(),this._buffers[t]._convertFieldsForServer=[],this._buffers[t]._convertForServer=!1,e=0;e<s.length;e++)s[e].ablType&&this._ablTypeNeedsConversion(s[e].ablType)&&this._buffers[t]._convertFieldsForServer.push({name:s[e].name,ablType:s[e].ablType});this._buffers[t]._convertFieldsForServer.length>0&&(this._convertForServer=!0,this._buffers[t]._convertForServer=!0)}},this._convertRequestData=function(e){var t,s;if(!1!==this._convertForServer)for(t in this._buffers)this._buffers[t]._convertForServer&&(e[this._dataSetName]?(e[this._dataSetName][t]&&this._convertTableData(this._buffers[t],e[this._dataSetName][t]),(s=e[this._dataSetName]["prods:before"])&&s[t]&&this._convertTableData(this._buffers[t],s[t])):e[t]&&this._convertTableData(this._buffers[t],e[t]))},this._convertTableData=function(e,t){var s;for(s=0;s<t.length;s++)this._convertRowData(e,t[s])},this._convertRowData=function(e,t){var s,r;for(s=0;s<e._convertFieldsForServer.length;s+=1)t[(r=e._convertFieldsForServer[s]).name]=this._convertField(t[r.name],r.ablType)},this._convertField=function(e,t){var r;if(void 0===e||null===e)return e;if(e instanceof Array){for(var i=[],o=0;o<e.length;o++)i[o]=this._convertField(e[o],t);return i}try{switch(t.toUpperCase()){case"DATE":case"DATETIME":if("string"==typeof e)r=e;else{if(!(e instanceof Date))throw new Error("Unexpected value for  "+t.toUpperCase()+".");r=this._convertDate(e,t.toUpperCase())}break;default:r=e}}catch(t){throw new Error(s.getMsgText("jsdoMSG000","Error in _convertField for value: "+e+". "+t.message))}return r},this._convertDate=function(e,t){var s=e;return"DATE"!==t&&"DATETIME"!==t||(s=r.util._pad(e.getFullYear(),4)+"-"+r.util._pad(e.getMonth()+1)+"-"+r.util._pad(e.getDate()),"DATETIME"===t&&(s=s+"T"+r.util._pad(e.getHours())+":"+r.util._pad(e.getMinutes())+":"+r.util._pad(e.getSeconds())+"."+r.util._pad(e.getMilliseconds(),3))),s},this._ablTypeNeedsConversion=function(e){var t=!1;switch(e.toUpperCase()){case"DATE":case"DATETIME":t=!0}return t},this._undefWorkingRecord=function(){for(var e in this._buffers)this._buffers[e]._setRecord(null)},this.saveChanges=function(e){var t;if(void 0===e)e=!1;else if("boolean"!=typeof e)throw new Error(s.getMsgText("jsdoMSG025","JSDO","saveChanges()"));if(this._useSubmit=e,this._checkThatJSDOHasRequiredOperations(),!this._dataSetName&&this._useSubmit&&this.autoApplyChanges)throw new Error(s.getMsgText("jsdoMSG124"));return this._initConvertForServer(),this._clearErrors(),this._setAllRecordsRejected(void 0),t={jsdo:this},this.trigger("beforeSaveChanges",this,t),e?this._syncDataSetForSubmit(t):this._dataSetName?this._syncDataSetForCUD():this._syncSingleTable()},this._checkThatJSDOHasRequiredOperations=function(){var e,t,i=!1,o=!1,a=!1;if(!this._hasCUDOperations&&!this._hasSubmitOperation)throw new Error(s.getMsgText("jsdoMSG026"));if(this._useSubmit){if(this._hasSubmitOperation)return;throw new Error(s.getMsgText("jsdoMSG046","SUBMIT"))}if(this._resource)for(e in this._buffers)if(t=this._buffers[e],!i&&t._deleted.length>0&&(this._confirmOperationExists(r.data.JSDO._OP_DELETE),i=!0),!o&&t._added.length>0&&(this._confirmOperationExists(r.data.JSDO._OP_CREATE),o=!0),!a&&Object.keys(t._changed).length>0&&(this._confirmOperationExists(r.data.JSDO._OP_UPDATE),a=!0),i&&o&&a)break},this._confirmOperationExists=function(t){var r=e[t];if("function"!=typeof this._resource.generic[r])throw new Error(s.getMsgText("jsdoMSG046",r.toUpperCase()))},this.invoke=function(e,t){var s=this[e](t);if(s.deferred)return s.deferred.promise()},this._syncTableRef=function(e,t,i){var o,a,n;if(!t._visited){switch(t._visited=!0,i?i.operations||(i.operations=[]):i={operations:[]},e){case r.data.JSDO._OP_CREATE:for(var d=0;d<t._added.length;d++){var h=t._added[d];if((_=t._findById(h,!1))&&!t._processed[h]){if(t._processed[h]=_.data,o={},n={},t._jsdo._copyRecord(t,_.data,o),this.isDataSet())if(this._useBeforeImage("create"))n[this._dataSetName]={},(u=n[this._dataSetName])["prods:hasChanges"]=!0,u[t._name]=[],o["prods:rowState"]="created",o["prods:clientId"]=_.data._id,delete o._id,u[t._name].push(o);else n[t._name]=[],n[t._name].push(o);else n=o;var l={operation:e,batch:i,jsrecord:_,jsdo:this};i.operations.push(l),_._tableRef.trigger("beforeCreate",this,_,l),this.trigger("beforeCreate",this,_,l),this._execGenericOperation(r.data.JSDO._OP_CREATE,n,l,this._createComplete,this._createSuccess,this._createError)}}break;case r.data.JSDO._OP_UPDATE:for(var h in t._changed){if((_=t._findById(h,!1))&&!t._processed[h]){t._processed[h]=_.data,o={},n={},a={},t._jsdo._copyRecord(t,_.data,o);var c=!1;if(this.isDataSet())if(this._useBeforeImage("update"))c=!0,n[this._dataSetName]={},(u=n[this._dataSetName])["prods:hasChanges"]=!0,u[t._name]=[],o["prods:id"]=_.data._id,o["prods:rowState"]="modified",o["prods:clientId"]=_.data._id,delete o._id,u[t._name].push(o),u["prods:before"]={},(g=u["prods:before"])[t._name]=[],(p={})["prods:id"]=_.data._id,t._jsdo._copyRecord(t,t._beforeImage[_.data._id],p),delete p._id,g[t._name].push(p);if(!c){if(this._resource.service&&this._resource.service.settings&&this._resource.service.settings.sendOnlyChanges){if(t._jsdo._copyRecord(t,_.data,a,t._beforeImage[_.data._id]),!this._resource.idProperty)throw new Error(s.getMsgText("jsdoMSG110",this._resource.name," for sendOnlyChanges property"));a[this._resource.idProperty]=_.data[this._resource.idProperty]}else a=o;this.isDataSet()?(n[t._name]=[],n[t._name].push(a)):n=o}l={jsrecord:_,operation:e,batch:i,jsdo:this};i.operations.push(l),_._tableRef.trigger("beforeUpdate",this,_,l),this.trigger("beforeUpdate",this,_,l),this._execGenericOperation(r.data.JSDO._OP_UPDATE,n,l,this._updateComplete,this._updateSuccess,this._updateError)}}}for(d=0;d<t._children.length;d++){var f=t._children[d];this._syncTableRef(e,this._buffers[f],i)}if(e==r.data.JSDO._OP_DELETE)for(d=0;d<t._deleted.length;d++){var _;h=t._deleted[d]._id;if(_=t._deleted[d]){t._processed[h]=_.data,o={},n={},a={},t._jsdo._copyRecord(t,_.data,o);var u,g,p;c=!1;if(this.isDataSet())if(this._useBeforeImage("delete"))c=!0,n[this._dataSetName]={},(u=n[this._dataSetName])["prods:hasChanges"]=!0,u["prods:before"]={},(g=u["prods:before"])[t._name]=[],(p={"prods:rowState":"deleted"})["prods:clientId"]=_.data._id,t._jsdo._copyRecord(t,t._beforeImage[o._id],p),g[t._name].push(p);if(!c){if(this._resource.service&&this._resource.service.settings&&this._resource.service.settings.sendOnlyChanges){if(!this._resource.idProperty)throw new Error(s.getMsgText("jsdoMSG110",this._resource.name," for sendOnlyChanges property"));a[this._resource.idProperty]=_.data[this._resource.idProperty]}else a=o;this.isDataSet()?(n[t._name]=[],n[t._name].push(a)):n=o}l={batch:i,jsrecord:_,operation:e,jsdo:this};i.operations.push(l),_._tableRef.trigger("beforeDelete",this,_,l),this.trigger("beforeDelete",this,_,l),this._execGenericOperation(r.data.JSDO._OP_DELETE,n,l,this._deleteComplete,this._deleteSuccess,this._deleteError)}}}},this._useBeforeImage=function(e){for(var t=0;t<this._resource.operations.length;t++)if(this._resource.operations[t].type==e)return this._resource.operations[t].useBeforeImage;return!1},this._syncDataSetForCUD=function(){var e,t,s={operations:[]};for(var i in"function"==typeof $&&"function"==typeof $.Deferred&&(t=(e=$.Deferred()).promise(),s.deferred=e),this._buffers)this._buffers[i]._visited=!1;for(var i in this._buffers){var o=this._buffers[i];this._syncTableRef(r.data.JSDO._OP_DELETE,o,s)}for(var i in this._buffers)this._buffers[i]._visited=!1;for(var i in this._buffers){o=this._buffers[i];this._syncTableRef(r.data.JSDO._OP_CREATE,o,s)}for(var i in this._buffers)this._buffers[i]._visited=!1;for(var i in this._buffers){o=this._buffers[i];this._syncTableRef(r.data.JSDO._OP_UPDATE,o,s)}if(this.autoApplyChanges)for(var i in this._buffers){(o=this._buffers[i])._processed={},o._added=[],o._changed={},o._deleted=[]}if(!this._async&&this._isBatchComplete(s)){var a=this._isBatchSuccess(s),n={batch:s,success:a};this._undefWorkingRecord(),this._lastErrors=[],!a&&s.operations&&this._updateLastErrors(this,s,null),this._setAllRecordsRejected(s),this._fireAfterSaveChanges(a,n)}return t},this._syncSingleTable=function(){var e,t;if(this._defaultTableRef){var i=this._defaultTableRef,o={operations:[]};"function"==typeof $&&"function"==typeof $.Deferred&&(t=(e=$.Deferred()).promise(),o.deferred=e);for(var a=!1,n={},d=0;d<i._added.length;d++){n[c=i._added[d]]=c}for(d=0;d<i._deleted.length;d++){if(u=i._deleted[d])if(n[c=u.data._id]){var h={success:!0,xhr:void 0,operation:r.data.JSDO._OP_DELETE,batch:o,jsrecord:u,jsdo:this};o.operations.push(h),i._processed[c]=u.data;var l=h.jsdo;try{h.jsrecord._tableRef.trigger("afterDelete",l,h.jsrecord,h.success,h),l.trigger("afterDelete",l,h.jsrecord,h.success,h)}finally{h.complete=!0}a=!0}}n=null;for(d=0;d<i._deleted.length;d++){if(u=i._deleted[d]){var c=u.data._id;if(!i._processed[c]){i._processed[c]=u.data,a=!1,(g=new XMLHttpRequest).jsdo=this;h={xhr:g,operation:r.data.JSDO._OP_DELETE,batch:o,jsrecord:u,jsdo:this};o.operations.push(h),g.onCompleteFn=this._deleteComplete,g.onSuccessFn=this._deleteSuccess,g.onErrorFn=this._deleteError,g.onreadystatechange=this.onReadyStateChangeGeneric,g.request=h,u._tableRef.trigger("beforeDelete",this,u,h),this.trigger("beforeDelete",this,u,h);var f={};if(this._resource.service&&this._resource.service.settings&&this._resource.service.settings.sendOnlyChanges){if(!this._resource.idProperty)throw new Error(s.getMsgText("jsdoMSG110",this._resource.name," for sendOnlyChanges property"));f[this._resource.idProperty]=u.data[this._resource.idProperty]}else i._jsdo._copyRecord(i,u.data,f);if(i._convertForServer&&this._convertRowData(i,f),this._resource){if("function"!=typeof this._resource.generic.delete)throw new Error("JSDO: DELETE operation is not defined.");g.objParam=f,this._resource.generic.delete.call(this,g,this._async)}else{this._session._openRequest(g,"DELETE",this.url+"/"+c,!0);try{g.send(null)}catch(e){h.success=!1,h.exception=e,g.jsdo._session._checkServiceResponse(g,h.success,h)}}}}}for(d=0;d<i._added.length;d++){c=i._added[d],f={};if((u=i._findById(c,!1))&&!i._processed[c]){i._processed[c]=u.data,a=!1,(g=new XMLHttpRequest).jsdo=this;h={xhr:g,jsrecord:u,batch:o,operation:r.data.JSDO._OP_CREATE,jsdo:this};if(o.operations.push(h),g.onCompleteFn=this._createComplete,g.onSuccessFn=this._createSuccess,g.onErrorFn=this._createError,g.onreadystatechange=this.onReadyStateChangeGeneric,g.request=h,u._tableRef.trigger("beforeCreate",this,u,h),this.trigger("beforeCreate",this,u,h),this._resource){if("function"!=typeof this._resource.generic.create)throw new Error("JSDO: CREATE operation is not defined.");this._copyRecord(i,u.data,f),void 0!==this._resource.idProperty&&void 0!==u.data._id&&delete f._id,i._convertForServer&&this._convertRowData(i,f),g.objParam=f,this._resource.generic.create.call(this,g,this._async)}else{this._session._openRequest(g,"POST",this.url,!0),g.setRequestHeader("Content-Type","application/json; charset=utf-8"),this._copyRecord(i,u.data,f),i._convertForServer&&this._convertRowData(i,f);var _=JSON.stringify(f);try{g.send(_)}catch(e){h.success=!1,h.exception=e,g.jsdo._session._checkServiceResponse(g,h.success,h)}}}}for(var c in i._changed){var u;if((u=i._findById(c,!1))&&!i._processed[c]){i._processed[c]=u.data,a=!1;var g;h={xhr:g=new XMLHttpRequest,jsrecord:u,operation:r.data.JSDO._OP_UPDATE,batch:o,jsdo:this};g.request=h,g.jsdo=this,o.operations.push(h),g.onCompleteFn=this._updateComplete,g.onSuccessFn=this._updateSuccess,g.onErrorFn=this._updateError,g.onreadystatechange=this.onReadyStateChangeGeneric,u._tableRef.trigger("beforeUpdate",this,u,h),this.trigger("beforeUpdate",this,u,h);f={};if(this._resource.service&&this._resource.service.settings&&this._resource.service.settings.sendOnlyChanges){if(i._jsdo._copyRecord(i,u.data,f,i._beforeImage[u.data._id]),!this._resource.idProperty)throw new Error(s.getMsgText("jsdoMSG110",this._resource.name," for sendOnlyChanges property"));f[this._resource.idProperty]=u.data[this._resource.idProperty]}else i._jsdo._copyRecord(i,u.data,f);if(i._convertForServer&&this._convertRowData(i,f),this._resource){if("function"!=typeof this._resource.generic.update)throw new Error("JSDO: UPDATE operation is not defined.");g.objParam=f,this._resource.generic.update.call(this,g,this._async)}else{this._session._openRequest(g,"PUT",this.url+"/"+c,this._async),g.setRequestHeader("Content-Type","application/json; charset=utf-8");_=JSON.stringify(f);try{g.send(_)}catch(e){h.success=!1,h.exception=e,g.jsdo._session._checkServiceResponse(g,h.success,h)}}}}if(this.autoApplyChanges&&(i._added=[],i._changed={},i._deleted=[],i._processed={}),this._async||(a=!0),a){h={batch:o,success:!0};(l=this)._lastErrors=[],o.operations&&l._updateLastErrors(l,o,null),l._undefWorkingRecord(),l._fireAfterSaveChanges(h.success,h)}return t}},this._syncDataSetForSubmit=function(e){var t,s,i,o=this._saveChangesComplete,a=this._saveChangesSuccess,n=this._saveChangesError;return"function"==typeof $&&"function"==typeof $.Deferred&&(s=(t=$.Deferred()).promise(),e.deferred=t),e.jsrecords=[],this._dataSetName?i=this._createChangeSet(this._dataSetName,!1,e):(i=this._createTTChangeSet(this._defaultTableRef,e),a=this._saveChangesSuccessTT),this._execGenericOperation(r.data.JSDO._OP_SUBMIT,i,e,o,a,n),s},this._createChangeSet=function(e,t,s){var r={};r[e]={};var i=r[e];if(i["prods:hasChanges"]=this._hasChanges()){if(!0===t)for(var o in this._buffers)i[this._buffers[o]._name]=[];for(var o in this._buffers){var a=this._buffers[o];this._addDeletesToChangeSet(a,i,s)}for(var o in this._buffers){a=this._buffers[o];this._addCreatesToChangeSet(a,i,s)}for(var o in this._buffers){a=this._buffers[o];this._addChangesToChangeSet(a,i,s)}for(var o in this._buffers)this._buffers[o]._processed={}}var n=Object.keys(r[e]);if(1==n.length&&"prods:hasChanges"==n[0]){for(var o in this._buffers)i[this._buffers[o]._name]=[];i["prods:hasChanges"]=!1}return r},this._createTTChangeSet=function(e,t){var s,r,i,o,a={};if(a[e._name]=[],s=a[e._name],this._hasChanges()){for(r=0;r<e._added.length;r++)i=e._added[r],(o=e._findById(i,!1))&&(e._processed[o.data._id]||this._addRowToTTChangeSet(e,o,s,t,"beforeCreate"));for(i in e._changed)e._changed.hasOwnProperty(i)&&(o=e._findById(i,!1))&&(e._processed[o.data._id]||this._addRowToTTChangeSet(e,o,s,t,"beforeUpdate"));e._processed={}}return a},this._addRowToTTChangeSet=function(e,t,s,r,i){var o={};e._processed[t.data._id]=t.data,void 0!==r&&(r.jsrecords.push(t),t._tableRef.trigger(i,this,t,r),this.trigger(i,this,t,r)),e._jsdo._copyRecord(e,t.data,o),delete o._id,s.push(o)},this._createDataAndChangeSet=function(e){var t={};t[e]={};var s=t[e];for(var r in this._buffers)s[this._buffers[r]._name]=[];for(var r in this._hasChanges()&&(s["prods:hasChanges"]=!0),this._buffers){var i=this._buffers[r];this._addRecordsToObject(i,s)}for(var r in this._buffers){i=this._buffers[r];this._addDeletesToChangeSet(i,s)}for(var r in this._buffers)this._buffers[r]._processed={};return t},this._addRecordsToObject=function(e,t){e._data.length>0&&!t[e._name]&&(t[e._name]=[]);for(var s=0;s<e._data.length;s++){var r=e._data[s];if(r){if(!0===this._doesRecordHaveCreateBIData(e,r._id)){if(!(i=e._findById(r._id,!1)))continue;if(e._processed[i.data._id])continue;this._addCreatedRowToChangeSet(e,i,t)}if(!0===this._doesRecordHaveUpdateBIData(e,r._id)){var i;if(!(i=e._findById(r._id,!1)))continue;if(e._processed[i.data._id])continue;this._addChangedRowToChangeSet(e,i,t)}else{if(e._processed[r._id])continue;e._processed[r._id]=r;var o={};e._jsdo._copyRecord(e,r,o),delete o._id,t[e._name].push(o)}}}},this._doesRecordHaveCreateBIData=function(e,t){for(var s=0;s<e._added.length;s++)if(e._added[s]===t)return!0;return!1},this._doesRecordHaveUpdateBIData=function(e,t){for(var s in e._changed)if(s===t)return!0;return!1},this._hasChanges=function(){var e=!1;for(var t in this._buffers){var s=this._buffers[t],r=!1;for(var i in s._changed){r=!0;break}if(s._deleted.length>0||s._added.length>0||r){e=!0;break}}return e},this._addDeletesToChangeSet=function(e,t,s){for(var r=0;r<e._deleted.length;r++){var i=e._deleted[r];i&&(i.data&&void 0!==i.data._id&&null===e._beforeImage[i.data._id]||this._addDeletedRowToChangeSet(e,i,t,s))}},this._addDeletedRowToChangeSet=function(e,t,s,r){e._processed[t.data._id]=t.data,t.data["prods:rowState"]="deleted",void 0!==r&&(r.jsrecords.push(t),t._tableRef.trigger("beforeDelete",this,t,r),this.trigger("beforeDelete",this,t,r));var i={};i["prods:clientId"]=t.data._id,i["prods:rowState"]="deleted";var o=this._getTableInBeforeJsonObject(s,e._name);e._jsdo._copyRecord(e,e._beforeImage[t.data._id],i),delete i._id,o.push(i)},this._addCreatesToChangeSet=function(e,t,s){for(var r=0;r<e._added.length;r++){var i=e._added[r],o=e._findById(i,!1);o&&(e._processed[o.data._id]||this._addCreatedRowToChangeSet(e,o,t,s))}},this._addCreatedRowToChangeSet=function(e,t,s,r){e._processed[t.data._id]=t.data,s[e._name]||(s[e._name]=[]),t.data["prods:rowState"]="created",void 0!==r&&(r.jsrecords.push(t),t._tableRef.trigger("beforeCreate",this,t,r),this.trigger("beforeCreate",this,t,r));var i={};i["prods:clientId"]=t.data._id,i["prods:rowState"]="created",e._jsdo._copyRecord(e,t.data,i),delete i._id,s[e._name].push(i)},this._addChangesToChangeSet=function(e,t,s){for(var r in e._changed){var i=e._findById(r,!1);i&&(e._processed[i.data._id]||this._addChangedRowToChangeSet(e,i,t,s))}},this._addChangedRowToChangeSet=function(e,t,s,r){e._processed[t.data._id]=t.data,s[e._name]||(s[e._name]=[]),t.data["prods:rowState"]="modified",void 0!==r&&(r.jsrecords.push(t),t._tableRef.trigger("beforeUpdate",this,t,r),this.trigger("beforeUpdate",this,t,r));var i={};i["prods:id"]=t.data._id,i["prods:clientId"]=t.data._id,i["prods:rowState"]="modified",e._jsdo._copyRecord(e,t.data,i),delete i._id,s[e._name].push(i);var o=this._getTableInBeforeJsonObject(s,e._name),a={};a["prods:id"]=t.data._id,e._jsdo._copyRecord(e,e._beforeImage[t.data._id],a),o.push(a)},this._getTableInBeforeJsonObject=function(e,t){e["prods:before"]||(e["prods:before"]={});var s=e["prods:before"];return s[t]||(s[t]=[]),s[t]},this.addRecords=function(e,t,i,o,a){if(this.isDataSet()){if(e instanceof Array){if(!this._defaultTableRef)throw new Error(s.getMsgText("jsdoMSG998"))}else void 0!==e&&null!==e||(e={}),e[this._dataSetName]&&(e=e[this._dataSetName]);if(t!=r.data.JSDO.MODE_EMPTY&&0===Object.keys(e).length)throw new Error(s.getMsgText("jsdoMSG006"));var n=this.useRelationships;this.useRelationships=!1;try{for(var d in this._buffers)e[this._buffers[d]._name]?this._addRecords(this._buffers[d]._name,e,t,i,o,a):t==r.data.JSDO.MODE_EMPTY&&this._buffers[this._buffers[d]._name]._clearData()}finally{this.useRelationships=n}}else this._defaultTableRef&&this._addRecords(this._defaultTableRef._name,e,t,i,o,a)},this._copyRecord=function(e,t,s,r){for(var o in t)if(void 0===r||t[o]!=r[o])if(void 0===t[o]||null===t[o])s[o]=t[o];else if(t[o]instanceof Date)s[o]=t[o];else if("object"===i(t[o])){var a=t[o]instanceof Array?[]:{};this._copyRecord(e,t[o],a),s[o]=a}else s[o]=t[o]},this._deleteProdsProperties=function(e,t,s){void 0===t&&(t=!1),void 0===s&&(s=!0),e&&(delete e["prods:id"],delete e["prods:hasErrors"],delete e["prods:clientId"],delete e["prods:rejected"],delete e._rejected,s&&delete e["prods:rowState"],t&&delete e._errorString)},this._addRecords=function(e,t,o,a,n,d){var h=null,l=null;if(t&&void 0!==this._dataSetName&&(t[this._dataSetName]&&t[this._dataSetName]["prods:hasChanges"]?(h=t,l={}):t["prods:hasChanges"]&&((h={})[this._dataSetName]=t,l={})),"string"!=typeof e)throw new Error(s.getMsgText("jsdoMSG020"));if(!o)throw new Error(s.getMsgText("jsdoMSG021"));switch(o){case r.data.JSDO.MODE_APPEND:case r.data.JSDO.MODE_EMPTY:case r.data.JSDO.MODE_MERGE:case r.data.JSDO.MODE_REPLACE:break;default:throw new Error(s.getMsgText("jsdoMSG022"))}if(a?a instanceof Array||"object"!=(void 0===a?"undefined":i(a))||(a=a[e]?a[e]:[]):a=[],!(a instanceof Array))throw new Error(s.getMsgText("jsdoMSG008"));if(this._buffers[e]._fields)for(var c=0;c<a.length;c++){var f=this._buffers[e]._fields[a[c].toLowerCase()];if(void 0===f)throw new Error(s.getMsgText("jsdoMSG009",a[c]));a[c]=f.name}if(n=!!n,e){if(!(t instanceof Array)){var _=null;void 0!==t&&null!==t||(t={}),this.isDataSet()?t[this._dataSetName]?_=t[this._dataSetName][e]:t[e]&&(_=t[e]):this._dataProperty?_=t[this._dataProperty]:t.data&&(_=t.data),_ instanceof Array?(saveJsonObject=t,t=_):o==r.data.JSDO.MODE_EMPTY&&"object"==(void 0===t?"undefined":i(t))&&0===Object.keys(t).length?t=[]:o==r.data.JSDO.MODE_REPLACE&&"object"==(void 0===t?"undefined":i(t))&&h&&(t=[])}if(!(t instanceof Array))throw new Error(s.getMsgText("jsdoMSG005",e));var u=!1;try{if(this._buffers[e]._sortRecords=!1,0===a.length||o==r.data.JSDO.MODE_EMPTY){o==r.data.JSDO.MODE_EMPTY&&this._buffers[e]._clearData();for(c=0;c<t.length;c++){var g=this._buffers[e]._add(t[c],n,!1);t[c]._id=g.data._id,l&&t[c]["prods:id"]&&(l[t[c]["prods:id"]]=g.data._id),h&&this._deleteProdsProperties(g.data)}}else{var p;if(this._buffers[e]._data.length*t.length>=10){p={};for(c=0;c<this._buffers[e]._data.length;c++){if(v=this._buffers[e]._data[c])p[this._buffers[e]._getKey(v,a)]=v}}else p=null;var S=0!==Object.keys(this._buffers[e]._beforeImage).length;for(c=0;c<t.length;c++){var m=!1,v=null;if(p)m=void 0!==(v=p[this._buffers[e]._getKey(t[c],a)]);else for(var T=0;T<this._buffers[e]._data.length&&(!(v=this._buffers[e]._data[T])||!(m=this._buffers[e]._equalRecord(t[c],v,a)));T++);if(m){d&&void 0!==this._resource.idProperty&&void 0===t[c]._id&&(t[c]._id=v._id);var E=this._buffers[e]._beforeImage[v._id];if(S&&void 0!==t[c]["prods:id"]&&void 0!==E){var R=this._sameData(t[c],v),b=!0;if(E){var O=this._getBeforeRecordFromObject(t[c],h,e);O&&(b=this._sameData(O,E))}if(!R||!b)throw new Error(s.getMsgText("jsdoMSG032"))}switch(o){case r.data.JSDO.MODE_APPEND:throw new Error(s.getMsgText("jsdoMSG023"));case r.data.JSDO.MODE_MERGE:l&&t[c]["prods:id"]&&(l[t[c]["prods:id"]]=v._id);break;case r.data.JSDO.MODE_REPLACE:l&&t[c]["prods:id"]&&(l[t[c]["prods:id"]]=v._id),void 0===t[c]._id&&(t[c]._id=v._id),this._copyRecord(this._buffers[e],t[c],v),this._deleteProdsProperties(v)}}else{g=this._buffers[e]._add(t[c],n,!1);if(t[c]._id=g.data._id,l&&t[c]["prods:id"]&&(l[t[c]["prods:id"]]=g.data._id),h&&this._deleteProdsProperties(g.data),p)p[this._buffers[e]._getKey(g.data,a)]=g.data}}p=null}u=!0}finally{this._buffers[e]._sortRecords=!0,this._buffers[e]._sort(),this._buffers[e]._createIndex(),u&&h&&this._buffers[e]._loadBeforeImageData(h,l,a)}}},this._getBeforeRecordFromObject=function(e,t,s){var r,i=t[this._dataSetName]["prods:before"],o=e["prods:id"];if(!i)return r;for(var a=0;a<i[s].length;a++){var n=i[s][a];if(n["prods:id"]&&o==n["prods:id"]){r=n;break}}return r},this._sameData=function(e,t){var s,r;for(var i in e)if("prods"!=i.substring(0,5)&&"_id"!=i){if((s=e[i])>(r=t[i])||null===s)return!1;if(s<r||null===r)return!1}return!0},this._mergeRead=function(e,t){if(this.isDataSet())if(this._dataProperty){var s=this._buffers[this._dataProperty];s._data=e[this._dataSetName][this._dataProperty],s.autoSort&&s._sort(),s._createIndex()}else{for(var r in this._buffers){o=(o=e[this._dataSetName]?e[this._dataSetName][r]:null)||[],this._buffers[r]._data=o,this._buffers[r].autoSort&&this._buffers[r]._sort(),this._buffers[r]._createIndex(),e[this._dataSetName]&&e[this._dataSetName]["prods:hasChanges"]&&this._buffers[r]._loadBeforeImageData(e)}if(this._numBuffers>1)for(var r in this._buffers)if(this._buffers[r]._isNested&&this._buffers[r]._parent&&this._buffers[this._buffers[r]._parent]){for(var i=this._buffers[this._buffers[r]._parent]._data,o=[],a=0;a<i.length;a++)if(void 0!==i[a][r]){for(var n=0;n<i[a][r].length;n++)o.push(i[a][r][n]);delete i[a][r]}this._buffers[r]._data=o,this._buffers[r].autoSort&&this._buffers[r]._sort(),this._buffers[r]._createIndex()}}else e instanceof Array?this._defaultTableRef._data=e:this._dataProperty?this._defaultTableRef._data=e[this._dataProperty]:e.data?this._defaultTableRef._data=e.data:(this._defaultTableRef._data=[],this._defaultTableRef._data[0]=e);for(var r in this._buffers)this._buffers[r].autoSort&&this._buffers[r]._sort(),this._buffers[r]._createIndex()},this._mergeUpdateRecord=function(e,t,s){var i=e._index[t].index;if(s._id=t,e._data[i]||(e._data[i]={}),this._copyRecord(this._tableRef,s,e._data[i]),s=e._data[i],void 0!==e._jsdo._resource.idProperty){var o=e._data[i][e._jsdo._resource.idProperty];void 0!==o&&(delete e._index[t],o+="",e._index[o]=new r.data.JSIndexEntry(i),s._id=o)}return s},this._setErrorString=function(e,t,s,r){if(r)e._beforeImage[t]&&(e._beforeImage[t]._errorString=s);else{var i=e._index[t].index;e._data[i]._errorString=s}},this._arrayFromDataObject=function(e,t){var s;if(void 0!==e)return this._dataSetName?e[this._dataSetName]&&(s=e[this._dataSetName][t._name]):e instanceof Array?s=e:this._dataProperty?s=e[this._dataProperty]:e.data&&(s=e.data),s},this._mergeUpdateForCUD=function(e,t){var i,o=!1;if(this._dataSetName){var a=e[this._dataSetName],n=t.request.jsrecord._tableRef,d=this._arrayFromDataObject(e,n);if(d instanceof Array){if(d.length>1)throw t.request.success=!1,new Error(s.getMsgText("jsdoMSG100"));for(var h=0;h<d.length;h++){if(!(_=t.request.jsrecord.getId()))throw new Error(s.getMsgText("jsdoMSG034","_mergeUpdateForCUD()"));if(i=void 0,d[h]["prods:hasErrors"]){var l=d[h]["prods:id"];i=this._getErrorStringFromJsonObject(a,n,l),o=!0}var c=this._mergeUpdateRecord(n,_,d[h]);i&&this._setErrorString(n,_,i,!1),(d[h]["prods:rejected"]||i)&&(c._rejected=!0,"REJECTED"===i&&delete c._errorString),t.request.jsrecord=new r.data.JSRecord(n,c)}}}else{n=this._defaultTableRef;var f=this._arrayFromDataObject(e);if(f instanceof Array){if(f.length>1)throw t.request.success=!1,new Error(s.getMsgText("jsdoMSG100"));for(h=0;h<f.length;h++){var _;if(!(_=t.request.jsrecord.getId()))throw new Error(s.getMsgText("jsdoMSG034","_mergeUpdateForCUD()"));c=this._mergeUpdateRecord(n,_,f[h]);t.request.jsrecord=new r.data.JSRecord(n,c)}}}return o},this._checkForDeleteError=function(e,t){var r=!1,i=t.request.jsrecord._tableRef;if(beforeJsonObject=e["prods:before"],beforeJsonObject){var o=beforeJsonObject[i._name];if(o.length>1)throw t.request.success=!1,new Error(s.getMsgText("jsdoMSG100"));var a=o[0]["prods:clientId"];if(!a)throw new Error(s.getMsgText("jsdoMSG035","_checkForDeleteError()"));if(o[0]["prods:hasErrors"]){var n=o[0]["prods:id"],d=this._getErrorStringFromJsonObject(e,i,n);this._setErrorString(i,a,d,!0),r=!0}}return r},this._mergeUpdateForSubmit=function(e,t){if(!this._dataSetName)throw new Error(s.getMsgText("jsdoMSG036","_mergeUpdateForSubmit()"));var r=e[this._dataSetName];r[this._dataSetName]&&(r=r[this._dataSetName]);var i=r["prods:before"];for(var o in this._buffers){var a=r[(f=this._buffers[o])._name];if(a instanceof Array)for(var n=0;n<a.length;n++){if(!(g=a[n]["prods:clientId"]))throw new Error(s.getMsgText("jsdoMSG035","_mergeUpdateForSubmit()"));if(_=void 0,a[n]["prods:hasErrors"]){var d=a[n]["prods:id"];_=this._getErrorStringFromJsonObject(r,f,d)}var h=this._mergeUpdateRecord(f,g,a[n]);_&&this._setErrorString(f,g,_,!1),(a[n]["prods:rejected"]||_)&&(h._rejected=!0,"REJECTED"===_&&delete h._errorString);for(var l=t.request.jsrecords,c=0;c<l.length;c++)if(l[c].data._id==g){l[c].data=h;break}}}if(i)for(var o in this._buffers){var f,_,u=i[(f=this._buffers[o])._name];if(u instanceof Array)for(n=0;n<u.length;n++)if("deleted"==u[n]["prods:rowState"]){var g;if(!(g=u[n]["prods:clientId"]))throw new Error(s.getMsgText("jsdoMSG035","_mergeUpdateForSubmit()"));if(_=void 0,u[n]["prods:hasErrors"]){d=u[n]["prods:id"];_=this._getErrorStringFromJsonObject(r,f,d),this._setErrorString(f,g,_,!0)}(u[n]["prods:rejected"]||_)&&f._beforeImage[g]&&(f._beforeImage[g]._rejected=!0,"REJECTED"===_&&delete f._beforeImage[g]._errorString)}}},this._fireCUDTriggersForSubmit=function(e){for(var t=0;t<e.jsrecords.length;t++)this._deleteProdsProperties(e.jsrecords[t].data,!1,!1);for(t=0;t<e.jsrecords.length;t++){var s=e.jsrecords[t];switch(s.data["prods:rowState"]){case"created":s._tableRef.trigger("afterCreate",this,s,e.success,e),this.trigger("afterCreate",this,s,e.success,e);break;case"modified":s._tableRef.trigger("afterUpdate",this,s,e.success,e),this.trigger("afterUpdate",this,s,e.success,e);break;case"deleted":s._tableRef.trigger("afterDelete",this,s,e.success,e),this.trigger("afterDelete",this,s,e.success,e)}}},this._getErrorStringFromJsonObject=function(e,t,s){var r,i=e["prods:errors"];if(i&&(r=i[t._name]),r instanceof Array)for(var o=0;o<r.length;o++){if(r[o]["prods:id"]===s){var a=r[o]["prods:error"];return null===a?"Server returned unspecified error. Please check log files.":a}}},this._fillSuccess=function(e,t,s){var i,o=s.xhr;if((i=e.getMethodProperties("read"))&&i.mappingType){if(mapping=r.data.PluginManager.getPlugin(i.mappingType),!mapping)throw new Error(r.data._getMsgText("jsdoMSG118",i.mappingType));"function"==typeof mapping.responseMapping&&(s.response=mapping.responseMapping(e,s.response,{operation:"read"}))}for(var a in e._clearData(),e._mergeRead(s.response,o),e._buffers)e._buffers[a]._parent&&e.useRelationships||e._buffers[a]._setRecord(e._buffers[a]._findFirst())},this._fillComplete=function(e,t,s){e.trigger("afterFill",e,s.success,s),s.deferred&&(t?s.deferred.resolve(e,t,s):s.deferred.reject(e,t,s))},this._fillError=function(e,t,s){e._clearData(),e._updateLastErrors(e,null,null,s)},this._undoCreate=function(e,t){var s=e._index[t];if(void 0!==s){var r=s.index;e._data[r]=null}e._hasEmptyBlocks=!0,delete e._index[t],delete e._beforeImage[t]},this._undoUpdate=function(e,t,s){void 0===s&&(s=!1);var r=e._beforeImage[t];if(r){var i=e._index[t].index;e._jsdo._copyRecord(e,r,e._data[i]),s&&e._jsdo._deleteProdsProperties(e._data[i],!0)}delete e._beforeImage[t]},this._undoDelete=function(e,t,s){void 0===s&&(s=!1);var i=e._beforeImage[t];if(i){var o=i._index;delete i._index,s&&e._jsdo._deleteProdsProperties(i,!0),void 0!==o&&null===e._data[o]?e._data[o]=i:(e._data.push(i),o=e._data.length-1),e._index[t]=new r.data.JSIndexEntry(o)}delete e._beforeImage[t]},this._deleteComplete=function(e,t,s){var r=s.xhr,i=s.jsrecord;try{e._deleteProdsProperties(i.data,!1),i._tableRef.trigger("afterDelete",e,i,s.success,s),e.trigger("afterDelete",e,i,s.success,s)}finally{s.complete=!0,e._checkSaveComplete(r)}},this._deleteSuccess=function(e,t,r){var i,o=r.xhr,a=r.response,n=null,d=null,h=!1;if(e._useBeforeImage("delete")?(n=(d=a[e._dataSetName])["prods:before"])&&(i=n[r.jsrecord._tableRef._name]):i=e._arrayFromDataObject(a,r.jsrecord._tableRef),i instanceof Array&&i.length>1)throw r.success=!1,new Error(s.getMsgText("jsdoMSG100"));n&&(h=e._checkForDeleteError(d,o)),h&&(r.success=!1),e.autoApplyChanges&&(h?e._deleteError(e,t,r):delete r.jsrecord._tableRef._beforeImage[r.jsrecord.data._id])},this._deleteError=function(e,t,s){e.autoApplyChanges&&e._undoDelete(s.jsrecord._tableRef,s.jsrecord.data._id)},this._createComplete=function(e,t,s){var r=s.xhr,i=s.jsrecord;try{e._deleteProdsProperties(i.data,!1),i._tableRef.trigger("afterCreate",e,i,s.success,s),e.trigger("afterCreate",e,i,s.success,s)}finally{s.complete=!0,e._checkSaveComplete(r)}},this._createSuccess=function(e,t,s){var r=s.xhr,i=s.response,o=e._mergeUpdateForCUD(i,r);o&&(s.success=!1),e.autoApplyChanges&&(o?e._createError(e,t,s):delete s.jsrecord._tableRef._beforeImage[s.jsrecord.data._id])},this._createError=function(e,t,s){e.autoApplyChanges&&e._undoCreate(s.jsrecord._tableRef,s.jsrecord.data._id)},this._updateComplete=function(e,t,s){var r=s.xhr,i=s.jsrecord;try{e._deleteProdsProperties(i.data,!1),i._tableRef.trigger("afterUpdate",e,i,s.success,s),e.trigger("afterUpdate",e,i,s.success,s)}finally{s.complete=!0,e._checkSaveComplete(r)}},this._updateSuccess=function(e,t,s){var r=s.xhr,i=e._mergeUpdateForCUD(s.response,r);i&&(s.success=!1),e.autoApplyChanges&&(i?e._updateError(e,t,s):(s.success=!0,delete s.jsrecord._tableRef._beforeImage[s.jsrecord.data._id]))},this._updateError=function(e,t,s){e.autoApplyChanges&&(s.success=!1,e._undoUpdate(s.jsrecord._tableRef,s.jsrecord.data._id))},this._saveChangesSuccess=function(e,t,s){var r=s.response;e._mergeUpdateForSubmit(r,s.xhr),e._clearErrors();var i=e.getChanges();e._updateLastErrors(e,null,i),e._setAllRecordsRejected(i),e.autoApplyChanges&&e._applyChanges()},this._saveChangesError=function(e,t,s){e._setAllRecordsRejected(!0),e.autoApplyChanges&&e.rejectChanges(),e._updateLastErrors(e,null,null,s)},this._saveChangesSuccessTT=function(e,t,s){var r;e._clearErrors(),r=e.getChanges(),e._updateLastErrors(e,null,r),e._setAllRecordsRejected(!1)},this._saveChangesComplete=function(e,t,s){s.xhr.status>=200&&s.xhr.status<300&&(e._lastErrors.length>0||e._someRecordsRejected)&&(s.success=!1),!0===e._useSubmit&&e._fireCUDTriggersForSubmit(s),e._undefWorkingRecord(),e._fireAfterSaveChanges(s.success,s)},this._fireAfterSaveChanges=function(e,t){this.trigger("afterSaveChanges",this,e,t),t.jsrecords?t.deferred&&(e?t.deferred.resolve(this,e,t):t.deferred.reject(this,e,t)):t.batch&&t.batch.deferred&&(e?t.batch.deferred.resolve(this,e,t):t.batch.deferred.reject(this,e,t));var s=this.autoApplyChanges;if(t.jsrecords)for(var r=0;r<t.jsrecords.length;r++){var i=t.jsrecords[r];s&&delete i.data._errorString,delete i.data["prods:rowState"]}else if(t.batch&&t.batch.operations)for(r=0;r<t.batch.operations.length;r++){i=t.batch.operations[r].jsrecord;s&&delete i.data._errorString}},this._getErrorsFromRequest=function(e){var t,s,i,o,a=[],n=[];if(e&&!e.success){if(e.xhr.status>=400&&e.xhr.status<600)try{for(responseObject=JSON.parse(e.xhr.responseText),responseObject instanceof Array?n=responseObject:responseObject instanceof Object&&n.push(responseObject),o=0;o<n.length;o+=1)if((t=n[o])._retVal?(a.push({type:r.data.JSDO.RETVAL,error:t._retVal}),s=t._retVal):s=null,t._errors instanceof Array)for(i=0;i<t._errors.length;i+=1)0===t._errors[i]._errorNum&&t._errors[i]._errorMsg===s||a.push({type:r.data.JSDO.APP_ERROR,error:t._errors[i]._errorMsg,errorNum:t._errors[i]._errorNum})}catch(e){}e.exception&&a.push({type:r.data.JSDO.ERROR,error:e.exception}),0===a.length&&e.xhr&&e.xhr.status>=400&&e.xhr.status<600&&a.push({type:r.data.JSDO.ERROR,error:"Error: HTTP Status "+e.xhr.status+" "+e.xhr.statusText,responseText:e.xhr.responseText})}return a},this._updateLastErrors=function(e,t,s,i){var o,a,n,d,h;if(t){if(void 0===t.operations)return;for(n=0;n<t.operations.length;n++)if(!(i=t.operations[n]).success&&i.xhr)if(i.xhr.status>=200&&i.xhr.status<300)e._lastErrors.push({errorString:i.jsrecord.data._errorString}),e._buffers[i.jsrecord._tableRef._name]._lastErrors.push({type:r.data.JSDO.DATA_ERROR,id:i.jsrecord.data._id,error:i.jsrecord.data._errorString});else{for(o=this._getErrorsFromRequest(i),a="",d=0;d<o.length;d+=1)o.length>1&&-1!=o[d].error.indexOf("(7243)")||(!i.jsrecord||o[d].type!==r.data.JSDO.APP_ERROR&&o[d].type!==r.data.JSDO.RETVAL||(o[d].id=i.jsrecord.data._id,i.jsrecord._tableRef._lastErrors.push(o[d])),0===a.length?a=o[d].error:a+="\n"+o[d].error);e._lastErrors.push({errorString:a})}}else if(s instanceof Array)for(n=0;n<s.length;n++)s[n].record&&void 0!==s[n].record.data._errorString&&(e._lastErrors.push({errorString:s[n].record.data._errorString}),e._buffers[s[n].record._tableRef._name]._lastErrors.push({type:r.data.JSDO.DATA_ERROR,id:s[n].record.data._id,error:s[n].record.data._errorString}));else if(i&&!i.success&&i.xhr&&(i.xhr.status>=400&&i.xhr.status<600||0===i.xhr.status)){for(o=this._getErrorsFromRequest(i),a="",d=0;d<o.length;d+=1)if(!(o.length>1&&-1!=o[d].error.indexOf("(7243)"))){for(h in this._buffers)this._buffers[h]._lastErrors.push(o[d]);0===a.length?a=o[d].error:a+="\n"+o[d].error}e._lastErrors.push({errorString:a})}},this._checkSaveComplete=function(e){if(e.request){var t=e.request.jsdo,s=e.request.batch;if(t&&s&&t._async&&t._isBatchComplete(s)){var r=t._isBatchSuccess(s),i={batch:s,success:r};t._undefWorkingRecord(),t._lastErrors=[],!r&&s.operations&&t._updateLastErrors(t,s,null),this._setAllRecordsRejected(s),t._fireAfterSaveChanges(r,i)}}},this._isBatchSuccess=function(e){if(e.operations)for(var t=0;t<e.operations.length;t++)if(!e.operations[t].success)return!1;return!0},this._isBatchComplete=function(e){if(e.operations)for(var t=0;t<e.operations.length;t++){if(!e.operations[t].complete)return!1}return!0},this._mergeInvoke=function(e,t){var i;if(void 0===(i=void 0!==t.request.fnName&&void 0!==t.jsdo._resource.fn[t.request.fnName]?t.jsdo._resource.fn[t.request.fnName].operation:null)){i=null;for(var o=0;o<t.jsdo._resource.operations.length;o++)if(t.jsdo._resource.operations[o].name==t.request.fnName){i=t.jsdo._resource.operations[o];break}t.jsdo._resource.fn[t.request.fnName].operation=i}if(null!==i&&i.mergeMode)try{var a,n=r.data.JSDO["MODE_"+i.mergeMode.toUpperCase()];if(null===n)throw new Error(s.getMsgText("jsdoMSG030","mergeMode property","EMPTY, APPEND, MERGE or REPLACE"));if(void 0===t.jsdo._resource.idProperty)throw new Error(s.getMsgText("jsdoMSG110",this._resource.name," by mergeMode property in invoke operation"));if(t.jsdo.isDataSet())a=t.jsdo._resource._dataSetName;else if(void 0!==t.jsdo._resource.dataProperty)a=t.jsdo._resource.dataProperty;else{if(void 0===t.jsdo._resource._tempTableName)throw new Error(s.getMsgText("jsdoMSG111",""));a=t.jsdo._resource._tempTableName}var d=!1;for(o=0;o<i.params.length;o++)if(i.params[o].name==a&&-1!=i.params[o].type.indexOf("RESPONSE_BODY")){if(void 0!==i.params[o].xType&&"DATASET"!=i.params[o].xType&&"TABLE"!=i.params[o].xType&&"ARRAY"!=i.params[o].xType)throw new Error(s.getMsgText("jsdoMSG113",i.params[o].xType,a,t.request.fnName));d=!0;break}if(!d)throw new Error(s.getMsgText("jsdoMSG112",a,t.request.fnName));t.jsdo.addRecords(t.request.response[a],n,[t.jsdo._resource.idProperty],!1,!0)}catch(e){t.request.success=!1,t.request.exception=e}},this.onReadyStateChangeGeneric=function(){var e=this;if(4==e.readyState){var t=e.request;try{t.response=JSON.parse(e.responseText),t.response&&t.response.response&&(t.response=t.response.response)}catch(e){t.response=void 0}try{var r;if(e.status>=200&&e.status<300||0===e.status&&""!==e.responseText){if(t.success=!0,e.jsdo._session._saveClientContextId(e),"function"==typeof e.onSuccessFn)(void 0===(r=void 0!==e.request.fnName&&void 0!==e.jsdo._resource.fn[e.request.fnName]?e.jsdo._resource.fn[e.request.fnName].operation:null)||null!==r&&r.mergeMode)&&e.jsdo._mergeInvoke(t.response,e),t.success?e.onSuccessFn(e.jsdo,t.success,t):"function"==typeof e.onErrorFn&&e.onErrorFn(e.jsdo,t.success,t)}else t.success=!1,0===e.status&&(t.exception=new Error(s.getMsgText("jsdoMSG101"))),"function"==typeof e.onErrorFn&&e.onErrorFn(e.jsdo,t.success,t)}catch(s){t.success=!1,t.exception=s,"function"==typeof e.onErrorFn&&e.onErrorFn(e.jsdo,t.success,t)}e.jsdo._session._checkServiceResponse(e,t.success,t),"function"==typeof e.onCompleteFn&&e.onCompleteFn(e.jsdo,t.success,t)}},this.acceptChanges=function(){for(var e in this._buffers)this._buffers[this._buffers[e]._name].acceptChanges()},this.rejectChanges=function(){for(var e in this._buffers)this._buffers[this._buffers[e]._name].rejectChanges()},this.getChanges=function(){var e=[];for(var t in this._buffers){var s=this._buffers[this._buffers[t]._name].getChanges();e=e.concat(s)}return e},this.hasChanges=function(){for(var e in this._buffers)if(this._buffers[this._buffers[e]._name].hasChanges())return!0;return!1},this._applyChanges=function(){for(var e in this._buffers)this._buffers[this._buffers[e]._name]._applyChanges()},this.acceptRowChanges=function(){if(this._defaultTableRef)return this._defaultTableRef.acceptRowChanges();throw new Error(s.getMsgText("jsdoMSG001","acceptRowChanges()"))},this.rejectRowChanges=function(){if(this._defaultTableRef)return this._defaultTableRef.rejectRowChanges();throw new Error(s.getMsgText("jsdoMSG001","rejectRowChanges()"))},this.setProperties=function(e){var t;if(arguments.length<1)throw new Error(r.data._getMsgText("jsdoMSG122","JSDO","setProperties",1));if(arguments.length>1)throw new Error(r.data._getMsgText("jsdoMSG122","JSDO","setProperties",1));if("object"==(void 0===e?"undefined":i(e)))for(t in this._properties={},e)e.hasOwnProperty(t)&&"function"!=typeof e[t]&&(this._properties[t]=e[t]);else{if(void 0!==e&&null!==e)throw new Error(r.data._getMsgText("jsdoMSG121","JSDO",1,"Object","setProperties"));this._properties={}}},this.setProperty=function(e,t){if(arguments.length<2)throw new Error(r.data._getMsgText("jsdoMSG122","JSDO","setProperty",2));if(2!==arguments.length)throw new Error(r.data._getMsgText("jsdoMSG122","JSDO","setProperty",2));if("string"!=typeof e)throw new Error(r.data._getMsgText("jsdoMSG121","JSDO",1,"string","setProperty"));void 0===t?delete this._properties[e]:this._properties[e]=t},this.getProperties=function(){if(arguments.length>0)throw new Error(r.data._getMsgText("jsdoMSG122","JSDO","getProperties",0));return this._properties},this.getProperty=function(e){if(arguments.length<1)throw new Error(r.data._getMsgText("jsdoMSG122","JSDO","getProperty",1));if(arguments.length>1)throw new Error(r.data._getMsgText("jsdoMSG122","JSDO","getProperty",1));return this._properties[e]},this.saveLocal=function(e,t){var i,o;if(arguments.length>2)throw new Error(s.getMsgText("jsdoMSG024","JSDO",arguments.callee.name+"()"));if("string"==typeof e||null===e||void 0===e?(i=e,o=t):(i=null,o=e),void 0!==i&&null!==i&&""!==i||(i="jsdo_"+this._resource.service.name+"_"+this._resource.name),void 0===o)o=r.data.JSDO.ALL_DATA;else switch(o){case r.data.JSDO.ALL_DATA:case r.data.JSDO.CHANGES_ONLY:break;default:throw new Error(s.getMsgText("jsdoMSG115",arguments.callee.name))}null===this._localStorage&&(this._localStorage=new r.data.LocalStorage);var a=this._prepareDataObjectForLocalStorage(o);this._localStorage.saveToLocalStorage(i,a)},this.readLocal=function(e){if(arguments.length>1)throw new Error(s.getMsgText("jsdoMSG024","JSDO",arguments.callee.name+"()"));if(void 0===e||null===e||""===e)e="jsdo_"+this._resource.service.name+"_"+this._resource.name;else if("string"!=typeof e)throw new Error(s.getMsgText("jsdoMSG116","name",arguments.callee.name+"()"));null===this._localStorage&&(this._localStorage=new r.data.LocalStorage);var t=this._localStorage.readFromLocalStorage(e);if(t){if(!1===this._hasMatchingSchema(t))throw new Error(s.getMsgText("jsdoMSG117",e));this._restoreFromLocalStorage(t,r.data.JSDO.MODE_EMPTY)}return null!==t},this.addLocalRecords=function(e,t,i){var o,a,n;if(arguments.length<1)throw new Error(s.getMsgText("jsdoMSG024","JSDO",arguments.callee.name+"()"));if("string"==typeof e?(o=e,a=t,n=i):(o="jsdo_"+this._resource.service.name+"_"+this._resource.name,a=e,n=t),void 0===o||null===o||""===o)o="jsdo_"+this._resource.service.name+"_"+this._resource.name;else if("string"!=typeof o)throw new Error(s.getMsgText("jsdoMSG116","name",arguments.callee.name+"()"));if(a!=r.data.JSDO.MODE_REPLACE)throw new Error(s.getMsgText("jsdoMSG115",arguments.callee.name));null===this._localStorage&&(this._localStorage=new r.data.LocalStorage);var d=this._localStorage.readFromLocalStorage(o);if(d){if(!1===this._hasMatchingSchema(d))throw new Error(s.getMsgText("jsdoMSG117",o));try{this._restoreFromLocalStorage(d,a,n)}catch(e){var h=e.message;throw new Error(h.replace(new RegExp("addRecords","g"),"addLocalRecords"))}}return null!==d},this._containsPrimaryKeys=function(){for(var e in this._buffers)if(null===this._buffers[e]._primaryKeys)return!1;return!0},this._hasMatchingSchema=function(e){var t=!0;if(null===e||0===Object.keys(e).length)return!0;if(this._dataSetName)if(e[this._dataSetName]){for(var s in this._buffers)if(void 0===e[this._dataSetName][s]){t=!1;break}}else t=!1;else this._dataProperty?void 0!==(e=e._localStorage)&&void 0!==e[this._dataProperty]||(t=!1):void 0!==(e=e._localStorage)&&void 0!==e[this._defaultTableRef._name]||(t=!1);return t},this.deleteLocal=function(e){if(arguments.length>1)throw new Error(s.getMsgText("jsdoMSG024","JSDO",arguments.callee.name+"()"));if(void 0===e||null===e||""===e)e="jsdo_"+this._resource.service.name+"_"+this._resource.name;else if("string"!=typeof e)throw new Error(s.getMsgText("jsdoMSG116","name",arguments.callee.name+"()"));null===this._localStorage&&(this._localStorage=new r.data.LocalStorage),this._localStorage.clearLocalStorage(e)},this._prepareDataObjectForLocalStorage=function(e){var t={};if(this._dataSetName)switch(e){case r.data.JSDO.ALL_DATA:t=this._createDataAndChangeSet(this._dataSetName);break;case r.data.JSDO.CHANGES_ONLY:t=this._createChangeSet(this._dataSetName,!0)}else if(this._dataProperty)switch(e){case r.data.JSDO.ALL_DATA:t=this._createDataAndChangeSet("_localStorage");break;case r.data.JSDO.CHANGES_ONLY:t=this._createChangeSet("_localStorage",!0)}else switch(e){case r.data.JSDO.ALL_DATA:t=this._createDataAndChangeSet("_localStorage");break;case r.data.JSDO.CHANGES_ONLY:t=this._createChangeSet("_localStorage",!0)}return t},this._restoreFromLocalStorage=function(e,t,s){if(e&&Object.keys(e).length>0)if(this._dataSetName)for(var i in this._buffers)this._restoreDataForTable(this._buffers[i],e,t,s);else this._restoreDataForTable(this._defaultTableRef,e,t,s);else t===r.data.JSDO.MODE_EMPTY&&this._clearData()},this._restoreDataForTable=function(e,t,s,r){if(void 0===(r=void 0!==r?r:e._primaryKeys)&&this._resource.idProperty&&((r=[])[0]=this._resource.idProperty),this._dataSetName){var i=this.useRelationships;this.useRelationships=!1;try{e.addRecords(t,s,r)}finally{this.useRelationships=i}}else this._dataSetName="_localStorage",e.addRecords(t,s,r),this._dataSetName=null},this.getMethodProperties=function(e,t){if(this._resource._operations){if(this._resource._operations[e])return this._resource._operations[e]}else this._resource._operations={};for(var s=0;s<this._resource.operations.length;s++)if(this._resource.operations[s].type==e)return this._resource._operations[e]=this._resource.operations[s]},n&&this.fill()},"function"==typeof Object.defineProperty?(Object.defineProperty(r.data.JSDO,"MODE_APPEND",{value:1,enumerable:!0}),Object.defineProperty(r.data.JSDO,"MODE_EMPTY",{value:2,enumerable:!0}),Object.defineProperty(r.data.JSDO,"MODE_MERGE",{value:3,enumerable:!0}),Object.defineProperty(r.data.JSDO,"MODE_REPLACE",{value:4,enumerable:!0}),Object.defineProperty(r.data.JSDO,"ERROR",{value:-1,enumerable:!0}),Object.defineProperty(r.data.JSDO,"APP_ERROR",{value:-2,enumerable:!0}),Object.defineProperty(r.data.JSDO,"RETVAL",{value:-3,enumerable:!0}),Object.defineProperty(r.data.JSDO,"DATA_ERROR",{value:-4,enumerable:!0})):(r.data.JSDO.MODE_APPEND=1,r.data.JSDO.MODE_EMPTY=2,r.data.JSDO.MODE_MERGE=3,r.data.JSDO.MODE_REPLACE=4),r.data.JSDO._OP_CREATE=1,r.data.JSDO._OP_READ=2,r.data.JSDO._OP_UPDATE=3,r.data.JSDO._OP_DELETE=4,r.data.JSDO._OP_SUBMIT=5,r.data.JSDO.ALL_DATA=1,r.data.JSDO.CHANGES_ONLY=2,r.data.JSDO.ARRAY_INDEX_SEPARATOR="_",r.data.JSDO.prototype=new r.util.Observable,r.data.JSDO.prototype.constructor=r.data.JSDO,r.data.JSDO.prototype.toString=function(e){return"JSDO"},r.data.JSTableRef.prototype=new r.util.Observable,r.data.JSTableRef.prototype.constructor=r.data.JSTableRef,r.data.JSTableRef.prototype.toString=function(e){return"JSTableRef"},r.data.PluginManager.addPlugin("JFP",{requestMapping:function(e,t,o){var a,n,d,h,l,c,f,_,u,g,p,S,m,v,T={filter:{options:["ablFilter","sqlQuery"],mapping:void 0},top:{options:["top"],mapping:void 0},skip:{options:["skip"],mapping:void 0},id:{options:["id"],mapping:void 0},sort:{options:["orderBy"],mapping:void 0}},E=!0;if("read"===o.operation){if(m={},u=e.getMethodProperties(o.operation).capabilities)for(u=u.replace(/\s/g,"").split(","),g=0;g<u.length;g+=1)m[u[g]]=!0;for(v in t)if(v&&void 0!==t[v]&&T[v]){for(g=0;g<T[v].options.length;g+=1)if(m[S=T[v].options[g]]){T[v].mapping=S;break}if(!T[v].mapping)throw new Error(s.getMsgText("jsdoMSG120",T[v].options.join("' or '"),v))}if(l=e._defaultTableRef&&void 0===t.tableRef?e._defaultTableRef._name:t.tableRef,t.sort)for("object"!==i(t.sort)||t.sort instanceof Array||(t.sort=[t.sort]),a="",g=0;g<t.sort.length;g+=1){if(c="","string"==typeof(n=t.sort[g])){if(d=n,-1!==(p=n.indexOf(":")))switch(c=d.substring(p+1),d=d.substring(0,p),c.toLowerCase()){case"desc":case"descending":c="desc"}}else d=n.field,"desc"===t.sort[g].dir&&(c=t.sort[g].dir);l&&(h=e[l]._fields[d.toLowerCase()])&&h.origName&&(d=h.origName),"desc"===c&&(d+=" DESC"),a+=d,g<t.sort.length-1&&(a+=",")}if(t.filter){if("string"==typeof t.filter&&(E=!1),t.tableRef=l,E&&void 0===t.tableRef)throw new Error(s.getMsgText("jsdoMSG045","fill() or read()","params","tableRef"));"ablFilter"===T.filter.mapping?f=E?r.util._convertToABLWhereString(e._buffers[t.tableRef],t.filter):t.filter:"sqlQuery"===T.filter.mapping&&(_=E?r.util._convertToSQLQueryString(e._buffers[t.tableRef],t.filter,!0):t.filter)}t={filter:JSON.stringify({ablFilter:f,sqlQuery:_,orderBy:a,skip:t.skip,top:t.top})}}return t}}),void 0===r.ui&&(r.ui={}),r.ui.UITableRef=function(e){this._tableRef=e,this._listview=null,this._detailPage=null,this._listviewContent=void 0,this.addItem=function(e){var t;if(!this._tableRef.record)throw new Error(s.getMsgText("jsdoMSG002",this._name));if(this._listview){e=e||this._listview.format,t=this._detailPage&&this._detailPage.name?this._detailPage.name:"",void 0===this._listviewContent&&this.clearItems();var i=this._listview.itemTemplate?this._listview.itemTemplate:r.ui.UIHelper._itemTemplate;for(var o in i=(i=(i=i.replace(new RegExp("{__format__}","g"),e)).replace(new RegExp("{__id__}","g"),this._tableRef.record.data._id)).replace(new RegExp("{__page__}","g"),t),this._tableRef.record.data){var a=this._tableRef.record.data[o];i=i.replace(new RegExp("{"+o+"}","g"),void 0!==a&&null!==a?a:"")}this._listviewContent+=i}},this.clearItems=function(){if(this._listview){this._listviewContent="";var e=document.getElementById(this._listview.name);e&&(e.innerHTML="")}},this._getFormFieldValue=function(e,t){var s=null;return void 0===t&&this._detailPage&&this._detailPage.name&&(t=this._detailPage.name),"function"==typeof $&&t?(field=$("#"+t+" #"+e),field&&0!==field.length||(field=$("#"+t+' [dsid="'+e+'"]')),field&&1==field.length&&(s=field.val())):(field=document.getElementById(e),field&&(s=field.value)),s},this._setFormField=function(e,t,s){var r=null;void 0===s&&this._detailPage&&this._detailPage.name&&(s=this._detailPage.name),"function"==typeof $&&s?((r=$("#"+s+" #"+e))&&0!==r.length||(r=$("#"+s+' [dsid="'+e+'"]')),r&&1==r.length&&r.val(t)):(r=document.getElementById(e))&&(r.value=t)},this.assign=function(e){if(!this._tableRef.record)throw new Error(s.getMsgText("jsdoMSG002",this._tableRef._name));if(0!==arguments.length&&"string"!=typeof e)throw new Error(s.getMsgText("jsdoMSG024","UIHelper","assign()"));var t;this._tableRef.record.assign(null);for(var r=this._tableRef.getSchema(),i=0;i<r.length;i++)if("_id"!=(t=r[i].name)){var o=this._getFormFieldValue(t,e);void 0!==o&&("string"==typeof o&&"string"!=r[i].type&&(o=this._tableRef._jsdo._convertType(o,r[i].type,r[i].items?r[i].items.type:null)),this._tableRef.record.data[t]=o)}return this._tableRef.record._sortRecord(),!0},this.display=function(e){if(!this._tableRef.record)throw new Error(s.getMsgText("jsdoMSG002",this._tableRef._name));for(var t=this._tableRef.getSchema(),r=0;r<t.length;r++)this._setFormField(t[r].name,this._tableRef.record.data[t[r].name],e);this._setFormField("_id",this._tableRef.record.data._id,e)},this.showListView=function(){if(this._listview){var e,t=this;if("function"==typeof $){if((e=$("#"+this._listview.name))&&1==e.length){e.html(this._listviewContent?this._listviewContent:"");try{"true"===e.attr("data-filter")&&"function"==typeof e.filterable?e.filterable("refresh"):e.listview("refresh")}catch(e){}}this._listview.autoLink&&$("#"+this._listview.name+" li").each(function(){$(this).bind("click",function(){var e=t.getListViewRecord(this);t.display(),"function"==typeof t._listview.onSelect&&t._listview.onSelect(event,this,e)})})}else if((e=document.getElementById(this._listview.name))&&(e.innerHTML=this._listviewContent),this._listview.autoLink){var s=document.getElementById(this._listview.name);if(s&&s.childElementCount>0)for(var r=0;r<s.children.length;r++)s.children[r].onclick=function(){var e=uihelper.getListViewRecord(this);uihelper.display(),"function"==typeof t._listview.onSelect&&t._listview.onSelect(event,this,e)}}this._listviewContent=void 0}},this.getFormFields=function(e){if(!this._tableRef._schema)return"";if(e instanceof Array){for(var t={},s=0;s<e.length;s++)t[e[s]]=e[s];e=t}else e=null;var i;i=!e||e._id?'<input type="hidden" id="_id" name="_id" value="" />':"",i+='<fieldset data-role="controlgroup">';for(s=0;s<this._tableRef._schema.length;s++){var o=this._tableRef._schema[s].name;if("_id"!=o&&!(o.length>0&&"_"==o.charAt(0)||e&&void 0===e[o])){var a=this._tableRef._schema[s].title?this._tableRef._schema[s].title:this._tableRef._schema[s].name,n=this._detailPage&&this._detailPage.fieldTemplate?this._detailPage.fieldTemplate:r.ui.UIHelper._fieldTemplate;i+=n=(n=n.replace(new RegExp("{__label__}","g"),a)).replace(new RegExp("{__name__}","g"),this._tableRef._schema[s].name)}}return e=null,i+="</fieldset>"},this.getListViewRecord=function(e){var t=e.getAttribute("data-id");return this._tableRef.findById(t)},this.getFormRecord=function(e){var t=this._getFormFieldValue("_id",e);return this._tableRef.findById(t)},this._getIdOfElement=function(e){if("function"==typeof $){var t=$("#"+e);if((!t||0===t.length)&&(t=$('[dsid="'+e+'"]'))&&1==t.length){var s=t.attr("id");if(s)return s}}return e},this.setDetailPage=function(e){if(!e||"object"!=(void 0===e?"undefined":i(e)))throw new Error(s.getMsgText("jsdoMSG012",arguments.callee.name,"object"));if(!e.name||"string"!=typeof e.name)throw new Error(s.getMsgText("jsdoMSG012",arguments.callee.name,"name"));this._detailPage=e,this._detailPage.name=this._getIdOfElement(this._detailPage.name)},this.setListView=function(e){if(!e||"object"!=(void 0===e?"undefined":i(e)))throw new Error(s.getMsgText("jsdoMSG012",arguments.callee.name,"object"));if(!e.name||"string"!=typeof e.name)throw new Error(s.getMsgText("jsdoMSG012",arguments.callee.name,"name"));if(e.format&&"string"!=typeof e.name)throw new Error(s.getMsgText("jsdoMSG012",arguments.callee.name,"format"));if(this._listview=e,this._listview.name=this._getIdOfElement(this._listview.name),!this._listview.format){if("function"==typeof $)for(var t=0;t<this._tableRef._schema.length;t++){var r=this._tableRef._schema[t].name;field=$("#"+this._listview.name+' [dsid="'+r+'"]'),field&&1==field.length&&field.html("{"+r+"}")}var o=document.getElementById(this._listview.name).innerHTML,a=o.indexOf("<li ");-1!=a&&(o=o.substring(0,a)+'<li data-id="{__id__}"'+o.substring(a+3)),this._listview.itemTemplate=o}}},r.ui.UIHelper=function(){if("object"==i(arguments[0])){var e=arguments[0];for(var t in e)"jsdo"==t?this._jsdo=e[t]:this[t]=e[t]}this._defaultUITableRef=null,this._uiTableRef={};var o=0;for(var a in this._jsdo._buffers)this[a]=this._uiTableRef[a]=new r.ui.UITableRef(this._jsdo._buffers[a]),this._defaultUITableRef||(this._defaultUITableRef=this._uiTableRef[a]),o++;1!=o&&(this._defaultUITableRef=null),this.addItem=function(e){if(!this._defaultUITableRef)throw new Error(s.getMsgText("jsdoMSG011","addItem()"));this._defaultUITableRef.addItem(e)},this.clearItems=function(){if(!this._defaultUITableRef)throw new Error(s.getMsgText("jsdoMSG011","clearItems()"));this._defaultUITableRef.clearItems()},this.assign=function(e){if(0!==arguments.length)throw new Error(s.getMsgText("jsdoMSG024","UIHelper","assign()"));if(this._defaultUITableRef)return this._defaultUITableRef.assign(e);throw new Error(s.getMsgText("jsdoMSG011","assign()"))},this.display=function(e){if(!this._defaultUITableRef)throw new Error(s.getMsgText("jsdoMSG011","display()"));this._defaultUITableRef.display(e)},this.showListView=function(){if(!this._defaultUITableRef)throw new Error(s.getMsgText("jsdoMSG011","showListView()"));this._defaultUITableRef.showListView()},this.getFormFields=function(e){if(this._defaultUITableRef)return this._defaultUITableRef.getFormFields(e);throw new Error(s.getMsgText("jsdoMSG011","getFormFields()"))},this.getListViewRecord=function(e){if(this._defaultUITableRef)return this._defaultUITableRef.getListViewRecord(e);throw new Error(s.getMsgText("jsdoMSG011","getListViewRecord()"))},this.getFormRecord=function(e){if(this._defaultUITableRef)return this._defaultUITableRef.getFormRecord(e);throw new Error(s.getMsgText("jsdoMSG011","getFormRecord()"))},this.setDetailPage=function(e){if(this._defaultUITableRef)return this._defaultUITableRef.setDetailPage(e);throw new Error(s.getMsgText("jsdoMSG011","setDetailPage()"))},this.setListView=function(e){if(this._defaultUITableRef)return this._defaultUITableRef.setListView(e);throw new Error(s.getMsgText("jsdoMSG011","setListView()"))}},r.ui.UIHelper._defaultItemTemplate='<li data-theme="c" data-id="{__id__}"><a href="#{__page__}" class="ui-link" data-transition="slide">{__format__}</a></li>',r.ui.UIHelper._defaultFieldTemplate='<div data-role="fieldcontain"><label for="{__name__}">{__label__}</label><input id="{__name__}" name="{__name__}" placeholder="" value="" type="text" /></div>',r.ui.UIHelper._itemTemplate=r.ui.UIHelper._defaultItemTemplate,r.ui.UIHelper._fieldTemplate=r.ui.UIHelper._defaultFieldTemplate,r.ui.UIHelper.setItemTemplate=function(e){r.ui.UIHelper._itemTemplate=e||r.ui.UIHelper._defaultItemTemplate},r.ui.UIHelper.setFieldTemplate=function(e){r.ui.UIHelper._fieldTemplate=e||r.ui.UIHelper._defaultFieldTemplate}}()},function(e,t,s){var{default:r}=s(0),i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){function e(e){var t=[];if("string"==typeof e)for(var s=null,r=0;r<e.length;r++)"{"==e.charAt(r)?s="":"}"==e.charAt(r)?(s&&t.push(s),s=null):null!==s&&(s+=e.charAt(r));return t}void 0===r&&(r={}),void 0===r.data&&(r.data={}),r.data.ServicesManager={},r.data.ServicesManager._services=[],r.data.ServicesManager._resources=[],r.data.ServicesManager._data=[],r.data.ServicesManager._sessions=[],r.data.ServicesManager._jsdosessions=[],r.data.ServicesManager.addResource=function(e,t){if(void 0!==r.data.ServicesManager._resources[e])throw new Error("A resource named '"+e+"' was already loaded.");r.data.ServicesManager._resources[e]=t},r.data.ServicesManager.getResource=function(e){return r.data.ServicesManager._resources[e]},r.data.ServicesManager.addService=function(e,t){if(void 0!==r.data.ServicesManager._services[e])throw new Error("A service named '"+e+"' was already loaded.");r.data.ServicesManager._services[e]=t},r.data.ServicesManager.getService=function(e){return r.data.ServicesManager._services[e]},r.data.ServicesManager.addSession=function(e,t){if(void 0!==r.data.ServicesManager._sessions[e])throw new Error("Cannot load catalog '"+e+"' multiple times.");r.data.ServicesManager._sessions[e]=t},r.data.ServicesManager.addJSDOSession=function(e,t){if(void 0!==r.data.ServicesManager._jsdosessions[e])throw new Error("Cannot load catalog '"+e+"' multiple times.");r.data.ServicesManager._jsdosessions[e]=t},r.data.ServicesManager.getSession=function(e){try{return r.data.ServicesManager._sessions[e]}catch(e){return null}},r.data.ServicesManager.cleanSession=function(e){var t,s,i,o,a=r.data.ServicesManager._services,n=r.data.ServicesManager._resources,d=r.data.ServicesManager._sessions,h=r.data.ServicesManager._jsdosessions;for(t in a)if(o=null,a[t]._session===e&&(o=a[t],delete a[t]),o)for(s in n)n[s].service===o&&delete n[s];for(i in d)d[i]===e&&(delete d[i],h[i]&&delete h[i])},r.data.ServicesManager.addCatalog=function(t,s){if(!t)throw new Error("Cannot find 'services' property in catalog file.");if(!(t instanceof Array))throw new Error("Missing 'services' array in catalog.");for(var o=0;o<t.length;o++){if(void 0!==r.data.ServicesManager.getService(t[o].name))throw new Error("A service named '"+t[o].name+"' was already loaded.");if(!((n=t[o].resources)instanceof Array))throw new Error("Missing 'resources' array in catalog.");for(var a=0;a<n.length;a++)if(void 0!==r.data.ServicesManager.getResource(n[a].name))throw new Error("A resource named '"+n[a].name+"' was already loaded.")}for(o=0;o<t.length;o++){t[o]._session=s,this.addService(t[o].name,t[o]);var n=t[o].resources,d=t[o].address;if(n instanceof Array)for(a=0;a<n.length;a++){var h=n[a];if(h.fn={},h.service=t[o],n[a].url=d+n[a].path,r.data.ServicesManager.addResource(n[a].name,n[a]),h.fields=null,h.primaryKeys=null,h.schema){h.fields={},h.primaryKeys={},h._dataSetName=void 0,h._tempTableName=void 0;var l=null;try{if(void 0!==h.schema.properties){var c=Object.keys(h.schema.properties);l=h.schema.properties,1==c.length&&(void 0!==h.schema.properties[c[0]].properties?h._dataSetName=c[0]:void 0!==h.schema.properties[c[0]].items&&(h.dataProperty=c[0],l=h.schema.properties[c[0]].items.properties,h._tempTableName=h.dataProperty,h.primaryKeys[h._tempTableName]=h.schema.properties[c[0]].primaryKey))}else{1==(c=Object.keys(h.schema)).length&&(h.dataProperty=c[0],void 0!==h.schema[c[0]].items?(l=h.schema[c[0]].items.properties,h._tempTableName=h.dataProperty,h.primaryKeys[h._tempTableName]=h.schema[c[0]].primaryKey):void 0!==h.schema[c[0]].properties&&(h._dataSetName=c[0],h.dataProperty=null,l=h.schema))}}catch(e){throw new Error("Error parsing catalog file.")}if(!l)throw new Error("Error parsing catalog file.");if(h._dataSetName)for(var f in l=l[h._dataSetName].properties){var _;for(var u in h.fields[f]=[],h.primaryKeys[f]=l[f].primaryKey,_=l[f].items&&l[f].items.properties?l[f].items.properties:l[f].properties)_[u].name=u,"_id"!=u&&h.fields[f].push(_[u])}else{f=h.dataProperty?h.dataProperty:"";for(var u in h.fields[f]=[],l)l[u].name=u,"_id"!=u&&h.fields[f].push(l[u])}}else h.fields=null;if(h.relations instanceof Array&&h.relations[0]&&h.relations[0].RelationName)throw new Error("Relationship properties in catalog must begin with lowercase.");if(h.generic={},h.operations)for(var g=0;g<h.operations.length;g++){h.operations[g].path?h.operations[g].url=h.url+h.operations[g].path:h.operations[g].url=h.url,h.operations[g].params||(h.operations[g].params=[]),h.operations[g].type||(h.operations[g].type="INVOKE");var p=h.operations[g].type.toLowerCase();if(!h.operations[g].verb)switch(p){case"create":h.operations[g].verb="POST";break;case"read":h.operations[g].verb="GET";break;case"update":case"invoke":case"submit":case"count":h.operations[g].verb="PUT";break;case"delete":h.operations[g].verb="DELETE"}var S=function t(s,r){var o;if(void 0===t.fnName)return t.fnName=arguments[0],void(t.definition=arguments[1]);var a=null,n=t.definition.url,d=this,h=null,l={};if(s){if("object"!=(void 0===s?"undefined":i(s)))throw new Error("Catalog error: Function '"+t.fnName+"' requires an object as a parameter.");var c;s instanceof XMLHttpRequest||s.constructor&&"XMLHttpRequest"===s.constructor.name?(d=s.jsdo,c=(h=s).objParam,l=h.request):c=s,r=void 0===r?this._async:Boolean(r),l.objParam=c;for(var f="INVOKE"==t.definition.type.toUpperCase(),_=0;_<t.definition.params.length;_++){var u=t.definition.params[_].name;switch(t.definition.params[_].type){case"PATH":case"QUERY":case"MATRIX":var g=null;if(c&&(g=c[u]),g||(g=""),-1==n.indexOf("{"+u+"}"))throw new Error("Catalog error: Reference to "+t.definition.params[_].type+" parameter '"+u+"' is missing in path.");n=n.replace(new RegExp("{"+u+"}","g"),encodeURIComponent(g));break;case"REQUEST_BODY":case"REQUEST_BODY,RESPONSE_BODY":case"RESPONSE_BODY,REQUEST_BODY":if(h&&!a)a=c;else{var p=c[u];if(f&&t.definition.params[_].xType&&-1!="DATASET,TABLE".indexOf(t.definition.params[_].xType))d._resource.service.settings&&d._resource.service.settings.unwrapped?"object"==(void 0===p?"undefined":i(p))&&1==Object.keys(p).length&&"object"==i(p[u])&&(p=p[u]):"object"==(void 0===p?"undefined":i(p))&&void 0===p[u]&&((p={})[u]=c[u]);a||(a={}),a[u]=p}break;case"RESPONSE_BODY":break;default:throw new Error("Catalog error: Unexpected parameter type '"+t.definition.params[_].type+"'.")}}if(-1!=n.indexOf("{")){var S=e(n);for(_=0;_<S.length;_++){u=S[_],g=null;c&&(g=c[u]),g||(g=""),"object"===(void 0===g?"undefined":i(g))&&(g=JSON.stringify(g)),n=n.replace(new RegExp("{"+u+"}","g"),encodeURIComponent(g))}}}return l.fnName=t.fnName,l.async=r,void 0===l.deferred&&"function"==typeof $&&"function"==typeof $.Deferred&&(o=$.Deferred(),l.deferred=o),d._httpRequest(h,t.definition.verb,n,a,l,r)};switch(h.operations[g].verb.toLowerCase()){case"get":case"post":case"put":case"delete":break;default:throw new Error("Catalog error: Unexpected HTTP verb '"+h.operations[g].verb+"' found while parsing the catalog.")}switch(p){case"invoke":break;case"create":case"read":case"update":case"delete":case"submit":case"count":if("function"==typeof h.generic[p])throw new Error("Catalog error: Multiple '"+h.operations[g].type+"' operations specified in the catalog for resource '"+h.name+"'.");h.generic[p]=S;break;default:throw new Error("Catalog error: Unexpected operation '"+h.operations[g].type+"' found while parsing the catalog.")}var m=h.operations[g].name;"invoke"===p||"count"===p?(h.fn[m]={},h.fn[m].function=S):m="_"+p,S(m,h.operations[g])}}}},r.data.ServicesManager.printDebugInfo=function(e){if(e){var t=r.data.ServicesManager.getResource(e);if(t){var s="Schema:\n",i="Operations: "+t.operations.length+"\n";for(var o in t.schema.properties)s+="\nName: "+o+"\n";for(var a=0;a<t.operations.length;a++)i+="\n"+a+"\nName: "+t.operations[a].name+"\nURL: "+t.operations[a].url+"\ntype: "+t.operations[a].type+"\nverb: "+t.operations[a].verb+"\nparams: "+t.operations[a].params.length+"\n";console.log("** DEBUG INFO **\nResource name: %s\nURL:%s\n%s\n%s\n\n",t.name,t.url,s,i)}else console.log("Resource not found")}},r.data.MobileServiceObject=function(e){var t=e.name;Object.defineProperty(this,"name",{get:function(){return t},enumerable:!0});var s=e.uri;Object.defineProperty(this,"uri",{get:function(){return s},enumerable:!0})},r.data.ContextProperties=function(){var e,t={};Object.defineProperty(this,"contextHeader",{get:function(){var s;return null===e&&(s=JSON.stringify(t),e="{}"===s?void 0:s),e},enumerable:!0}),this.setContextProperty=function(s,i){if(arguments.length<2)throw new Error(r.data._getMsgText("jsdoMSG122","Session","setContextProperty",2));if(2!==arguments.length)throw new Error(r.data._getMsgText("jsdoMSG122","Session","setContextProperty",2));if("string"!=typeof s)throw new Error(r.data._getMsgText("jsdoMSG121","Session",1,"string","setContextProperty"));void 0===i?delete t[s]:t[s]=i,e=null},this.setContext=function(s){var o;if(arguments.length<1)throw new Error(r.data._getMsgText("jsdoMSG122","Session","setContext",1));if(arguments.length>1)throw new Error(r.data._getMsgText("jsdoMSG122","Session","setContext",1));if("object"==(void 0===s?"undefined":i(s)))for(o in t={},s)s.hasOwnProperty(o)&&"function"!=typeof s[o]&&(t[o]=s[o]);else{if(void 0!==s&&null!==s)throw new Error(r.data._getMsgText("jsdoMSG121","Session",1,"Object","setContextProperty"));t={}}e=null},this.getContext=function(){if(arguments.length>0)throw new Error(r.data._getMsgText("jsdoMSG122","Session","getContext",0));return t},this.getContextProperty=function(e){if(arguments.length<1)throw new Error(r.data._getMsgText("jsdoMSG122","Session","getContextProperty",1));if(arguments.length>1)throw new Error(r.data._getMsgText("jsdoMSG122","Session","getContextProperty",1));return t[e]}},r.data.Session=function(e){var t=!1;"function"==typeof Object.defineProperty&&(t=!0);var s,o,a,n,d,h=this,l=!1,c=!1,f=!1,_=!1,u=!1,g=!0,p=!1,S=!1,m="/rest/_oeping",v=null,T=!1,E=!1;e&&!0===e._silent||console.warn("Session: As of JSDO 4.4, the Session object has been deprecated. Please use the JSDOSession object instead."),"undefined"!=typeof navigator&&void 0!==navigator.userAgent&&(l=navigator.userAgent.match(/(iPad)|(iPhone)|(iPod)/i),c=navigator.userAgent.toLowerCase().indexOf("firefox")>-1,f=navigator.userAgent.indexOf("Edge/")>-1,_=navigator.userAgent.indexOf("Trident/")>-1||navigator.userAgent.indexOf("MSIE 10")>-1),u=!(c||f||_),this._onlineHandler=function(){V(!0),h.trigger("online",h,null)},this._offlineHandler=function(){V(!1),h.trigger("offline",h,r.data.Session.DEVICE_OFFLINE,null)},"undefined"!=typeof window&&window.addEventListener&&(window.addEventListener("online",this._onlineHandler,!1),window.addEventListener("offline",this._offlineHandler,!1));var R=[],b=[],O=[];this.onOpenRequest=null;var y=null;if(t){var w=null;Object.defineProperty(this,"userName",{get:function(){return w},enumerable:!0});var I="/static/home.html";Object.defineProperty(this,"loginTarget",{get:function(){return I},enumerable:!0});var C=null;Object.defineProperty(this,"serviceURI",{get:function(){return C},enumerable:!0}),Object.defineProperty(this,"catalogURIs",{get:function(){return R},enumerable:!0}),Object.defineProperty(this,"services",{get:function(){return b},enumerable:!0});var A=null;Object.defineProperty(this,"loginResult",{get:function(){return A},enumerable:!0});var N=null;Object.defineProperty(this,"loginHttpStatus",{get:function(){return N},enumerable:!0});var j=null;Object.defineProperty(this,"clientContextId",{get:function(){return j},enumerable:!0});var M=r.data.Session.AUTH_TYPE_ANON;Object.defineProperty(this,"authenticationModel",{get:function(){return M},set:function(e){switch(e&&(e=e.toLowerCase()),e){case r.data.Session.AUTH_TYPE_FORM:case r.data.Session.AUTH_TYPE_BASIC:case r.data.Session.AUTH_TYPE_ANON:case r.data.Session.AUTH_TYPE_SSO:case r.data.Session.AUTH_TYPE_ADAL:case null:M=e,L("authenticationModel",e);break;default:throw new Error("Error setting Session.authenticationModel. '"+e+"' is an invalid value.")}},enumerable:!0});var P=null;Object.defineProperty(this,"lastSessionXHR",{get:function(){return P},enumerable:!0}),Object.defineProperty(this,"connected",{get:function(){return this.loginResult===r.data.Session.LOGIN_SUCCESS&&p&&g},enumerable:!0}),Object.defineProperty(this,"JSDOs",{get:function(){return O},enumerable:!0});var x=0,D=null;Object.defineProperty(this,"pingInterval",{get:function(){return x},set:function(e){if(!("number"==typeof e&&e>=0))throw new Error("Error setting Session.pingInterval. '"+e+"' is an invalid value.");x=e,L("pingInterval",e),e>0?this.loginResult===r.data.Session.LOGIN_SUCCESS&&(D=setTimeout(this._autoping,e)):0===e&&(clearTimeout(D),x=0)},enumerable:!0});var G=new r.data.ContextProperties;Object.defineProperty(this,"_contextProperties",{get:function(){return G},enumerable:!1});var U=!1;Object.defineProperty(this,"_isInvalidated",{get:function(){return U},enumerable:!1}),Object.defineProperty(this,"_authProvider",{get:function(){return v},set:function(e){if(v)throw new Error("Internal Error setting Session._authProvider. 'The property has already been set.");Q(e)},enumerable:!1})}else this.userName=null,this.loginTarget="/static/home.html",this.serviceURI=null,this.catalogURIs=[],this.services=[],this.loginResult=null,this.loginHttpStatus=null,this.clientContextId=null,this.authenticationModel=r.data.Session.AUTH_TYPE_ANON,this.lastSessionXHR=null;function L(e,t){var s;h.loginResult===r.data.Session.LOGIN_SUCCESS&&"object"===("undefined"==typeof sessionStorage?"undefined":i(sessionStorage))&&o&&(s=o,e&&(s=s+"."+e),void 0!==t&&sessionStorage.setItem(s,JSON.stringify(t)))}function F(e){var t,s,r=null;if("object"===("undefined"==typeof sessionStorage?"undefined":i(sessionStorage))&&o){if(t=o,e&&(t=t+"."+e),null!==(s=sessionStorage.getItem(t)))try{r=JSON.parse(s)}catch(e){r=null}return r}}function k(e){var t;"object"===("undefined"==typeof sessionStorage?"undefined":i(sessionStorage))&&o&&(t=o,e&&(t=t+"."+e,sessionStorage.removeItem(t)))}function J(){o&&(L("loginResult",h.loginResult),L("userName",h.userName),L("serviceURI",h.serviceURI),L("loginHttpStatus",h.loginHttpStatus),L("authenticationModel",h.authenticationModel),L("pingInterval",h.pingInterval),L("oepingAvailable",S),L("partialPingURI",m),L("clientContextId",h.clientContextId),L("deviceIsOnline",g),L("restApplicationIsOnline",p),h._authProvider&&L("_authProvider.init",{uri:h._authProvider.uri,authenticationModel:h._authProvider.authenticationModel}),L(o,!0))}function H(){o&&F(o)&&(k("loginResult"),k("userName"),k("serviceURI"),k("loginHttpStatus"),k("clientContextId"),k("deviceIsOnline"),k("restApplicationIsOnline"),k("authenticationModel"),k("pingInterval"),k("oepingAvailable"),k("partialPingURI"),k("_authProvider.init"),k(o))}function q(e,s){t?w=e:s.userName=e,L("userName",e)}function B(e,s){t?C=e:s.serviceURI=e,L("serviceURI",e)}function K(e,s){t?A=e:s.loginResult=e,e===r.data.Session.LOGIN_SUCCESS?L("loginResult",e):H()}function Y(e,s){t?N=e:s.loginHttpStatus=e,L("loginHttpStatus",e)}function W(e,s){t?j=e:s.clientContextId=e,L("clientContextId",e)}function X(e,s){t?P=e:s.lastSessionXHR=e}function V(e){g=e,L("deviceIsOnline",e)}function Q(e){v=e||null}function $(e){p=e,L("restApplicationIsOnline",e)}function z(e){S=e,L("oepingAvailable",e)}function Z(e){m=e,L("partialPingURI",e)}function ee(e,t){var s,r=e._pdsResponseHeaders;return void 0===r&&(r=e.getAllResponseHeaders(),e._pdsResponseHeaders=r||null),r&&(s=new RegExp("^"+t+":","m"),r.match(s))?e.getResponseHeader(t):null}this._pushJSDOs=function(e){O.push(e)},this._openRequest=function(e,t,s,i,o){var a,n=this;function d(e){if(n.clientContextId&&"0"!==n.clientContextId&&e.setRequestHeader("X-CLIENT-CONTEXT-ID",n.clientContextId),he(n,e),"function"==typeof n.onOpenRequest){var s={xhr:e,verb:t,uri:a,async:i,formPreTest:!1,session:n};n.onOpenRequest(s)}o&&o()}if(this._isInvalidated)throw new Error(r.data._getMsgText("jsdoMSG510","Session"));if(this.loginResult!==r.data.Session.LOGIN_SUCCESS&&!this._authProvider&&this.authenticationModel)throw new Error("Attempted to make server request when there is no active session.");a=this._prependAppURL(s),a=this._addCCIDtoURL(a),r.data.Session._useTimeStamp&&(a=r.data.Session._addTimeStampToURL(a)),this._authProvider?this._authProvider._openRequestAndAuthorize(e,t,a,i,d):(this._setXHRCredentials(e,t,a,this.userName,y,i),this.authenticationModel===r.data.Session.AUTH_TYPE_FORM&&re(e,"application/json"),d(e))},this.pingTestCallback=function(e){z(!!e.pingResult)},this._onReadyStateChangeGeneric=function(){var e,t;if(clearTimeout(this._requestTimeout),4==this.readyState){if(e=null,t=null,"function"==typeof this.onResponseFn)try{e=this.onResponseFn(this)}catch(e){t=e}"function"==typeof this.onResponseProcessedFn&&(e||(e=r.data.Session.GENERAL_FAILURE),this.onResponseProcessedFn(this.pdsession,e,t,this))}},this._disconnect=function(e){this._processDisconnectResult(null,e)},this._processDisconnectResult=function(e,t){this._reinitializeAfterLogout(this,r.data.Session.SUCCESS),this._disconnectComplete(this,r.data.Session.SUCCESS,null,null,t)},this._disconnectComplete=function(e,t,s,r,i){e.trigger("afterDisconnect",e,t,s,r,i)};var te=null,se=null;function re(e,t){try{e.withCredentials=!0,e.setRequestHeader("Accept",t)}catch(e){}}this.login=function(e,o,a,n){var d,h,c,f,_,u,g=!1,p=[];if(te=null,se=null,t||(this.authenticationModel=this.authenticationModel.toLowerCase()),this.authenticationModel===r.data.Session.AUTH_TYPE_SSO)throw new Error(r.data._getMsgText("jsdoMSG057","Session","login()"));if(this.loginResult===r.data.Session.LOGIN_SUCCESS||this._authProvider)throw new Error("Attempted to call login() on a Session object that is already logged in.");if(arguments.length>0)if(arguments[0]&&"object"===i(arguments[0])){if(p[0]=arguments[0].serviceURI,p[1]=arguments[0].userName,p[2]=arguments[0].password,p[3]=arguments[0].loginTarget,p[4]=arguments[0].async,c=arguments[0].deferred,void 0===(f=arguments[0].iOSBasicAuthTimeout))f=4e3;else if(f&&"number"!=typeof f)throw new Error(r.data._getMsgText("jsdoMSG033","Session","login","The iOSBasicAuthTimeout argument was invalid."))}else p=arguments;if(!(p.length>0))throw K(r.data.Session.LOGIN_GENERAL_FAILURE,this),new Error("Session.login() is missing the serviceURI argument.");if(p[0]){var S=p[0];"/"===S[S.length-1]&&(S=S.substring(0,S.length-1)),B(S,this)}else if(!this.serviceURI)throw K(r.data.Session.LOGIN_GENERAL_FAILURE,this),new Error("Session.login() is missing the serviceURI argument.");if(p[1]&&(d=p[1]),p[2]&&(h=p[2]),p[3]&&(u=p[3],t?I=u:this.loginTarget=u),p[4]){if("boolean"!=typeof p[4])throw new Error("Session.login() was passed an async setting that is not a boolean.");g=p[4]}se=d,te=h,this.authenticationModel!==r.data.Session.AUTH_TYPE_ANON&&this.authenticationModel!==r.data.Session.AUTH_TYPE_FORM||(d=null,h=null);var m=new XMLHttpRequest;m.pdsession=this;try{if(_=this.serviceURI+this.loginTarget,r.data.Session._useTimeStamp&&(_=r.data.Session._addTimeStampToURL(_)),this._setXHRCredentials(m,"GET",_,d,h,g),r.data.Session._setNoCacheHeaders(m),he(this,m),this.authenticationModel===r.data.Session.AUTH_TYPE_FORM&&re(m,"application/json,text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8"),m._isAsync=g,g&&(m.onreadystatechange=this._onReadyStateChangeGeneric,this.authenticationModel===r.data.Session.AUTH_TYPE_FORM?m.onResponseFn=this._afterFormPretestLogin:(m.onResponseFn=this._processLoginResult,m.onResponseProcessedFn=this._loginComplete),this.authenticationModel===r.data.Session.AUTH_TYPE_BASIC&&l&&f>0&&(m._requestTimeout=setTimeout(function(){clearTimeout(m._requestTimeout),m._iosTimeOutExpired=!0,m.abort()},f)),m._jsdosession=s,m._deferred=c),"function"==typeof this.onOpenRequest){var v=!1;this.authenticationModel===r.data.Session.AUTH_TYPE_FORM&&(v=!0),X(m,this);var T={xhr:m,verb:"GET",uri:this.serviceURI+this.loginTarget,async:!1,formPreTest:v,session:this};this.onOpenRequest(T),m=T.xhr}X(m,this),m.send(null)}catch(e){throw clearTimeout(m._requestTimeout),Y(m.status,this),K(r.data.Session.LOGIN_GENERAL_FAILURE,this),se=null,te=null,e}return g?r.data.Session.ASYNC_PENDING:(Y(m.status,this),this.authenticationModel===r.data.Session.AUTH_TYPE_FORM?this._afterFormPretestLogin(m):this._processLoginResult(m))},this._afterFormPretestLogin=function(e){var t=e.pdsession;Y(e.status,e.pdsession);var s={xhr:e,pw:te,uname:se,theSession:t};try{return function(e){var t,s=e.xhr,i=e.theSession,o=null,a=!1,n={session:i,xhr:s,statusFromjson:null};(o=s.getResponseHeader("Content-Type"))&&o.indexOf("application/json")>=0?(de(n),!n.statusFromjson||n.statusFromjson>=400&&n.statusFromjson<500?a=!0:Y(n.statusFromjson,i)):200==i.loginHttpStatus&&oe(s)&&(a=!0);if(a){t=s,s=new XMLHttpRequest,e.xhr=s,n.xhr=s,s.pdsession=t.pdsession,s._isAsync=t._isAsync,s._deferred=t._deferred,s._jsdosession=t._jsdosession,s.open("POST",i.serviceURI+"/static/auth/j_spring_security_check",s._isAsync),s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),s.setRequestHeader("Cache-Control","max-age=0"),he(i,s),re(s,"application/json");try{if("function"==typeof i.onOpenRequest){var d={xhr:s,verb:"POST",uri:i.serviceURI+"/static/auth/j_spring_security_check",async:s._isAsync,formPreTest:!1,session:i};i.onOpenRequest(d),s=d.xhr}s._isAsync&&(s.onreadystatechange=i._onReadyStateChangeGeneric,s.onResponseFn=i._afterFormLogin,s.onResponseProcessedFn=i._loginComplete),s.send("j_username="+encodeURIComponent(e.uname)+"&j_password="+encodeURIComponent(e.pw)+"&submit=Submit")}catch(e){throw K(r.data.Session.LOGIN_GENERAL_FAILURE,i),Y(s.status,i),se=null,te=null,e}}if(s._isAsync&&!a)return s.onResponseProcessedFn=i._loginComplete,i._afterFormLogin(s);if(!s._isAsync)return i._afterFormLogin(s)}(s)}catch(e){throw te=null,se=null,e}},this._afterFormLogin=function(e){var t=e.pdsession,s={session:t,xhr:e,statusFromjson:null},r=e.getResponseHeader("Content-Type");if(r&&r.indexOf("application/json")>=0){if(de(s),!s.statusFromjson)throw new Error("Internal OpenEdge Mobile client error handling login response. HTTP status: "+e.status+".");Y(s.statusFromjson,t)}else 200===e.status&&(function(e){return ne(e,ae)}(e)||oe(e)?Y(401,t):Y(e.status,t));return t._processLoginResult(e)},this._processLoginResult=function(e){var t=e.pdsession;if(Y(e.status,e.pdsession),200===t.loginHttpStatus){K(r.data.Session.LOGIN_SUCCESS,t),$(!0),q(se,t),y=te,t._saveClientContextId(e),J();var s={pingURI:null,async:!0,onCompleteFn:null,fireEventIfOfflineChange:!0,onReadyStateFn:t._pingtestOnReadyStateChange};s.pingURI=t._makePingURI(),t._sendPing(s)}else 401==t.loginHttpStatus?K(r.data.Session.LOGIN_AUTHENTICATION_FAILURE,t):K(r.data.Session.LOGIN_GENERAL_FAILURE,t);if(X(e,t),ce(t,e),se=null,te=null,e._iosTimeOutExpired)throw new Error(r.data._getMsgText("jsdoMSG047","login"));return t.loginResult},this._loginComplete=function(e,t,s,r){e.trigger("afterLogin",e,t,s,r)},this.logout=function(e){var t,o,a,n=!1,d=null;if(this.authenticationModel===r.data.Session.AUTH_TYPE_SSO)throw new Error(r.data._getMsgText("jsdoMSG057","Session","logout()"));if(this.loginResult!==r.data.Session.LOGIN_SUCCESS&&this.authenticationModel)throw new Error("Attempted to call logout when there is no active session.");if("object"===(void 0===e?"undefined":i(e))){if((n=e.async)&&"boolean"!=typeof n)throw new Error(r.data._getMsgText("jsdoMSG033","Session","logout","The async argument was invalid."));o=e.deferred}(t=new XMLHttpRequest).pdsession=this;try{if(t._jsdosession=s,t._deferred=o,this.authenticationModel===r.data.Session.AUTH_TYPE_FORM||this.authenticationModel===r.data.Session.AUTH_TYPE_BASIC){n&&(t.onreadystatechange=this._onReadyStateChangeGeneric,t.onResponseFn=this._processLogoutResult,t.onResponseProcessedFn=this._logoutComplete),t.open("GET",this.serviceURI+"/static/auth/j_spring_security_logout",n);try{t.withCredentials=!0}catch(e){}t.setRequestHeader("Accept","application/json"),he(this,t),"function"==typeof this.onOpenRequest&&(X(t,this),a={xhr:t,verb:"GET",uri:this.serviceURI+"/static/auth/j_spring_security_logout",async:!1,formPreTest:!1,session:this},this.onOpenRequest(a),t=a.xhr),X(t,this),t.send()}else t._anonymousLogoutOK=!0}catch(e){throw this._reinitializeAfterLogout(this,!1),e}if(!n)try{this._processLogoutResult(t)}catch(e){throw e}if(n&&this.authenticationModel===r.data.Session.AUTH_TYPE_ANON){try{this._processLogoutResult(t)}catch(e){d=e}this._logoutComplete(this,null,d,t)}},this.invalidate=function(){U=!0,r.data.ServicesManager.cleanSession(h)},this._logoutComplete=function(e,t,s,r){e.trigger("afterLogout",e,s,r)},this._processLogoutResult=function(e){var t,s=e.pdsession;if(e._anonymousLogoutOK)t=!0;else if(200!==e.status){if(s.authenticationModel!==r.data.Session.AUTH_TYPE_BASIC)throw t=!1,new Error("Error logging out, HTTP status = "+e.status);if(404!==e.status)throw t=!1,new Error("Error logging out, HTTP status = "+e.status);t=!0}else t=!0;ce(s,e),s._reinitializeAfterLogout(s,t)},this._reinitializeAfterLogout=function(e,t){K(null,e),Y(null,e),W(null,e),q(null,e),y=null,Q(null),t&&($(!1),z(!1),Z("/rest/_oeping"),X(null,e),clearTimeout(D))},this.addCatalog=function(e,t,o,a){var n,d,h,c,f,_,u,g,p=!1,S=this;function m(){r.data.Session._setNoCacheHeaders(c),he(S,c),p&&(c.onreadystatechange=S._onReadyStateChangeGeneric,c.onResponseFn=S._processAddCatalogResult,c.onResponseProcessedFn=S._addCatalogComplete,S.authenticationModel===r.data.Session.AUTH_TYPE_BASIC&&l&&_&&(c._requestTimeout=setTimeout(function(){clearTimeout(c._requestTimeout),c._iosTimeOutExpired=!0,c.abort()},_)),c._jsdosession=s,c._deferred=f,c._catalogIndex=u);try{if("function"==typeof S.onOpenRequest){X(c,S);var e={xhr:c,verb:"GET",uri:n,async:!1,formPreTest:!1,session:S};S.onOpenRequest(e),c=e.xhr}X(c,S),c.send(null)}catch(e){throw new Error("Error retrieving catalog '"+n+"'.\n"+e.message)}return p?r.data.Session.ASYNC_PENDING:S._processAddCatalogResult(c)}if(this._isInvalidated)throw new Error(r.data._getMsgText("jsdoMSG510","JSDOSession"));if(T=!0,!(arguments.length>0))throw new Error("Session.addCatalog is missing its first argument, the URL of the catalog.");if("object"===(void 0===e?"undefined":i(e))){if(!arguments[0].offlineAddCatalog&&this.loginResult!==r.data.Session.LOGIN_SUCCESS&&!this._authProvider&&this.authenticationModel)throw new Error("Attempted to call addCatalog when there is no active session.");if(!(n=e.catalogURI)||"string"!=typeof n)throw new Error(r.data._getMsgText("jsdoMSG033","Session","addCatalog","The catalogURI argument was missing or invalid."));if((d=e.userName)&&"string"!=typeof d)throw new Error(r.data._getMsgText("jsdoMSG033","Session","addCatalog","The catalogUserName argument was invalid."));if((h=e.password)&&"string"!=typeof h)throw new Error(r.data._getMsgText("jsdoMSG033","Session","addCatalog","The catalogPassword argument was invalid."));if((p=e.async)&&"boolean"!=typeof p)throw new Error(r.data._getMsgText("jsdoMSG033","Session","addCatalog","The async argument was invalid."));if(void 0===(_=e.iOSBasicAuthTimeout))_=4e3;else if(_&&"number"!=typeof _)throw new Error(r.data._getMsgText("jsdoMSG033","Session","addCatalog","The iOSBasicAuthTimeout argument was invalid."));g=e.authProvider,f=e.deferred,u=e.catalogIndex}else{if("string"!=typeof(n=e))throw new Error("First argument to Session.addCatalog must be the URL of the catalog.");if((d=t)&&"string"!=typeof d)throw new Error("Second argument to Session.addCatalog must be a user name string.");if((h=o)&&"string"!=typeof h)throw new Error("Third argument to Session.addCatalog must be a password string.")}return g||(g=this._authProvider,T=!1),d||(d=this.userName),h||(h=y),(c=new XMLHttpRequest).pdsession=this,c._catalogURI=n,void 0!==r.data.ServicesManager.getSession(n)?p?(c._jsdosession=s,c._deferred=f,c._catalogIndex=u,setTimeout(this._addCatalogComplete,10,this,r.data.Session.CATALOG_ALREADY_LOADED,null,c),r.data.Session.ASYNC_PENDING):r.data.Session.CATALOG_ALREADY_LOADED:g?(g._openRequestAndAuthorize(c,"GET",n,p,m),r.data.Session.ASYNC_PENDING):(this._setXHRCredentials(c,"GET",n,d,h,p),m())},this._processAddCatalogResult=function(e){var i,o,a,n,d=e.status,h=e.pdsession,l=e._catalogURI,c=s;if(T||le(e),!(200==d||0===d&&e.responseText)){if(401==d)return r.data.AuthenticationProvider._getAuthFailureReason(e);throw e._iosTimeOutExpired?new Error(r.data._getMsgText("jsdoMSG047","addCatalog")):new Error("Error retrieving catalog '"+l+"'. Http status: "+d+".")}i=h._parseCatalog(e);try{r.data.ServicesManager.addCatalog(i,h)}catch(e){if(void 0!==r.data.ServicesManager.getSession(l))return r.data.Session.CATALOG_ALREADY_LOADED;throw new Error("Error processing catalog '"+l+"'. \n"+e.message)}for(var f=0;f<i.length;f++)o=h._prependAppURL(i[f].address),a=new r.data.MobileServiceObject({name:i[f].name,uri:o}),n=h,t?b.push(a):n.services.push(a),i[f].settings&&i[f].settings.useXClientProps&&!h.xClientProps&&console.warn("Catalog warning: Service settings property 'useXClientProps' is true but 'xClientProps' property has not been set.");return function(e,s){t?R.push(e):s.catalogURIs.push(e)}(l,h),r.data.ServicesManager.addSession(l,h),c&&r.data.ServicesManager.addJSDOSession(l,c),r.data.Session.SUCCESS},this._addCatalogComplete=function(e,t,s,r){e.trigger("afterAddCatalog",e,t,s,r)},this.ping=function(e){var t=!1,s={pingURI:null,async:!0,onCompleteFn:null,fireEventIfOfflineChange:!0,onReadyStateFn:this._onReadyStateChangePing,offlineReason:null};if(this._isInvalidated)throw new Error(r.data._getMsgText("jsdoMSG510","Session"));if(!this._authProvider&&this.loginResult!==r.data.Session.LOGIN_SUCCESS)throw new Error("Attempted to call ping when not logged in.");return e&&(void 0!==e.async&&(s.async=e.async),void 0!==e.doNotFireEvent&&(s.fireEventIfOfflineChange=!e.doNotFireEvent),e.onCompleteFn&&"function"==typeof e.onCompleteFn&&(s.onCompleteFn=e.onCompleteFn),s.deferred=e.deferred,s.jsdosession=e.jsdosession),s.pingURI=h._makePingURI(),h._sendPing(s),s.async||(s.xhr?(t=h._processPingResult(s),void 0!==e.offlineReason&&(e.offlineReason=s.offlineReason)):t=!1,void 0!==e.xhr&&(e.xhr=s.xhr)),t},this._isOnlineStateChange=function(e){var t=!1;return e&&!this.connected?t=!0:!e&&this.connected&&(t=!0),t},this._checkServiceResponse=function(e,t,s){var r=null,i=this.connected;if(ce(this,e),this._events){var o=this._events.offline||[],a=this._events.online||[];if(0!==o.length||0!==a.length){if(t)$(!0),V(!0);else if(g){var n={doNotFireEvent:!0,offlineReason:null,async:!1};h.ping(n)?$(!0):(r=n.offlineReason,$(!1))}i&&!this.connected?this.trigger("offline",this,r,s):!i&&this.connected&&this.trigger("online",this,s)}}},this._processPingResult=function(e){var t,s,i=e.xhr,o=null,a=this.connected;if(s=e.hasOwnProperty("usingOepingFormat")?e.usingOepingFormat:S,i.status>=200&&i.status<300){if(ce(this,i),s)try{o=JSON.parse(i.responseText).AppServerStatus}catch(e){console.error("Unable to parse ping response.")}le(i)}else g?0===i.status?(e.offlineReason=r.data.Session.SERVER_OFFLINE,$(!1)):404===i.status||410===i.status?(e.offlineReason=r.data.Session.WEB_APPLICATION_OFFLINE,$(!1)):$(!0):e.offlineReason=r.data.Session.DEVICE_OFFLINE;return o&&("false"===o.PingStatus?(e.offlineReason=r.data.Session.APPSERVER_OFFLINE,$(!1)):$(!0)),t=this.connected,"function"==typeof i.onCompleteFn&&i.onCompleteFn({pingResult:this.connected,xhr:i,offlineReason:e.offlineReason}),e.fireEventIfOfflineChange&&(a&&!t?h.trigger("offline",h,e.offlineReason,null):!a&&t&&h.trigger("online",h,null)),this.connected},this._onReadyStateChangePing=function(){var e;4==this.readyState&&(e={xhr:this,fireEventIfOfflineChange:!0,offlineReason:null},h._processPingResult(e),x>0&&(D=setTimeout(h._autoping,x)))},this._pingtestOnReadyStateChange=function(){if(4==this.readyState){var e=!1;this.status>=200&&this.status<300?e=!0:(Z(h.loginTarget),console.warn("Default ping target not available, will use loginTarget instead.")),z(e),x>0&&(D=setTimeout(h._autoping,x))}},this._sendPing=function(e){var t=new XMLHttpRequest,i=this;function o(){e.async&&(t.onreadystatechange=e.onReadyStateFn,t.onCompleteFn=e.onCompleteFn,t._jsdosession=s,t._deferred=e.deferred),r.data.Session._setNoCacheHeaders(t),he(i,t),i.authenticationModel===r.data.Session.AUTH_TYPE_FORM&&re(t,"application/json,text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8"),t.send(null)}try{this._authProvider?this._authProvider._openRequestAndAuthorize(t,"GET",e.pingURI,e.async,o):(this._setXHRCredentials(t,"GET",e.pingURI,this.userName,y,e.async),1===t.readyState&&o())}catch(t){e.error=t}e.xhr=t},this._makePingURI=function(){var e=this.serviceURI+m;return r.data.Session._useTimeStamp&&(e=r.data.Session._addTimeStampToURL(e)),e},this._autoping=function(){h.ping({async:!0})},this._setXHRCredentials=function(e,t,s,i,o,a){if(i&&this.authenticationModel===r.data.Session.AUTH_TYPE_BASIC){u?e.open(t,s,a,i,o):e.open(t,s,a);var n="Basic "+btoa(i+":"+o);e.setRequestHeader("Authorization",n)}else e.open(t,s,a)},this._addCCIDtoURL=function(e){var t,s;return this.clientContextId&&"0"!==this.clientContextId&&e.substring(0,this.serviceURI.length)==this.serviceURI&&(t=";JSESSIONID="+this.clientContextId,-1==(s=e.indexOf("?"))?e+=t:e=e.substring(0,s)+t+e.substring(s)),e},this._saveClientContextId=function(e){!function(e,t){e&&W(ee(e,"X-CLIENT-CONTEXT-ID"),t)}(e,this)},this._parseCatalog=function(e){var t;try{t=JSON.parse(e.responseText).services}catch(e){console.error("Unable to parse response. Make sure catalog has correct format."),t=null}return t},this._prependAppURL=function(e){if(!e)return this.serviceURI;var t=e;return/^https?:\/\//i.test(t)||(0!==t.indexOf("/")&&(t="/"+t),t=this.serviceURI+t),t};var ie="j_spring_security_check";function oe(e){return ne(e,ie)}var ae="login failed";function ne(e,t){return!!e.responseText&&(e.getResponseHeader("Content-Type").indexOf("text/html")>=0&&e.responseText.indexOf(t)>=0)}function de(e){var t;e.statusFromjson=null;try{void 0!==(t=JSON.parse(e.xhr.responseText)).status_code&&void 0!==t.status_txt&&(e.statusFromjson=t.status_code)}catch(t){throw K(r.data.Session.LOGIN_GENERAL_FAILURE,e.session),Y(xhr.status,e.session),new Error("Unable to parse login response from server.")}}function he(e,t){e.xClientProps?t.setRequestHeader("X-CLIENT-PROPS",e.xClientProps):void 0!==e._contextProperties.contextHeader&&t.setRequestHeader("X-CLIENT-PROPS",e._contextProperties.contextHeader)}function le(e){var t=h;return Y(e.status,t),t.loginHttpStatus>=200&&t.loginHttpStatus<400?(K(r.data.Session.LOGIN_SUCCESS,t),$(!0),t._saveClientContextId(e),J()):0===t.loginHttpStatus||400===t.loginHttpStatus||410===t.loginHttpStatus?($(!1),K(r.data.AuthenticationProvider._getAuthFailureReason(e),t)):($(!0),K(r.data.Session.LOGIN_GENERAL_FAILURE,t)),X(e,t),ce(t,e),t.loginResult}function ce(e,t){var s,o;if(t)if(s=ee(t,"X-CLIENT-PROPS")){try{o=JSON.parse(s)}catch(e){}if("object"!==(void 0===o?"undefined":i(o)))throw new Error(r.data._getMsgText("jsdoMSG123","Session","X-CLIENT-PROPS"));e._contextProperties.setContext(o)}else""===s&&e._contextProperties.setContext({})}"object"===(void 0===e?"undefined":i(e))&&(s=e.jsdosession,d=e.serviceURI,Q(e.authProvider),e.authProvider&&e.authProvider.hasClientCredentials()&&(A=r.data.Session.LOGIN_SUCCESS),d&&"/"===d[d.length-1]&&(d=d.substring(0,d.length-1)),(o=e._storageKey)&&(F(o)&&(a=F("authenticationModel"),n=F("serviceURI"),a!==e.authenticationModel||n!==d?H():(!function(e){var t;F(e)&&(K(F("loginResult"),this),q(F("userName"),this),B(F("serviceURI"),this),Y(F("loginHttpStatus"),this),W(F("clientContextId"),this),V(F("deviceIsOnline")),$(F("restApplicationIsOnline")),h.authenticationModel=F("authenticationModel"),h.pingInterval=F("pingInterval"),z(F("oepingAvailable")),Z(F("partialPingURI")),h._authProvider||(t=F("_authProvider.init"))&&Q(new r.data.AuthenticationProvider(t)))}(o),E=!0)),e.authenticationModel===r.data.Session.AUTH_TYPE_BASIC&&(o=void 0)),E||(d&&B(d,this),e.authenticationModel&&(this.authenticationModel=e.authenticationModel)))},r.data.Session._useTimeStamp=!0;var t=999999999999999,s=0,o=0;r.data.Session._getNextTimeStamp=function(){var e=++t;if(e>=999999999999999){t=e=1;var r=Math.floor((Date.now?Date.now():(new Date).getTime())/1e4);s==r?++o>=999999999999999&&(o=1):(s=r,Math.random(),o=Math.round(1e10*Math.random()))}return s+"-"+o+"-"+e},r.data.Session._addTimeStampToURL=function(e){var t="_ts="+r.data.Session._getNextTimeStamp();return e+=(-1==e.indexOf("?")?"?":"&")+t},r.data.Session._setNoCacheHeaders=function(e){e.setRequestHeader("Cache-Control","no-cache"),e.setRequestHeader("Pragma","no-cache")},"function"==typeof Object.defineProperty?(Object.defineProperty(r.data.Session,"LOGIN_AUTHENTICATION_REQUIRED",{value:0,enumerable:!0}),Object.defineProperty(r.data.Session,"LOGIN_SUCCESS",{value:1,enumerable:!0}),Object.defineProperty(r.data.Session,"LOGIN_AUTHENTICATION_FAILURE",{value:2,enumerable:!0}),Object.defineProperty(r.data.Session,"LOGIN_GENERAL_FAILURE",{value:3,enumerable:!0}),Object.defineProperty(r.data.Session,"CATALOG_ALREADY_LOADED",{value:4,enumerable:!0}),Object.defineProperty(r.data.Session,"ASYNC_PENDING",{value:5,enumerable:!0}),Object.defineProperty(r.data.Session,"EXPIRED_TOKEN",{value:6,enumerable:!0}),Object.defineProperty(r.data.Session,"SUCCESS",{value:1,enumerable:!0}),Object.defineProperty(r.data.Session,"AUTHENTICATION_FAILURE",{value:2,enumerable:!0}),Object.defineProperty(r.data.Session,"GENERAL_FAILURE",{value:3,enumerable:!0}),Object.defineProperty(r.data.Session,"AUTH_TYPE_ANON",{value:"anonymous",enumerable:!0}),Object.defineProperty(r.data.Session,"AUTH_TYPE_BASIC",{value:"basic",enumerable:!0}),Object.defineProperty(r.data.Session,"AUTH_TYPE_FORM",{value:"form",enumerable:!0}),Object.defineProperty(r.data.Session,"AUTH_TYPE_SSO",{value:"sso",enumerable:!0}),Object.defineProperty(r.data.Session,"AUTH_TYPE_FORM_SSO",{value:"form_sso",enumerable:!0}),Object.defineProperty(r.data.Session,"AUTH_TYPE_ADAL",{value:"adal",enumerable:!0}),Object.defineProperty(r.data.Session,"DEVICE_OFFLINE",{value:"Device is offline",enumerable:!0}),Object.defineProperty(r.data.Session,"SERVER_OFFLINE",{value:"Cannot contact server",enumerable:!0}),Object.defineProperty(r.data.Session,"WEB_APPLICATION_OFFLINE",{value:"Mobile Web Application is not available",enumerable:!0}),Object.defineProperty(r.data.Session,"SERVICE_OFFLINE",{value:"REST web Service is not available",enumerable:!0}),Object.defineProperty(r.data.Session,"APPSERVER_OFFLINE",{value:"AppServer is not available",enumerable:!0})):(r.data.Session.LOGIN_SUCCESS=1,r.data.Session.LOGIN_AUTHENTICATION_FAILURE=2,r.data.Session.LOGIN_GENERAL_FAILURE=3,r.data.Session.CATALOG_ALREADY_LOADED=4,r.data.Session.SUCCESS=1,r.data.Session.AUTHENTICATION_FAILURE=2,r.data.Session.GENERAL_FAILURE=3,r.data.Session.AUTH_TYPE_ANON="anonymous",r.data.Session.AUTH_TYPE_BASIC="basic",r.data.Session.AUTH_TYPE_FORM="form",r.data.Session.AUTH_TYPE_SSO="sso",r.data.Session.AUTH_TYPE_ADAL="adal"),r.data.Session.prototype=new r.util.Observable,r.data.Session.prototype.constructor=r.data.Session,r.data.Session.prototype._eventNames=["offline","online","afterLogin","afterAddCatalog","afterLogout","afterDisconnect"],r.data.Session.prototype.validateSubscribe=function(e,t,s){s.operation=void 0;for(var o=!1,a=0;a<this._eventNames.length;a++)if(t===this._eventNames[a].toLowerCase()){o=!0;break}if(!o)throw new Error(r.data._getMsgText("jsdoMSG042",t));if(e.length<2)throw new Error(r.data._getMsgText("jsdoMSG038",2));if("string"!=typeof e[0])throw new Error(r.data._getMsgText("jsdoMSG039"));if("function"!=typeof e[1])throw new Error(r.data._getMsgText("jsdoMSG040"));if(s.fn=e[1],e.length>2){if("object"!==i(e[2]))throw new Error(r.data._getMsgText("jsdoMSG041",t));s.scope=e[2]}},r.data.Session.prototype.toString=function(e){return"progress.data.Session"},r.data.JSDOSession=function(e){var t,s,o,a=this;function n(e,t,s,r){t?e.resolve(a,s,r):e.reject(a,s,r)}function d(e,t,s,i,o){n(i?i._deferred:o,t===r.data.Session.SUCCESS,t,{errorObject:s,xhr:i})}function h(e,t,s,i){var o,a,d=!1;a=t===r.data.Session.EXPIRED_TOKEN?r.data.Session.EXPIRED_TOKEN:r.data.Session.GENERAL_FAILURE,i&&i._deferred&&(o=i._deferred,t!==r.data.Session.SUCCESS&&t!==r.data.Session.CATALOG_ALREADY_LOADED&&(t=t||r.data.Session.GENERAL_FAILURE,o._overallCatalogResult=r.data.Session.GENERAL_FAILURE),o._results[i._catalogIndex]={catalogURI:i._catalogURI,result:t,errorObject:s,xhr:i},o._numCatalogsProcessed+=1,o._numCatalogsProcessed===o._numCatalogs&&(o._processedPromise=!0,o._overallCatalogResult||(d=!0,a=r.data.Session.SUCCESS),n(i._deferred,d,a,i._deferred._results)))}function l(e){var t=e.xhr;t&&t._deferred&&n(t._deferred,e.pingResult,e.pingResult,{offlineReason:e.offlineReason,xhr:t})}if(Object.defineProperty(this,"authenticationModel",{get:function(){return t?t.authenticationModel:void 0},enumerable:!0}),Object.defineProperty(this,"authProvider",{get:function(){return t?t._authProvider:null},enumerable:!0}),Object.defineProperty(this,"catalogURIs",{get:function(){return t?t.catalogURIs:void 0},enumerable:!0}),Object.defineProperty(this,"clientContextId",{get:function(){return t?t.clientContextId:void 0},enumerable:!0}),Object.defineProperty(this,"connected",{get:function(){return t?t.connected:void 0},enumerable:!0}),Object.defineProperty(this,"JSDOs",{get:function(){return t?t.JSDOs:void 0},enumerable:!0}),Object.defineProperty(this,"loginResult",{get:function(){return t?t.loginResult:void 0},enumerable:!0}),Object.defineProperty(this,"loginHttpStatus",{get:function(){return t?t.loginHttpStatus:void 0},enumerable:!0}),Object.defineProperty(this,"onOpenRequest",{get:function(){return t?t.onOpenRequest:void 0},set:function(e){t&&(t.onOpenRequest=e)},enumerable:!0}),Object.defineProperty(this,"pingInterval",{get:function(){return t?t.pingInterval:void 0},set:function(e){t&&(t.pingInterval=e)},enumerable:!0}),Object.defineProperty(this,"services",{get:function(){return t?t.services:void 0},enumerable:!0}),Object.defineProperty(this,"serviceURI",{get:function(){return t&&t.serviceURI?t.serviceURI:s},enumerable:!0}),Object.defineProperty(this,"userName",{get:function(){return t?t.userName:void 0},enumerable:!0}),Object.defineProperty(this,"name",{get:function(){return o},enumerable:!0}),Object.defineProperty(this,"_isInvalidated",{get:function(){return t._isInvalidated},enumerable:!1}),this.login=function(e,s,o){var n=$.Deferred();if(this._isInvalidated)throw new Error(r.data._getMsgText("jsdoMSG510","JSDOSession"));if(this.authenticationModel===r.data.Session.AUTH_TYPE_SSO)throw new Error(r.data._getMsgText("jsdoMSG057","JSDOSession","login()"));return"object"===(void 0===o?"undefined":i(o))&&o.iOSBasicAuthTimeout,t._authProvider||(t._authProvider=new r.data.AuthenticationProvider({uri:this.serviceURI,authenticationModel:this.authenticationModel,authConfig:"adal"===this.authenticationModel?e:void 0})),t._authProvider.logout().then(function(){return t._authProvider.login(e,s)}).then(function(){a.isAuthorized().then(function(e,t,s){n.resolve(a,t,s)},function(e,t,s){n.reject(a,t,s)})},function(e,t,s){n.reject(a,t,s)}),n.promise()},this.disconnect=function(){var e,s=$.Deferred();try{t.subscribe("afterDisconnect",d,this),t._disconnect(s)}catch(t){e=new Error(r.data._getMsgText("jsdoMSG049","JSDOSession","disconnect",t.message))}if(e)throw e;return s.promise()},this.addCatalog=function(e,s,o,a){var n,d,l,c,f,_,u,g,p,S=$.Deferred();if(this._isInvalidated)throw new Error(r.data._getMsgText("jsdoMSG510","JSDOSession"));if("string"==typeof e)n=[e];else{if(!(e instanceof Array))throw new Error(r.data._getMsgText("jsdoMSG033","JSDOSession","addCatalog","The first argument must be a string or an array of strings specifying the URI of the catalog."));n=e}if(s)if("string"==typeof s){if(this.authenticationModel===r.data.Session.AUTH_TYPE_SSO)throw new Error(r.data._getMsgText("jsdoMSG058","Session"));u=s,a&&((g=a).authProvider=void 0)}else{if("object"!==(void 0===s?"undefined":i(s)))throw new Error(r.data._getMsgText("jsdoMSG121","JSDOSession","2","object","addCatalog"));g=s}if("object"===(void 0===g?"undefined":i(g))&&(_=g.iOSBasicAuthTimeout,g.authProvider?p=g.authProvider:this.authProvider&&(p=this.authProvider)),!p&&!this.authProvider&&!u)throw new Error(r.data._getMsgText("jsdoMSG511"));for(t.subscribe("afterAddCatalog",h,this),d=n.length,S._numCatalogs=d,S._numCatalogsProcessed=0,S._results=[],S._results.length=d,l=0;l<d;l+=1){f=void 0,c=void 0;try{c=t.addCatalog({catalogURI:n[l],async:!0,userName:u,password:o,deferred:S,catalogIndex:l,iOSBasicAuthTimeout:_,authProvider:p,offlineAddCatalog:!0})}catch(e){f=new Error("JSDOSession: Unable to send addCatalog request. "+e.message)}c!==r.data.Session.ASYNC_PENDING&&(S._overallCatalogResult=r.data.Session.GENERAL_FAILURE,f&&(c=r.data.Session.GENERAL_FAILURE),S._results[l]={catalogURI:n[l],result:c,errorObject:f,xhr:void 0},S._numCatalogsProcessed+=1)}return S._numCatalogsProcessed!==d||S._processedPromise||(S._overallCatalogResult===r.data.Session.GENERAL_FAILURE?S.reject(this,r.data.Session.GENERAL_FAILURE,S._results):S.resolve(this,r.data.Session.SUCCESS,S._results)),S.promise()},this.logout=function(){var e=$.Deferred(),t=this.authProvider;if(this.authenticationModel===r.data.Session.AUTH_TYPE_SSO)throw new Error(r.data._getMsgText("jsdoMSG057","JSDOSession","logout()"));return this.disconnect().then(function(){if(t)return t.logout();e.resolve(a,r.data.Session.SUCCESS,{})}).then(function(t,s,r){e.resolve(a,s,r)},function(t,s,r){e.reject(a,s,r)}),e.promise()},this.invalidate=function(){return t.invalidate(),this.logout()},this.ping=function(){var e=$.Deferred();if(this._isInvalidated)throw new Error(r.data._getMsgText("jsdoMSG510","JSDOSession"));try{t.ping({async:!0,deferred:e,onCompleteFn:l})}catch(e){throw new Error("JSDOSession: Unable to send ping request. "+e.message)}return e.promise()},this.isAuthorized=function(){var e,s=$.Deferred(),i=new XMLHttpRequest,o=this;if(this._isInvalidated)throw new Error(r.data._getMsgText("jsdoMSG510","JSDOSession"));return this.loginResult===r.data.Session.LOGIN_SUCCESS||this.authProvider?t._openRequest(i,"GET",t.loginTarget,!0,function(){i.onreadystatechange=function(){var e,i;4===this.readyState&&(i={xhr:this,offlineReason:void 0,fireEventIfOfflineChange:!0,usingOepingFormat:!1},t._processPingResult(i),this.status>=200&&this.status<300?s.resolve(o,r.data.Session.SUCCESS,i):(e=401===this.status?r.data.AuthenticationProvider._getAuthFailureReason(this):r.data.Session.GENERAL_FAILURE,s.reject(o,e,i)))};try{i.send()}catch(e){throw new Error("JSDOSession: Unable to validate authorization. "+e.message)}}):(e=r.data.Session.LOGIN_AUTHENTICATION_REQUIRED,s.reject(o,e,{xhr:i})),s.promise()},this.setContext=function(e){t._contextProperties.setContext(e)},this.setContextProperty=function(e,s){t._contextProperties.setContextProperty(e,s)},this.getContext=function(){return t._contextProperties.getContext()},this.getContextProperty=function(e){return t._contextProperties.getContextProperty(e)},this._onlineHandler=function(e,t){a.trigger("online",a,t)},this._offlineHandler=function(e,t,s){a.trigger("offline",a,t,s)},!(arguments.length>0&&"object"===i(arguments[0])))throw new Error(r.data._getMsgText("jsdoMSG033","JSDOSession","the constructor","The options argument was missing or invalid."));if(!e.serviceURI||"string"!=typeof e.serviceURI)throw new Error(r.data._getMsgText("jsdoMSG033","JSDOSession","the constructor","The options parameter must include a 'serviceURI' property that is a string."));if(s=e.serviceURI,e.authenticationModel){if("string"!=typeof e.authenticationModel)throw new Error(r.data._getMsgText("jsdoMSG033","JSDOSession","the constructor","The authenticationModel property of the options parameter must be a string."));e.authenticationModel=e.authenticationModel.toLowerCase()}else e.authenticationModel=r.data.Session.AUTH_TYPE_ANON;if(e.authProvider){if("object"!==i(e.authProvider))throw new Error(r.data._getMsgText("jsdoMSG502","JSDOSession","options","constructor","authProvider"));if(e.authProvider.authenticationModel!==r.data.Session.AUTH_TYPE_FORM_SSO&&e.authProvider.authenticationModel!==e.authenticationModel||e.authProvider.authenticationModel===r.data.Session.AUTH_TYPE_FORM_SSO&&e.authenticationModel!==r.data.Session.AUTH_TYPE_SSO)throw new Error(r.data._getMsgText("jsdoMSG059","JSDOSession",e.authProvider.authenticationModel,e.authenticationModel));if("function"!=typeof e.authProvider.hasClientCredentials)throw new Error(r.data._getMsgText("jsdoMSG505","JSDOSession","AuthenticationProvider","hasClientCredentials"));if(!e.authProvider.hasClientCredentials())throw new Error(r.data._getMsgText("jsdoMSG125","JSDOSession"))}else if(e.authenticationModel===r.data.Session.AUTH_TYPE_SSO)throw new Error(r.data._getMsgText("jsdoMSG508"));o=e.name,t=new r.data.Session({_storageKey:o,_silent:!0,authenticationModel:e.authenticationModel,serviceURI:e.serviceURI,jsdosession:this,authProvider:e.authProvider});try{e.context&&this.setContext(e.context),t.subscribe("online",this._onlineHandler,this),t.subscribe("offline",this._offlineHandler,this)}catch(e){throw t=void 0,e}},r.data.JSDOSession.prototype=new r.util.Observable,r.data.JSDOSession.prototype.constructor=r.data.JSDOSession,r.data.JSDOSession.prototype._eventNames=["offline","online"],r.data.JSDOSession.prototype.validateSubscribe=function(e,t,s){s.operation=void 0;for(var o=!1,a=0;a<this._eventNames.length;a++)if(t===this._eventNames[a].toLowerCase()){o=!0;break}if(!o)throw new Error(r.data._getMsgText("jsdoMSG042",t));if(e.length<2)throw new Error(r.data._getMsgText("jsdoMSG038",2));if("string"!=typeof e[0])throw new Error(r.data._getMsgText("jsdoMSG039"));if("function"!=typeof e[1])throw new Error(r.data._getMsgText("jsdoMSG040"));if(s.fn=e[1],e.length>2){if("object"!==i(e[2]))throw new Error(r.data._getMsgText("jsdoMSG041",t));s.scope=e[2]}},r.data.JSDOSession.prototype.toString=function(e){return"progress.data.JSDOSession"},r.data.getSession=function(e){var t,s=$.Deferred(),o={};function a(e,r,i){t&&t.hasClientCredentials()?t.logout().always(function(){s.reject(r,i)}):s.reject(r,i)}function n(e){s.reject(r.data.Session.GENERAL_FAILURE,{reason:e})}function d(t){var i;try{i=new r.data.JSDOSession(e);try{i.isAuthorized().then(function(){return i.addCatalog(e.catalogURI)},a).then(function(e,t,i){s.resolve(e,r.data.Session.SUCCESS)},a)}catch(e){a(0,r.data.Session.GENERAL_FAILURE,{errorObject:e})}}catch(e){a(0,r.data.Session.GENERAL_FAILURE,{errorObject:e})}}if("object"!==(void 0===e?"undefined":i(e)))throw new Error(r.data._getMsgText("jsdoMSG503","getSession()","options","object"));if(void 0!==e.loginCallback&&"function"!=typeof e.loginCallback)throw new Error(r.data._getMsgText("jsdoMSG503","getSession()","options.loginCallback","function"));try{if(!(e.authenticationModel!==r.data.Session.AUTH_TYPE_SSO||e.authenticationURI&&e.authProviderAuthenticationModel))throw new Error(r.data._getMsgText("jsdoMSG509"));if(e.authenticationURI){if(o.uri=e.authenticationURI,o.authenticationModel=e.authProviderAuthenticationModel,"string"!=typeof o.authenticationModel)throw new Error(r.data._getMsgText("jsdoMSG502","progress.data.getSession","object","getSession","authProviderAuthenticationModel"))}else o.uri=e.serviceURI,o.authenticationModel=e.authenticationModel;e.authConfig&&(o.authConfig=e.authConfig),t=new r.data.AuthenticationProvider(o),e.authProvider=t,t.hasClientCredentials()?d():t.authenticationModel===r.data.Session.AUTH_TYPE_ANON||t.authenticationModel===r.data.Session.AUTH_TYPE_ADAL?t.login().then(d,a):function(t){var s;if(void 0!==e.loginCallback)e.loginCallback().then(function(e){try{t.login(e.username,e.password).then(d,a)}catch(e){a(0,r.data.Session.GENERAL_FAILURE,{errorObject:e})}},n);else if(e.username&&e.password)try{t.login(e.username,e.password).then(d,a)}catch(e){a(0,r.data.Session.GENERAL_FAILURE,{errorObject:e})}else s=new Error(r.data._getMsgText("jsdoMSG052","getSession()")),a(0,r.data.Session.AUTHENTICATION_FAILURE,{errorObject:s})}(t)}catch(e){a(0,r.data.Session.GENERAL_FAILURE,{errorObject:e})}return s.promise()},r.data.invalidateAllSessions=function(){var e,t,s=$.Deferred(),i=r.data.ServicesManager._jsdosessions,o=[];for(t in i)i.hasOwnProperty(t)&&(e=i[t],o.push(e.invalidate()));return $.when.apply($,o).then(function(){s.resolve(r.data.Session.SUCCESS)},function(e,t,i){s.reject(r.data.Session.GENERAL_FAILURE,i)}),s.promise()}}(),t.progress=r},function(e,t,s){var{default:r}=s(0),i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){void 0===r&&(r={}),void 0===r.data&&(r.data={}),r.util={};r.util.Observable=function(){function e(e,t,s,r){return e.filter(function(e){if(e.fn!==t||e.scope!==s||e.operation!==r)return e},this)}this.validateSubscribe=function(e,t,s){if(e.length>=2&&"string"==typeof e[0]&&"string"==typeof e[1])s.operation=e[1],s.fn=e[2],s.scope=e[3];else{if(!(e.length>=2&&"string"==typeof e[0]&&"function"==typeof e[1]))throw new Error;s.operation=void 0,s.scope=e[2],s.fn=e[1]}},this.subscribe=function(t,s,i,o){var a,n;if(!t)throw new Error(r.data._getMsgText("jsdoMSG037",this.toString(),"subscribe"));if("string"!=typeof t)throw new Error(r.data._getMsgText("jsdoMSG033",this.toString(),"subscribe",r.data._getMsgText("jsdoMSG039")));this._events=this._events||{},t=t.toLowerCase(),a={fn:void 0,scope:void 0,operation:void 0};try{this.validateSubscribe(arguments,t,a)}catch(e){throw new Error(r.data._getMsgText("jsdoMSG033",this.toString(),"subscribe",e.message))}return(n=e(n=this._events[t]||[],a.fn,a.scope,a.operation)).push(a),this._events[t]=n,this},this.unsubscribe=function(t,s,i,o){var a,n;if(!t)throw new Error(r.data._getMsgText("jsdoMSG037",this.toString(),"unsubscribe"));if("string"!=typeof t)throw new Error(r.data._getMsgText("jsdoMSG033",this.toString(),"unsubscribe",r.data._getMsgText("jsdoMSG037")));this._events=this._events||{},t=t.toLowerCase(),a={fn:void 0,scope:void 0,operation:void 0};try{this.validateSubscribe(arguments,t,a)}catch(e){throw new Error(r.data._getMsgText("jsdoMSG033",this.toString(),"unsubscribe",e.message))}return(n=this._events[t]||[]).length>0&&(this._events[t]=e(n,a.fn,a.scope,a.operation)),this},this.trigger=function(e,t,s){var i,o;if(!e)throw new Error(r.data._getMsgText("jsdoMSG037",this.toString(),"trigger"));if(this._events=this._events||{},e=e.toLowerCase(),(i=this._events[e]||[]).length>0){if(s=Array.prototype.slice.call(arguments),arguments.length>=2&&"string"==typeof e&&"string"==typeof t)o=t,s=s.length>2?s.slice(2):[];else{if(!(arguments.length>=1&&"string"==typeof e))throw new Error(r.data._getMsgText("jsdoMSG033",this.toString(),"trigger"));o=void 0,s=s.length>1?s.slice(1):[]}i.forEach(function(e){e.operation===o&&e.fn.apply(e.scope,s)})}return this},this.unsubscribeAll=function(e,t){return e?(this._events=this._events||{},"string"==typeof e&&(e=e.toLowerCase(),(this._events[e]||[]).forEach(function(t){t.operation?this.unsubscribe(e,t.operation,t.fn,t.scope):this.unsubscribe(e,t.fn,t.scope)},this))):this._events={},this}},r.data.LocalStorage=function(){if("undefined"==typeof localStorage)throw new Error(r.data._getMsgText("jsdoMSG126","progress.data.LocalStorage","localStorage"));this.saveToLocalStorage=function(e,t){localStorage.setItem(e,JSON.stringify(t))},this.readFromLocalStorage=function(e){var t=localStorage.getItem(e),s=null;if(null!==t)try{s=JSON.parse(t)}catch(e){s=null}return s},this.clearLocalStorage=function(e){localStorage.removeItem(e)}},r.util._convertToABLWhereString=function(e,t){var s,i,o,a,n,d,h,l,c,f=[],_=t.logic||"and",u=t.filters||[t],g={eq:"=",neq:"<>",gt:">",gte:">=",lt:"<",lte:"<=",contains:"INDEX",doesnotcontain:"INDEX",endswith:"R-INDEX",startswith:"BEGINS",isnull:"ISNULL",isnotnull:"ISNOTNULL",isempty:"ISEMPTY",isnotempty:"ISNOTEMPTY"};for(s=0,i=u.length;s<i;s+=1){if(o=(t=u[s]).field,l=t.value,t.filters)t=r.util._convertToABLWhereString(e,t);else{if(o&&e._name&&(a=e._jsdo[e._name]._fields[o.toLowerCase()])&&a.origName&&(o=a.origName),void 0===(h=g[t.operator]))throw new Error("The operator "+t.operator+" is not valid.");switch(t.operator){case"isnull":case"isnotnull":case"isempty":case"isnotempty":l=void 0}if(h&&void 0!==l){if("String"===(n=r.util._getObjectType(l))?(d="'{1}'",l=l.replace(/'/g,"~'")):d="Date"===n?"DATE"===(c=e._getABLType(o))?"DATE({1:MM, dd, yyyy})":"DATETIME-TZ"===c?"DATETIME-TZ({1:MM, dd, yyyy, hh, mm, ss, fff, zzz})":"DATETIME({1:MM, dd, yyyy, hh, mm, ss, fff})":"{1}","INDEX"===h||"R-INDEX"===h){if("String"!==n)throw new Error("Error parsing filter object. The operator "+t.operator+" requires a string value");d="doesnotcontain"===t.operator?"{0}({2}, "+d+") = 0":"contains"===t.operator?"{0}({2}, "+d+") > 0":"{2} MATCHES '*{1}'"}else d="{2} {0} "+d;t=r.util._format(d,h,l,o)}else if(h&&void 0===l){if("isempty"===t.operator||"isnotempty"===t.operator){if("CHARACTER"!==(c=e._getABLType(o)))throw new Error("Error parsing filter object. The operator "+t.operator+" requires a CHARACTER field");"isempty"===t.operator?d="{2} = ''":"isnotempty"===t.operator&&(d="{2} <> ''")}else d="isnull"===t.operator?"{2} = ?":"isnotnull"===t.operator?"{2} <> ?":"{2} {0} ?";t=r.util._format(d,h,l,o)}}f.push(t)}return t=f.join(" "+_+" "),f.length>1&&(t="("+t+")"),t},r.util._convertToSQLQueryString=function(e,t,s){var i,o,a,n,d,h,l,c,f,_=[],u=t.logic||"and",g=t.filters||[t],p=!0,S={eq:"=",neq:"!=",gt:">",gte:">=",lt:"<",lte:"<=",contains:"LIKE",doesnotcontain:"NOT LIKE",endswith:"LIKE",startswith:"LIKE",isnull:"ISNULL",isnotnull:"ISNOTNULL",isempty:"ISEMPTY",isnotempty:"ISNOTEMPTY"};for(void 0===s&&(s=!1),i=0,o=g.length;i<o;i+=1){if(a=(t=g[i]).field,l=t.value,t.filters)f=r.util._convertToSQLQueryString(e,t,!1);else{if(void 0===(h=S[t.operator]))throw new Error("The operator "+t.operator+" is not valid.");switch(t.operator){case"isnull":case"isnotnull":case"isempty":case"isnotempty":l=void 0}if(h&&void 0!==l){if(n=r.util._getObjectType(l),("LIKE"===h||"NOT LIKE"===h)&&"String"!==n)throw new Error("Error parsing filter object. The operator "+t.operator+" requires a string value");"String"===n?(d="'{1}'",l=l.replace(/'/g,"''")):"Date"===n?"date"===(c=e._getFormat(a))?d="'{1:yyyy-MM-dd}'":"date-time"===c?d="{1:#ISO(iso)}":"time"===c&&(d="'{1:FFF}'"):d="{1}","startswith"===t.operator?d="'{1}%'":"endswith"===t.operator?d="'%{1}'":"contains"===t.operator||"doesnotcontain"===t.operator?d="'%{1}%'":p=!1,p&&(l=(l=l.replace(/%/g,"\\%")).replace(/_/g,"\\_")),d="{2} {0} "+d,f=r.util._format(d,h,l,a)}else if(h&&void 0===l){if("isempty"===t.operator||"isnotempty"===t.operator){if((n=e._fields[a.toLowerCase()].type)!=="String".toLowerCase())throw new Error("Error parsing filter object. The operator "+t.operator+" requires a string field");"isempty"===t.operator?d="{2} = ''":"isnotempty"===t.operator&&(d="{2} != ''")}else d="isnull"===t.operator?"{2} IS NULL":"isnotnull"===t.operator?"{2} IS NOT NULL":"{2} {0} NULL";f=r.util._format(d,h,l,a)}}_.push(f)}return f=_.join(" "+u+" "),_.length>1&&(f="("+f+")"),!0===s&&(f="SELECT * FROM "+e._name+" WHERE "+f),f},r.util._getObjectType=function(e){return Object.prototype.toString.call(e).slice(8,-1)},r.util._format=function(e){var t=arguments;return e.replace(/\{(\d+)(:[^\}]+)?\}/g,function(e,s,i){var o=t[parseInt(s,10)+1];return r.util._toString(o,i?i.substring(1):"")})},r.util._toString=function(e,t){return t&&"Date"===r.util._getObjectType(e)?r.util._formatDate(e,t):"number"==typeof e?e.toString():void 0!==e?e:""},r.util._pad=function(e,t){var s;return e=String(e),(s=(t=t||2)-e.length)?["","0","00","000","0000"][t].substring(0,s)+e:e},r.util._formatDate=function(e,t){return t.replace(/dd|MM|yyyy|hh|mm|fff|FFF|ss|zzz|iso|"[^"]*"|'[^']*'/g,function(t){var s,i;return"dd"===t?i=r.util._pad(e.getDate()):"MM"===t?i=r.util._pad(e.getMonth()+1):"yyyy"===t?i=r.util._pad(e.getFullYear(),4):"hh"===t?i=r.util._pad(e.getHours()):"mm"===t?i=r.util._pad(e.getMinutes()):"ss"===t?i=r.util._pad(e.getSeconds()):"fff"===t?i=r.util._pad(e.getMilliseconds(),3):"FFF"===t?i=String(e.getTime()):"zzz"===t?i=((s=e.getTimezoneOffset())<0?"+":"-")+s:"iso"===t&&(i=e.toISOString()),void 0!==i?i:t.slice(1,t.length-1)})},r.util.jsdoSettingsProcessor=function(e){"object"===(void 0===e?"undefined":i(e))&&(void 0!==e.authenticationModel&&""!==e.authenticationModel||(e.authenticationModel="ANONYMOUS"))}}()},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(s(0));s(5),s(4),s(3),s(2);var i=o(s(1));function o(e){return e&&e.__esModule?e:{default:e}}window.AuthenticationContext=i.default,r.default.data.AuthenticationProviderAdal=function(e,t){var s=new i.default(t);function o(e,t){var r=s.getResourceForEndpoint(t),i=$.Deferred();return null!==r?s.acquireToken(r,function(t,r){if(t||!r)return s.error(t),void i.reject(t);e.setRequestHeader("Authorization","Bearer "+r),i.resolve()}):i.reject("Unknown resource"),i.promise()}s.callback=t.callback,s.isCallback(window.location.hash)&&s.handleWindowCallback(),this._initialize(e,r.default.data.Session.AUTH_TYPE_ADAL,{_loginURI:r.default.data.AuthenticationProvider._homeLoginURIBase}),this._reset=function(){r.default.data.AuthenticationProviderAdal.prototype._reset.apply(this)},this.hasClientCredentials=function(){return s&&s.getCachedUser()&&s.getCachedToken(t.clientId)},this._loginProto=function(i){var a,n,d=$.Deferred(),h=this;if(!s||s.getCachedUser()&&s.getCachedToken(t.clientId)){if(this._loggedIn)throw new Error(r.default.data._getMsgText("jsdoMSG051","AuthenticationProvider"));return(a=new XMLHttpRequest).onreadystatechange=function(){4===a.readyState&&h._processLoginResult(a,d)},n=r.default.data.Session._useTimeStamp?r.default.data.Session._addTimeStampToURL(this._loginURI):this._loginURI,this._openLoginRequest(a,n),a.setRequestHeader("Accept","application/json"),o(a,e).then(function(){a.send(i)},function(){d.reject(this.arguments)}),d.promise()}s.login()},this._openRequestAndAuthorize=function(e,t,s,i,a){this.hasClientCredentials()?(e.open(t,s,i),r.default.data.Session._setNoCacheHeaders(e),o(e,s).then(function(){a()},function(){a(new Error(r.default.data._getMsgText("jsdoMSG125","AuthenticationProvider")))})):a(new Error(r.default.data._getMsgText("jsdoMSG125","AuthenticationProvider")))}},r.default.data.AuthenticationProviderAdal.prototype=r.default.data.AuthenticationProvider.prototype,t.default=r.default}]);
//# sourceMappingURL=progress.auth.adal.js.map